<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LBANN: lbann::lbann_quantizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LBANN
   &#160;<span id="projectnumber">v0.93-606-gca499c9-ci377629231</span>
   </div>
   <div id="projectbrief">LivermoreBigArtificialNeuralNetworkToolkit</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classlbann_1_1lbann__quantizer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classlbann_1_1lbann__quantizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">lbann::lbann_quantizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__reconstructions.html">adaptive_reconstructions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">adaptive_thresholds</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ac8b63c86fc871e248ce20c7af19a7fad"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a> = El::Unsigned</td></tr>
<tr class="separator:ac8b63c86fc871e248ce20c7af19a7fad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcda642ff1b44d31eec910909c3d013e"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> = El::Int</td></tr>
<tr class="separator:afcda642ff1b44d31eec910909c3d013e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a399f3f8c393b6021b43e95d1ce6ea28c"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> = El::Matrix&lt; <a class="el" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> &gt;</td></tr>
<tr class="separator:a399f3f8c393b6021b43e95d1ce6ea28c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85ea8e298c2975b4f802855278406aa7"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> = std::vector&lt; <a class="el" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a> &gt;</td></tr>
<tr class="separator:a85ea8e298c2975b4f802855278406aa7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb72778971f6bb914a14823dd5806702"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#adb72778971f6bb914a14823dd5806702">ThreshQuantized32</a> = std::vector&lt; uint32_t &gt;</td></tr>
<tr class="separator:adb72778971f6bb914a14823dd5806702"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2153502c89432e8762141d84794aac75"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2153502c89432e8762141d84794aac75">ThreshQuantized64</a> = std::vector&lt; uint64_t &gt;</td></tr>
<tr class="separator:a2153502c89432e8762141d84794aac75"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a430cd47f333c678d2cb77f4ab2693914"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914">lbann_quantizer</a> ()</td></tr>
<tr class="separator:a430cd47f333c678d2cb77f4ab2693914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0cc07008ff963949c2cb7b91786c61c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ac0cc07008ff963949c2cb7b91786c61c">~lbann_quantizer</a> ()</td></tr>
<tr class="separator:ac0cc07008ff963949c2cb7b91786c61c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dd4696cbbfd93c73e5fb3c40fcb16c3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3">onebit_quantize</a> (const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;qmat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, bool sample=<a class="el" href="namespacelbann.html#aa1002432debb16a265bccfa035b0c582">true</a>)</td></tr>
<tr class="separator:a4dd4696cbbfd93c73e5fb3c40fcb16c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9eeb89150026bf4b7bea15bffdba10d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9eeb89150026bf4b7bea15bffdba10d3">onebit_quantize</a> (const <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;qmat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, bool sample=<a class="el" href="namespacelbann.html#aa1002432debb16a265bccfa035b0c582">true</a>)</td></tr>
<tr class="separator:a9eeb89150026bf4b7bea15bffdba10d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5592daa122b40c275cce3dc93bba41e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e">onebit_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;qmat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat)</td></tr>
<tr class="separator:ad5592daa122b40c275cce3dc93bba41e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc7a47fb5a5e87a09f2913a46a2bacf7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afc7a47fb5a5e87a09f2913a46a2bacf7">onebit_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;qmat, <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat)</td></tr>
<tr class="separator:afc7a47fb5a5e87a09f2913a46a2bacf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b326de1ca5b7eba6415b6f42f83335b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4b326de1ca5b7eba6415b6f42f83335b">intermodel_sum_onebit_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror)</td></tr>
<tr class="separator:a4b326de1ca5b7eba6415b6f42f83335b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af24e00e26e157f102f3cef547de40ae1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af24e00e26e157f102f3cef547de40ae1">intermodel_sum_onebit_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror)</td></tr>
<tr class="separator:af24e00e26e157f102f3cef547de40ae1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00106e69ea8a6dfe9e9a91c75b845bcd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">threshold_quantize</a> (const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, DataType pos_thresh, DataType neg_thresh, bool delta=false)</td></tr>
<tr class="separator:a00106e69ea8a6dfe9e9a91c75b845bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9949af6bec1e95adf5a32ba9bb4afd8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae9949af6bec1e95adf5a32ba9bb4afd8">threshold_quantize</a> (const <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, DataType pos_thresh, DataType neg_thresh, bool delta=false)</td></tr>
<tr class="separator:ae9949af6bec1e95adf5a32ba9bb4afd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f5f3b0149715ab59202b8884a87c7d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, DataType pos_thresh, DataType neg_thresh, bool delta=false)</td></tr>
<tr class="separator:a0f5f3b0149715ab59202b8884a87c7d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2324bba3cbb6c0d3e51bbe21555e7f1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2324bba3cbb6c0d3e51bbe21555e7f1a">threshold_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;q, <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat, DataType pos_thresh, DataType neg_thresh, bool delta=false)</td></tr>
<tr class="separator:a2324bba3cbb6c0d3e51bbe21555e7f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bd572557675705c5e080b92d74b02ae"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0bd572557675705c5e080b92d74b02ae">intermodel_sum_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, DataType pos_thresh, DataType neg_thresh)</td></tr>
<tr class="separator:a0bd572557675705c5e080b92d74b02ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2afc78996f35d90b5d0462292a1a2e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ac2afc78996f35d90b5d0462292a1a2e3">intermodel_sum_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, DataType pos_thresh, DataType neg_thresh)</td></tr>
<tr class="separator:ac2afc78996f35d90b5d0462292a1a2e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e4dfca5770dfd88ae6255b0407d8f80"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a7e4dfca5770dfd88ae6255b0407d8f80"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a7e4dfca5770dfd88ae6255b0407d8f80">adaptive_quantize</a> (const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, std::vector&lt; rowT &gt; &amp;q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:a7e4dfca5770dfd88ae6255b0407d8f80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a737865bb555db8a8a104fb345f7626b2"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a737865bb555db8a8a104fb345f7626b2"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a737865bb555db8a8a104fb345f7626b2">adaptive_quantize</a> (const <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat, std::vector&lt; rowT &gt; &amp;q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:a737865bb555db8a8a104fb345f7626b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf8d21e8114a00fdea53d919d76dd511"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:acf8d21e8114a00fdea53d919d76dd511"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#acf8d21e8114a00fdea53d919d76dd511">adaptive_unquantize</a> (const rowT *q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat)</td></tr>
<tr class="separator:acf8d21e8114a00fdea53d919d76dd511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5456c31af080fce7f85aa7a01b7ee939"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a5456c31af080fce7f85aa7a01b7ee939"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a5456c31af080fce7f85aa7a01b7ee939">adaptive_unquantize</a> (const rowT *q, <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat)</td></tr>
<tr class="separator:a5456c31af080fce7f85aa7a01b7ee939"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87e856d8bf5e8a678a39cdb8f547dfd9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a87e856d8bf5e8a678a39cdb8f547dfd9">intermodel_sum_adaptive_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:a87e856d8bf5e8a678a39cdb8f547dfd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2d4e5b9bc90f8feaaa32f3fc4183d10"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa2d4e5b9bc90f8feaaa32f3fc4183d10">intermodel_sum_adaptive_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:aa2d4e5b9bc90f8feaaa32f3fc4183d10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5aabc1cb4163e95aee993d9b37b9b32"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">adaptive_thresholds</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">proportion_threshold</a> (const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, int proportion, bool sample=<a class="el" href="namespacelbann.html#aa1002432debb16a265bccfa035b0c582">true</a>)</td></tr>
<tr class="separator:aa5aabc1cb4163e95aee993d9b37b9b32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af77beca5905ff8601ca9b8231a2a16e0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__reconstructions.html">adaptive_reconstructions</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af77beca5905ff8601ca9b8231a2a16e0">col_reconstruction</a> (const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, El::Int col, const <a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">adaptive_thresholds</a> threshes, bool sample=<a class="el" href="namespacelbann.html#aa1002432debb16a265bccfa035b0c582">true</a>)</td></tr>
<tr class="separator:af77beca5905ff8601ca9b8231a2a16e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b9d72b9133517e0212f73908a576c7e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a5b9d72b9133517e0212f73908a576c7e">get_proportion_time</a> () const </td></tr>
<tr class="separator:a5b9d72b9133517e0212f73908a576c7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee1ea46e3191ad25fd310938eaf5a2e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aee1ea46e3191ad25fd310938eaf5a2e0">reset_counters</a> ()</td></tr>
<tr class="separator:aee1ea46e3191ad25fd310938eaf5a2e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d9f7cc689b44935a347ff0b7e3d1820"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0d9f7cc689b44935a347ff0b7e3d1820">get_quantized_count</a> () const </td></tr>
<tr class="separator:a0d9f7cc689b44935a347ff0b7e3d1820"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a14314b419477c48bdf9a2465c02fce17"><td class="memItemLeft" align="right" valign="top">El::Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">get_onebit_quantized_matrix_height</a> (const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat) const </td></tr>
<tr class="separator:a14314b419477c48bdf9a2465c02fce17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a879cea8464408b8265be9e55edd83b2c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a879cea8464408b8265be9e55edd83b2c">onebit_unquantize_add</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;qmat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat)</td></tr>
<tr class="separator:a879cea8464408b8265be9e55edd83b2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab12b432ba2901347b025e8b6ec40a3c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ab12b432ba2901347b025e8b6ec40a3c6">threshold_unquantize_apply</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, DataType pos_thresh, DataType neg_thresh, std::vector&lt; El::Unsigned &gt; &amp;positions, bool delta=false)</td></tr>
<tr class="separator:ab12b432ba2901347b025e8b6ec40a3c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bcdf31781bf72bbe63940ea0d92990f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2bcdf31781bf72bbe63940ea0d92990f">threshold_quantize_apply</a> (const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, DataType pos_thresh, DataType neg_thresh, std::vector&lt; El::Unsigned &gt; &amp;positions, bool delta=false)</td></tr>
<tr class="separator:a2bcdf31781bf72bbe63940ea0d92990f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f63f7be2e227a48ebaa25056e6f85bc"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a1f63f7be2e227a48ebaa25056e6f85bc"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a1f63f7be2e227a48ebaa25056e6f85bc">adaptive_unquantize_add</a> (const rowT *q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat)</td></tr>
<tr class="separator:a1f63f7be2e227a48ebaa25056e6f85bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25ed3869c6bc615ae51198803ea4e33d"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a25ed3869c6bc615ae51198803ea4e33d"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a25ed3869c6bc615ae51198803ea4e33d">adaptive_quantize_replace</a> (<a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, std::vector&lt; rowT &gt; &amp;q, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:a25ed3869c6bc615ae51198803ea4e33d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d6e80bd54d6eb03dc63c15861356557"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a9d6e80bd54d6eb03dc63c15861356557"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9d6e80bd54d6eb03dc63c15861356557">adaptive_bound</a> (const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, std::vector&lt; rowT &gt; &amp;q, int proportion)</td></tr>
<tr class="separator:a9d6e80bd54d6eb03dc63c15861356557"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3a0e79b571e7c016446c179eedd0dc1"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:ab3a0e79b571e7c016446c179eedd0dc1"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ab3a0e79b571e7c016446c179eedd0dc1">adaptive_quantize_slice</a> (const std::vector&lt; rowT &gt; &amp;q, const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, std::vector&lt; rowT &gt; &amp;slice, colT start, colT end, int proportion)</td></tr>
<tr class="separator:ab3a0e79b571e7c016446c179eedd0dc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fe3493cb16b85bd4eaf251980408f1b"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a3fe3493cb16b85bd4eaf251980408f1b"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a3fe3493cb16b85bd4eaf251980408f1b">intermodel_sum_adaptive_quantized_impl</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;mat, <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:a3fe3493cb16b85bd4eaf251980408f1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa0c20f755437130172c40ca8e95bc3f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a> (El::Int width)</td></tr>
<tr class="separator:aaa0c20f755437130172c40ca8e95bc3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22b898932caed41ccf24abcb67c00ba1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">get_adaptive_quantization_copy_threads</a> (El::Int width)</td></tr>
<tr class="separator:a22b898932caed41ccf24abcb67c00ba1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a6bd266728f578df0c86fc2e493742cc1"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">proportion_time</a></td></tr>
<tr class="separator:a6bd266728f578df0c86fc2e493742cc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a716fae78ef5ba082a8093f0d06550804"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a></td></tr>
<tr class="separator:a716fae78ef5ba082a8093f0d06550804"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a33ea17392f53b90e91aea1ffb7e11d68"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> = sizeof(<a class="el" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a>) * 8</td></tr>
<tr class="separator:a33ea17392f53b90e91aea1ffb7e11d68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7745dbc282bebe812ff5523a4b3df3f2"><td class="memItemLeft" align="right" valign="top">static const El::Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a7745dbc282bebe812ff5523a4b3df3f2">NUM_THRESHOLD_SAMPLES</a> = 1024</td></tr>
<tr class="separator:a7745dbc282bebe812ff5523a4b3df3f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10667e56db4218aac3912c6bae28fc41"><td class="memItemLeft" align="right" valign="top">static const El::Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a10667e56db4218aac3912c6bae28fc41">NUM_RECON_SAMPLES</a> = 128</td></tr>
<tr class="separator:a10667e56db4218aac3912c6bae28fc41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e25785452736c54861a69207a48252d"><td class="memItemLeft" align="right" valign="top">static const El::Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a8e25785452736c54861a69207a48252d">NUM_ONEBIT_SAMPLES</a> = 128</td></tr>
<tr class="separator:a8e25785452736c54861a69207a48252d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb4315625e371169cabfac56c3f75d37"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> = 3</td></tr>
<tr class="separator:afb4315625e371169cabfac56c3f75d37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe63d57e62be1b498848f7920de4433a"><td class="memItemLeft" align="right" valign="top">static const El::Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#abe63d57e62be1b498848f7920de4433a">MAX_QUANTIZED_EXCESS</a> = 4</td></tr>
<tr class="separator:abe63d57e62be1b498848f7920de4433a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Support different kinds of quantization. Relevant references: "1-Bit Stochastic Gradient Descent and its Application to Data-Parallel
Distributed Training of Speech DNNs" by Frank Seide et al. (MSR) "Scalable Distributed DNN Training Using Commodity GPU Cloud Computing" by Nikko Strom. (Amazon) "Communication Quantization for Data-parallel Training of Deep Neural
Networks" by Nikoli Dryden et al. (LLNL/UIUC) </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00056">56</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="afcda642ff1b44d31eec910909c3d013e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">lbann::lbann_quantizer::qtype</a> =  El::Int</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00060">60</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a399f3f8c393b6021b43e95d1ce6ea28c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">lbann::lbann_quantizer::QuantizedMatrix</a> =  El::Matrix&lt;<a class="el" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This represents a quantized version of a matrix. Each column is quantized separately. The first two entries are floats representing the positive and negative averages for the column (used in dequantizion). The rest is one-bit quantized entries. Quantization is by column to keep averages nice and because Elemental uses column-major ordering. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00069">69</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a85ea8e298c2975b4f802855278406aa7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">lbann::lbann_quantizer::ThreshQuantized</a> =  std::vector&lt;<a class="el" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00070">70</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="adb72778971f6bb914a14823dd5806702"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classlbann_1_1lbann__quantizer.html#adb72778971f6bb914a14823dd5806702">lbann::lbann_quantizer::ThreshQuantized32</a> =  std::vector&lt;uint32_t&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00071">71</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2153502c89432e8762141d84794aac75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classlbann_1_1lbann__quantizer.html#a2153502c89432e8762141d84794aac75">lbann::lbann_quantizer::ThreshQuantized64</a> =  std::vector&lt;uint64_t&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00072">72</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac8b63c86fc871e248ce20c7af19a7fad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">lbann::lbann_quantizer::uqtype</a> =  El::Unsigned</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>We require that sizeof(DataType) &lt;= sizeof(qtype) == sizeof(uqtype). </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00059">59</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a430cd47f333c678d2cb77f4ab2693914"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::lbann_quantizer::lbann_quantizer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00037">37</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                                 {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#aee1ea46e3191ad25fd310938eaf5a2e0">reset_counters</a>();</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aee1ea46e3191ad25fd310938eaf5a2e0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aee1ea46e3191ad25fd310938eaf5a2e0">lbann::lbann_quantizer::reset_counters</a></div><div class="ttdeci">void reset_counters()</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00234">quantizer.hpp:234</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph" id="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aee1ea46e3191ad25fd310938eaf5a2e0" title="lbann::lbann_quantizer\l::reset_counters" alt="" coords="205,5,357,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac0cc07008ff963949c2cb7b91786c61c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::lbann_quantizer::~lbann_quantizer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00041">41</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                  {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a9d6e80bd54d6eb03dc63c15861356557"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_bound </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Ensure that q is no more than a factor of MAX_QUANTIZED_EXCESS larger than optimal. </p>

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00397">397</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                                                   {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(DataType),</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  DataType *__restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keyword">const</span> colT width = mat.Width();</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width +</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                          row_header_factor;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keyword">const</span> colT num_quantized = q.size() - header_len;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keyword">auto</span> *q_col = (colT *) q.data();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keywordflow">if</span> (num_quantized &gt; <a class="code" href="classlbann_1_1lbann__quantizer.html#abe63d57e62be1b498848f7920de4433a">MAX_QUANTIZED_EXCESS</a> * width * height / proportion) {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// Ensure there is a maximum bound on the number of entries sent.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// This should only occur if the threshold sampling is really bad.</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// As a simple recovery process, this just removes enough entries to fit</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// within the appropriate size. Removals begin from the end to avoid copies</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">// when deleting entries.</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    colT excess = num_quantized -</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                  (<a class="code" href="classlbann_1_1lbann__quantizer.html#abe63d57e62be1b498848f7920de4433a">MAX_QUANTIZED_EXCESS</a> * width * height / proportion);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    std::vector&lt;colT&gt; remove_counts(width, 0);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">for</span> (colT header_loc = (width - 1) * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;         excess &gt; 0;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;         header_loc -= <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      colT num_in_col = q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] - q_col[header_loc];</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordflow">if</span> (num_in_col == 0) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keyword">const</span> colT col_offset = (header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) * ldim;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      colT num_remove = std::min(excess, num_in_col);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      colT num_left = num_in_col - num_remove;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      DataType pos_recon, neg_recon;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      memcpy(&amp;pos_recon, &amp;q_col[header_loc + 1], <span class="keyword">sizeof</span>(pos_recon));</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      memcpy(&amp;neg_recon, &amp;q_col[header_loc + 2], <span class="keyword">sizeof</span>(neg_recon));</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      DataType *__restrict__ qerror_col = &amp;qerror_buf[col_offset];</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="comment">// Add the deleted portions to qerror.</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keywordflow">for</span> (colT i = q_col[header_loc] + num_left;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;           i &lt; q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>]; ++i) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keyword">const</span> rowT val = q[i];</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keyword">const</span> rowT row = val &gt;&gt; 1;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">if</span> (val &amp; 1) {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;          qerror_col[row] += pos_recon;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;          qerror_col[row] += neg_recon;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="comment">// TODO: When this is called from quantize_replace, this does not update</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="comment">// the local matrix.</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      q.erase(q.begin() + q_col[header_loc] + num_left, q.end());</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      excess -= num_remove;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      remove_counts[header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] = num_remove;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// Update all the header locations.</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    std::partial_sum(remove_counts.begin(), remove_counts.end(),</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                     remove_counts.begin());</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">for</span> (colT header_loc = 0; header_loc &lt; width * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;         header_loc += <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] -= remove_counts[header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>];</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00256">quantizer.hpp:256</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_abe63d57e62be1b498848f7920de4433a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#abe63d57e62be1b498848f7920de4433a">lbann::lbann_quantizer::MAX_QUANTIZED_EXCESS</a></div><div class="ttdeci">static const El::Int MAX_QUANTIZED_EXCESS</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00259">quantizer.hpp:259</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7e4dfca5770dfd88ae6255b0407d8f80"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Adaptively quantize a matrix. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width()). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">q</td><td>The output list of quantized entries. </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
    <tr><td class="paramname">proportion</td><td>Quantize one in proportion of the values. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00037">37</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                                                                   {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(DataType),</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// This uses a header to store all information needed to do unquantization in</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="comment">// one spot, which makes unquantization easier to multi-thread. The header has</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">// one entry for each column, consisting of the starting offset of the</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">// quantized data in the array (including the header) and the two/three</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// reconstruction values. The number of quantized entries is included as a</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// final entry to simplify unquantization.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keyword">const</span> colT width = mat.Width();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keyword">const</span> DataType *<span class="keyword">const</span> __restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  DataType *__restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width +</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                          row_header_factor;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  q.resize(header_len);  <span class="comment">// Space for the header.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="comment">// Select the appropriate number of threads.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(width);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  std::vector&lt;std::vector&lt;rowT&gt;&gt; thread_qs(num_threads);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  std::vector&lt;colT&gt; quantized_sums(num_threads, 0);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  std::vector&lt;colT&gt; quantized_counts(num_threads, 0);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="comment">// Compute the thresholds.</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keyword">const</span> adaptive_thresholds threshes =</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">proportion_threshold</a>(mat, qerror, proportion);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="comment">// This is for accessing q in different ways.</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keyword">auto</span> *q_col = (colT *) q.data();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">  #pragma omp parallel firstprivate(threshes, height, width, ldim, mat_buf, qerror_buf) num_threads(num_threads)</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    colT num_quantized = 0;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    std::vector&lt;rowT&gt;&amp; thread_q = thread_qs[tid];</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    thread_q.resize(std::max(</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                      2 * height * width / proportion / num_threads,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                      (colT) 4));</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    colT size = thread_q.size();</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">    #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (colT col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keyword">const</span> colT header_loc = <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * col;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      q_col[header_loc] = num_quantized;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      <span class="keyword">const</span> adaptive_reconstructions recons =</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#af77beca5905ff8601ca9b8231a2a16e0">col_reconstruction</a>(mat, qerror, col, threshes);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="comment">// Store the averages for reconstruction.</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      q_col[header_loc + 1] = 0;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      memcpy(&amp;q_col[header_loc + 1], &amp;recons.pos_recon, <span class="keyword">sizeof</span>(recons.pos_recon));</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      q_col[header_loc + 2] = 0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      memcpy(&amp;q_col[header_loc + 2], &amp;recons.neg_recon, <span class="keyword">sizeof</span>(recons.neg_recon));</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor"></span>      q_col[header_loc + 3] = 0;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      memcpy(&amp;q_col[header_loc + 3], &amp;recons.zero_recon, <span class="keyword">sizeof</span>(recons.zero_recon));</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor"></span>      <span class="keyword">const</span> colT col_offset = col * ldim;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keyword">const</span> DataType *<span class="keyword">const</span> __restrict__ mat_col = &amp;mat_buf[col_offset];</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      DataType *__restrict__ qerror_col = &amp;qerror_buf[col_offset];</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">for</span> (rowT row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keyword">const</span> DataType val = mat_col[row] + qerror_col[row];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> x = val &gt;= threshes.pos_thresh;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> y = val &lt;= threshes.neg_thresh;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">if</span> (__builtin_expect(!!(x || y), 0)) {  <span class="comment">// Unlikely.</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          <span class="keywordflow">if</span> (x) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            qerror_col[row] = val - recons.pos_recon;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            thread_q[num_quantized++] = (row &lt;&lt; 1) | 1;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            qerror_col[row] = val - recons.neg_recon;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            thread_q[num_quantized++] = row &lt;&lt; 1;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;          }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;          <span class="keywordflow">if</span> (__builtin_expect(!!(num_quantized &gt;= size), 0)) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            thread_q.resize(2 * size);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            size *= 2;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;          }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor"></span>          qerror_col[row] = val - recons.zero_recon;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor"></span>          qerror_col[row] = val;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor"></span>        }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    quantized_counts[tid] = num_quantized;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor">    #pragma omp barrier</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor"></span><span class="preprocessor">    #pragma omp single</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="comment">// Compute the amount to adjust header counts by. This is essentially</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="comment">// a shifted prefix-sum.</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 1; t &lt; num_threads; ++t) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        quantized_sums[t] = quantized_sums[t - 1] + quantized_counts[t - 1];</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">// Have threads patch up the header counts.</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// Static schedule guarantees threads are assigned the same way.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">    #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (colT col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * col] += quantized_sums[tid] + header_len;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  colT total_quantized = std::accumulate(quantized_counts.begin(),</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                         quantized_counts.end(), 0);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  q.resize(header_len + total_quantized);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_copy_threads =</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">get_adaptive_quantization_copy_threads</a>(width);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(dynamic, 1) num_threads(num_copy_threads)</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> tid = 0; tid &lt; thread_qs.size(); ++tid) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    std::copy(thread_qs[tid].begin(),</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;              thread_qs[tid].begin() + quantized_counts[tid],</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;              q.begin() + quantized_sums[tid] + header_len);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="comment">// Store the final number of entries. Get a new q_col pointer because of the</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// resize.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  q_col = (colT *) q.data();</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width] = (colT) q.size();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a> = q.size() - header_len;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  adaptive_bound&lt;colT, rowT&gt;(mat, qerror, q, proportion);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a22b898932caed41ccf24abcb67c00ba1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">lbann::lbann_quantizer::get_adaptive_quantization_copy_threads</a></div><div class="ttdeci">int get_adaptive_quantization_copy_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00351">quantizer.hpp:351</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa5aabc1cb4163e95aee993d9b37b9b32"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">lbann::lbann_quantizer::proportion_threshold</a></div><div class="ttdeci">adaptive_thresholds proportion_threshold(const Mat &amp;mat, const Mat &amp;qerror, int proportion, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00500">quantizer.cpp:500</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00328">quantizer.hpp:328</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a716fae78ef5ba082a8093f0d06550804"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">lbann::lbann_quantizer::quantized_count</a></div><div class="ttdeci">size_t quantized_count</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00264">quantizer.hpp:264</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00256">quantizer.hpp:256</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af77beca5905ff8601ca9b8231a2a16e0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af77beca5905ff8601ca9b8231a2a16e0">lbann::lbann_quantizer::col_reconstruction</a></div><div class="ttdeci">adaptive_reconstructions col_reconstruction(const Mat &amp;mat, const Mat &amp;qerror, El::Int col, const adaptive_thresholds threshes, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00582">quantizer.cpp:582</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a7e4dfca5770dfd88ae6255b0407d8f80_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a7e4dfca5770dfd88ae6255b0407d8f80_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a7e4dfca5770dfd88ae6255b0407d8f80_cgraph" id="classlbann_1_1lbann__quantizer_a7e4dfca5770dfd88ae6255b0407d8f80_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="435,5,616,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32" title="lbann::lbann_quantizer\l::proportion_threshold" alt="" coords="220,135,372,177"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#af77beca5905ff8601ca9b8231a2a16e0" title="lbann::lbann_quantizer\l::col_reconstruction" alt="" coords="220,201,372,242"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_copy_threads" alt="" coords="205,56,387,112"/><area shape="rect" id="node4" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="470,99,581,125"/><area shape="rect" id="node5" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="441,200,610,227"/><area shape="rect" id="node6" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="457,149,593,176"/><area shape="rect" id="node8" href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006" title="lbann::fast_rand_int_pow2" alt="" coords="438,251,613,277"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a737865bb555db8a8a104fb345f7626b2"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00164">164</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                                                                       {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  adaptive_quantize&lt;colT, rowT&gt;(mat.LockedMatrix(), q, qerror, proportion);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a25ed3869c6bc615ae51198803ea4e33d"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_quantize_replace </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Variant of adaptive_quantize that also replaces entries in mat with their quantized version. This is equivalent to: adaptive_quantize(mat, q, qerror, proportion); adaptive_unquantize(q, mat); </p>

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00274">274</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                                             {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(DataType),</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keyword">const</span> colT width = mat.Width();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  DataType *__restrict__ mat_buf = mat.Buffer();</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  DataType *__restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width +</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                          row_header_factor;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  q.resize(header_len);  <span class="comment">// Space for the header.</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">// Select the appropriate number of threads.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(width);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  std::vector&lt;std::vector&lt;rowT&gt;&gt; thread_qs(num_threads);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  std::vector&lt;colT&gt; quantized_sums(num_threads, 0);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  std::vector&lt;colT&gt; quantized_counts(num_threads, 0);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">// Compute the thresholds.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keyword">const</span> adaptive_thresholds threshes =</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">proportion_threshold</a>(mat, qerror, proportion);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="keyword">auto</span> *q_col = (colT *) q.data();</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">  #pragma omp parallel firstprivate(threshes, height, width, ldim, mat_buf, qerror_buf) num_threads(num_threads)</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    colT num_quantized = 0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    std::vector&lt;rowT&gt;&amp; thread_q = thread_qs[tid];</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    thread_q.resize(std::max(</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                      2 * height * width / proportion / num_threads,</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                      (colT) 4));</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    colT size = thread_q.size();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">    #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (colT col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keyword">const</span> colT header_loc = <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * col;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      q_col[header_loc] = num_quantized;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keyword">const</span> adaptive_reconstructions recons =</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#af77beca5905ff8601ca9b8231a2a16e0">col_reconstruction</a>(mat, qerror, col, threshes);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="comment">// Store the averages for reconstruction.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      q_col[header_loc + 1] = 0;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      memcpy(&amp;q_col[header_loc + 1], &amp;recons.pos_recon, <span class="keyword">sizeof</span>(recons.pos_recon));</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      q_col[header_loc + 2] = 0;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      memcpy(&amp;q_col[header_loc + 2], &amp;recons.neg_recon, <span class="keyword">sizeof</span>(recons.neg_recon));</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="preprocessor"></span>      q_col[header_loc + 3] = 0;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      memcpy(&amp;q_col[header_loc + 3], &amp;recons.zero_recon, <span class="keyword">sizeof</span>(recons.zero_recon));</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="preprocessor"></span>      <span class="keyword">const</span> colT col_offset = col * ldim;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      DataType *__restrict__ mat_col = &amp;mat_buf[col_offset];</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      DataType *__restrict__ qerror_col = &amp;qerror_buf[col_offset];</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordflow">for</span> (rowT row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keyword">const</span> DataType val = mat_col[row] + qerror_col[row];</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> x = val &gt;= threshes.pos_thresh;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> y = val &lt;= threshes.neg_thresh;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">if</span> (__builtin_expect(!!(x || y), 0)) {  <span class="comment">// Unlikely.</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;          <span class="keywordflow">if</span> (x) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            qerror_col[row] = val - recons.pos_recon;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            thread_q[num_quantized++] = (row &lt;&lt; 1) | 1;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            mat_col[row] = recons.pos_recon;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            qerror_col[row] = val - recons.neg_recon;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            thread_q[num_quantized++] = row &lt;&lt; 1;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            mat_col[row] = recons.neg_recon;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;          }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          <span class="keywordflow">if</span> (__builtin_expect(!!(num_quantized &gt;= size), 0)) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            thread_q.resize(2 * size);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            size *= 2;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor"></span>          qerror_col[row] = val - recons.zero_recon;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          mat_col[row] = recons.zero_recon;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor"></span>          qerror_col[row] = val;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor"></span>        }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    quantized_counts[tid] = num_quantized;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="preprocessor">    #pragma omp barrier</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor"></span><span class="preprocessor">    #pragma omp single</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="comment">// Compute the amount to adjust header counts by. This is essentially</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="comment">// a shifted prefix-sum.</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 1; t &lt; num_threads; ++t) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        quantized_sums[t] = quantized_sums[t - 1] + quantized_counts[t - 1];</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">// Have threads patch up the header counts.</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// Static schedule guarantees threads are assigned the same way.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="preprocessor">    #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (colT col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * col] += quantized_sums[tid] + header_len;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  colT total_quantized = std::accumulate(quantized_counts.begin(),</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                         quantized_counts.end(), 0);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  q.resize(header_len + total_quantized);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_copy_threads =</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">get_adaptive_quantization_copy_threads</a>(width);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(dynamic, 1) num_threads(num_copy_threads)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> tid = 0; tid &lt; thread_qs.size(); ++tid) {</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    std::copy(thread_qs[tid].begin(),</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;              thread_qs[tid].begin() + quantized_counts[tid],</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;              q.begin() + quantized_sums[tid] + header_len);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">// Store the final number of entries. Get a new q_col pointer because of the</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="comment">// resize.</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  q_col = (colT *) q.data();</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width] = q.size();</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a> = q.size() - header_len;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  adaptive_bound&lt;colT, rowT&gt;(mat, qerror, q, proportion);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a22b898932caed41ccf24abcb67c00ba1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">lbann::lbann_quantizer::get_adaptive_quantization_copy_threads</a></div><div class="ttdeci">int get_adaptive_quantization_copy_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00351">quantizer.hpp:351</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa5aabc1cb4163e95aee993d9b37b9b32"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">lbann::lbann_quantizer::proportion_threshold</a></div><div class="ttdeci">adaptive_thresholds proportion_threshold(const Mat &amp;mat, const Mat &amp;qerror, int proportion, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00500">quantizer.cpp:500</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00328">quantizer.hpp:328</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a716fae78ef5ba082a8093f0d06550804"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">lbann::lbann_quantizer::quantized_count</a></div><div class="ttdeci">size_t quantized_count</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00264">quantizer.hpp:264</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00256">quantizer.hpp:256</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af77beca5905ff8601ca9b8231a2a16e0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af77beca5905ff8601ca9b8231a2a16e0">lbann::lbann_quantizer::col_reconstruction</a></div><div class="ttdeci">adaptive_reconstructions col_reconstruction(const Mat &amp;mat, const Mat &amp;qerror, El::Int col, const adaptive_thresholds threshes, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00582">quantizer.cpp:582</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a25ed3869c6bc615ae51198803ea4e33d_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a25ed3869c6bc615ae51198803ea4e33d_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a25ed3869c6bc615ae51198803ea4e33d_cgraph" id="classlbann_1_1lbann__quantizer_a25ed3869c6bc615ae51198803ea4e33d_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="467,5,648,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32" title="lbann::lbann_quantizer\l::proportion_threshold" alt="" coords="252,135,404,177"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#af77beca5905ff8601ca9b8231a2a16e0" title="lbann::lbann_quantizer\l::col_reconstruction" alt="" coords="252,201,404,242"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_copy_threads" alt="" coords="237,56,419,112"/><area shape="rect" id="node4" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="502,99,613,125"/><area shape="rect" id="node5" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="473,200,642,227"/><area shape="rect" id="node6" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="489,149,625,176"/><area shape="rect" id="node8" href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006" title="lbann::fast_rand_int_pow2" alt="" coords="470,251,645,277"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab3a0e79b571e7c016446c179eedd0dc1"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_quantize_slice </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">colT&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">colT&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00470">470</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                                                {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keyword">const</span> colT width = end - start;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * width * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> +</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                          row_header_factor;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="comment">// Copy the header over. Locations will need to be adjusted later.</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *q_col = (<span class="keyword">const</span> colT *) q.data();</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keyword">const</span> colT total_len = header_len + q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * end] - q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * start];</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  slice.resize(total_len);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="keyword">auto</span> *slice_col = (colT *) slice.data();</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  std::copy(&amp;q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>*start], &amp;q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>*end + 1],</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            slice_col);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">// Copy data over.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  std::copy(q.begin() + slice_col[0], q.begin() + slice_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width],</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            slice.begin() + header_len);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// Adjust locations.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="keyword">const</span> colT adjust = slice_col[0] - header_len;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="keywordflow">for</span> (colT header_loc = 0; header_loc &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width; header_loc += <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    slice_col[header_loc] -= adjust;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  adaptive_bound&lt;colT, rowT&gt;(mat, qerror, slice, proportion);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00256">quantizer.hpp:256</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acf8d21e8114a00fdea53d919d76dd511"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_unquantize </td>
          <td>(</td>
          <td class="paramtype">const rowT *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize an adaptively-quantized matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">q</td><td>The quantizd matrix. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00170">170</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                           {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(DataType),</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  DataType *__restrict__ buf = mat.Buffer();</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keyword">const</span> colT header_len = mat.Width() * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor"></span>  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor"></span>  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *q_col = (<span class="keyword">const</span> colT *) q;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(mat.Width());</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(dynamic, 1), firstprivate(header_len, buf) num_threads(num_threads)</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (colT header_loc = 0; header_loc &lt; header_len; header_loc += <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keyword">const</span> colT col_offset = (header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) * ldim;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// Extract averages.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    DataType pos_recon, neg_recon;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    memcpy(&amp;pos_recon, &amp;q_col[header_loc + 1], <span class="keyword">sizeof</span>(pos_recon));</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    memcpy(&amp;neg_recon, &amp;q_col[header_loc + 2], <span class="keyword">sizeof</span>(neg_recon));</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor"></span>    DataType zero_recon;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    memcpy(&amp;zero_recon, &amp;q_col[header_loc + 3], <span class="keyword">sizeof</span>(zero_recon));</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// Fill the column, then update with the other values.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    std::fill_n(&amp;buf[(header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) * ldim], height, zero_recon);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor"></span>    DataType *__restrict__ buf_col = &amp;buf[col_offset];</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">const</span> colT chunk_start = q_col[header_loc];</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">const</span> colT chunk_end = q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] - chunk_start;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">const</span> rowT *<span class="keyword">const</span> __restrict__ q_ = &amp;(q[chunk_start]);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">for</span> (rowT i = 0; i &lt; chunk_end; ++i) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keyword">const</span> rowT val = q_[i];</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keyword">const</span> rowT row = val &gt;&gt; 1;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      buf_col[row] = val &amp; 0x1 ? pos_recon : neg_recon;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00328">quantizer.hpp:328</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00256">quantizer.hpp:256</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_acf8d21e8114a00fdea53d919d76dd511_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_acf8d21e8114a00fdea53d919d76dd511_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_acf8d21e8114a00fdea53d919d76dd511_cgraph" id="classlbann_1_1lbann__quantizer_acf8d21e8114a00fdea53d919d76dd511_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="205,4,387,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5456c31af080fce7f85aa7a01b7ee939"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_unquantize </td>
          <td>(</td>
          <td class="paramtype">const rowT *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00217">217</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                               {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  adaptive_unquantize&lt;colT, rowT&gt;(q, mat.Matrix());</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1f63f7be2e227a48ebaa25056e6f85bc"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_unquantize_add </td>
          <td>(</td>
          <td class="paramtype">const rowT *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Variant of adaptive_unquantize that adds its entries. </p>

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00223">223</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                           {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(DataType),</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  DataType *__restrict__ buf = mat.Buffer();</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">const</span> colT header_len = mat.Width() * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="preprocessor"></span>  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="preprocessor"></span>  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> *q_col = (<span class="keyword">const</span> colT *) q;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(mat.Width());</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(dynamic, 1), firstprivate(header_len, buf) num_threads(num_threads)</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (colT header_loc = 0; header_loc &lt; header_len; header_loc += <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keyword">const</span> colT col_offset = (header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) * ldim;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// Extract averages.</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    DataType pos_recon, neg_recon;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    memcpy(&amp;pos_recon, &amp;q_col[header_loc + 1], <span class="keyword">sizeof</span>(pos_recon));</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    memcpy(&amp;neg_recon, &amp;q_col[header_loc + 2], <span class="keyword">sizeof</span>(neg_recon));</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="preprocessor"></span>    DataType zero_recon;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    memcpy(&amp;zero_recon, &amp;q_col[header_loc + 3], <span class="keyword">sizeof</span>(zero_recon));</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// Add zero_recon to everything and adjust the other means.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">for</span> (rowT row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      buf[row + col_offset] += zero_recon;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    pos_recon -= zero_recon;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    neg_recon += zero_recon;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="preprocessor"></span>    DataType *__restrict__ buf_col = &amp;buf[col_offset];</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keyword">const</span> colT chunk_start = q_col[header_loc];</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keyword">const</span> colT chunk_end = q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] - chunk_start;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keyword">const</span> rowT *<span class="keyword">const</span> __restrict__ q_ = &amp;(q[chunk_start]);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">for</span> (rowT i = 0; i &lt; chunk_end; ++i) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keyword">const</span> rowT val = q_[i];</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="keyword">const</span> rowT row = val &gt;&gt; 1;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      buf_col[row] += val &amp; 0x1 ? pos_recon : neg_recon;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00328">quantizer.hpp:328</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00256">quantizer.hpp:256</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a1f63f7be2e227a48ebaa25056e6f85bc_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a1f63f7be2e227a48ebaa25056e6f85bc_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a1f63f7be2e227a48ebaa25056e6f85bc_cgraph" id="classlbann_1_1lbann__quantizer_a1f63f7be2e227a48ebaa25056e6f85bc_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="232,4,413,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af77beca5905ff8601ca9b8231a2a16e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__reconstructions.html">lbann_quantizer::adaptive_reconstructions</a> lbann::lbann_quantizer::col_reconstruction </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">El::Int&#160;</td>
          <td class="paramname"><em>col</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">adaptive_thresholds</a>&#160;</td>
          <td class="paramname"><em>threshes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sample</em> = <code><a class="el" href="namespacelbann.html#aa1002432debb16a265bccfa035b0c582">true</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute reconstruction values for col. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to compute reconstruction values for. </td></tr>
    <tr><td class="paramname">qerror</td><td>The accumulated quantization error in mat. </td></tr>
    <tr><td class="paramname">col</td><td>The column to compute reconstruction values for. </td></tr>
    <tr><td class="paramname">ainfo</td><td>Adaptive quantization info with thresholds filled in. </td></tr>
    <tr><td class="paramname">sample</td><td>Whether to approximate stats by randomly sampling mat. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Adaptive reconstruction values. </dd></dl>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00582">582</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                                                   {</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  DataType pos_sum = 0.0f;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  El::Unsigned pos_count = 0;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  DataType neg_sum = 0.0f;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  El::Unsigned neg_count = 0;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="preprocessor"></span>  DataType zero_sum = 0.0f;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  El::Unsigned zero_count = 0;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor"></span>  <span class="keyword">const</span> El::Int height = mat.Height();</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keyword">const</span> El::Int col_offset = col * mat.LDim();</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keyword">const</span> DataType *__restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keyword">const</span> DataType *__restrict__ qerror_buf = qerror.LockedBuffer();</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keywordflow">if</span> (height &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a10667e56db4218aac3912c6bae28fc41">NUM_RECON_SAMPLES</a> || !sample) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordflow">for</span> (El::Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <span class="keyword">const</span> El::Unsigned pos = row + col_offset;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keywordflow">if</span> (val &gt;= threshes.pos_thresh) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        pos_sum += val;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        ++pos_count;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keywordflow">if</span> (val &lt;= threshes.neg_thresh) {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;          neg_sum += val;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;          ++neg_count;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;          zero_sum += val;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;          ++zero_count;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="comment">// Randomly sample entries to approximate the means.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="namespacelbann.html#af16616ffa6a3616836eabadd6ce837ec">fast_rng_gen</a>&amp; gen = <a class="code" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">get_fast_generator</a>();</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordtype">bool</span> is_pow2 = !(height &amp; (height - 1));  <span class="comment">// Assumes height != 0.</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    std::vector&lt;El::Unsigned&gt; poses(<a class="code" href="classlbann_1_1lbann__quantizer.html#a10667e56db4218aac3912c6bae28fc41">NUM_RECON_SAMPLES</a>);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">if</span> (is_pow2) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a10667e56db4218aac3912c6bae28fc41">NUM_RECON_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keyword">const</span> El::Unsigned pos = <a class="code" href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006">fast_rand_int_pow2</a>(gen, height) + col_offset;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        __builtin_prefetch(&amp;mat_buf[pos]);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        __builtin_prefetch(&amp;qerror_buf[pos]);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        poses[i] = pos;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a10667e56db4218aac3912c6bae28fc41">NUM_RECON_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keyword">const</span> El::Unsigned pos = <a class="code" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">fast_rand_int</a>(gen, height) + col_offset;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        __builtin_prefetch(&amp;mat_buf[pos]);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        __builtin_prefetch(&amp;qerror_buf[pos]);</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        poses[i] = pos;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a10667e56db4218aac3912c6bae28fc41">NUM_RECON_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="comment">//const unsigned pos = row_dist(gen) + col_offset;</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keyword">const</span> El::Unsigned pos = poses[i];</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordflow">if</span> (val &gt;= threshes.pos_thresh) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        pos_sum += val;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        ++pos_count;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">if</span> (val &lt;= threshes.neg_thresh) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          neg_sum += val;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          ++neg_count;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;          zero_sum += val;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          ++zero_count;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  }</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="comment">// Compute the means. Use the thresholds as initial values in case the</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <span class="comment">// sampling does not include any positive or negative values.</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  DataType pos_recon = threshes.pos_thresh;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  DataType neg_recon = threshes.neg_thresh;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="preprocessor"></span>  DataType zero_recon = 0.0f;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (pos_count &gt; 0) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    pos_recon = pos_sum / pos_count;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  }</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">if</span> (neg_count &gt; 0) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    neg_recon = neg_sum / neg_count;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  }</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (zero_count &gt; 0) {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    zero_recon = zero_sum / zero_count;</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordflow">return</span> { pos_recon, neg_recon, zero_recon };</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">return</span> { pos_recon, neg_recon };</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="preprocessor"></span>}</div>
<div class="ttc" id="namespacelbann_html_a557aaed6267e7aaf583a75149e9c670c"><div class="ttname"><a href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">lbann::fast_rand_int</a></div><div class="ttdeci">T fast_rand_int(Generator &amp;g, T max)</div><div class="ttdef"><b>Definition:</b> <a href="random_8hpp_source.html#l00068">random.hpp:68</a></div></div>
<div class="ttc" id="namespacelbann_html_ae6ce9c2fdec6f81803f6b1a6555c31c5"><div class="ttname"><a href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">lbann::get_fast_generator</a></div><div class="ttdeci">fast_rng_gen &amp; get_fast_generator()</div><div class="ttdef"><b>Definition:</b> <a href="random_8cpp_source.html#l00065">random.cpp:65</a></div></div>
<div class="ttc" id="namespacelbann_html_af16616ffa6a3616836eabadd6ce837ec"><div class="ttname"><a href="namespacelbann.html#af16616ffa6a3616836eabadd6ce837ec">lbann::fast_rng_gen</a></div><div class="ttdeci">std::minstd_rand fast_rng_gen</div><div class="ttdef"><b>Definition:</b> <a href="random_8hpp_source.html#l00038">random.hpp:38</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a10667e56db4218aac3912c6bae28fc41"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a10667e56db4218aac3912c6bae28fc41">lbann::lbann_quantizer::NUM_RECON_SAMPLES</a></div><div class="ttdeci">static const El::Int NUM_RECON_SAMPLES</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00249">quantizer.hpp:249</a></div></div>
<div class="ttc" id="namespacelbann_html_a2fe8cea17a147566b73260f557b51006"><div class="ttname"><a href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006">lbann::fast_rand_int_pow2</a></div><div class="ttdeci">T fast_rand_int_pow2(Generator &amp;g, T max)</div><div class="ttdef"><b>Definition:</b> <a href="random_8hpp_source.html#l00081">random.hpp:81</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_af77beca5905ff8601ca9b8231a2a16e0_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_af77beca5905ff8601ca9b8231a2a16e0_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_af77beca5905ff8601ca9b8231a2a16e0_cgraph" id="classlbann_1_1lbann__quantizer_af77beca5905ff8601ca9b8231a2a16e0_cgraph">
<area shape="rect" id="node2" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="209,5,378,32"/><area shape="rect" id="node3" href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006" title="lbann::fast_rand_int_pow2" alt="" coords="206,56,381,83"/><area shape="rect" id="node4" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="225,107,361,133"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_af77beca5905ff8601ca9b8231a2a16e0_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_af77beca5905ff8601ca9b8231a2a16e0_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_af77beca5905ff8601ca9b8231a2a16e0_icgraph" id="classlbann_1_1lbann__quantizer_af77beca5905ff8601ca9b8231a2a16e0_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a7e4dfca5770dfd88ae6255b0407d8f80" title="lbann::lbann_quantizer\l::adaptive_quantize" alt="" coords="221,5,373,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a25ed3869c6bc615ae51198803ea4e33d" title="lbann::lbann_quantizer\l::adaptive_quantize_replace" alt="" coords="205,70,389,111"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a22b898932caed41ccf24abcb67c00ba1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lbann::lbann_quantizer::get_adaptive_quantization_copy_threads </td>
          <td>(</td>
          <td class="paramtype">El::Int&#160;</td>
          <td class="paramname"><em>width</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of threads adaptive quantization uses in its copy loop. This is empirically determined. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">width</td><td>The width of the matrix being quantized. </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000028">Todo:</a></b></dt><dd>Make this configurable at compile time. <dl class="section note"><dt>Note</dt><dd>If this and get_adaptive_quantization_threads return different values for the same width, OpenMP may reap its threads and add additional overhead when invoking a parallel region with more threads. </dd></dl>
</dd></dl>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00351">351</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                                                 {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(width);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> (width &gt;= 16384) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      num_threads /= 2;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">return</span> num_threads;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00328">quantizer.hpp:328</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_cgraph" id="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="235,4,416,60"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_icgraph" id="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a7e4dfca5770dfd88ae6255b0407d8f80" title="lbann::lbann_quantizer\l::adaptive_quantize" alt="" coords="251,5,403,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a25ed3869c6bc615ae51198803ea4e33d" title="lbann::lbann_quantizer\l::adaptive_quantize_replace" alt="" coords="235,70,419,111"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaa0c20f755437130172c40ca8e95bc3f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lbann::lbann_quantizer::get_adaptive_quantization_threads </td>
          <td>(</td>
          <td class="paramtype">El::Int&#160;</td>
          <td class="paramname"><em>width</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of threads adaptive quantization should use for a matrix with the given width. This number of threads is empirically determined. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000027">Todo:</a></b></dt><dd>Make this configurable at compile time. </dd></dl>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00328">328</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                                            {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordtype">int</span> num_threads = omp_get_max_threads();</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">if</span> (width &lt;= 64) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      num_threads = 2;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 128) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      num_threads = 8;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 256) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      num_threads = 12;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 1024) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      num_threads = 24;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">return</span> std::min(omp_get_max_threads(), num_threads);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aaa0c20f755437130172c40ca8e95bc3f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aaa0c20f755437130172c40ca8e95bc3f_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aaa0c20f755437130172c40ca8e95bc3f_icgraph" id="classlbann_1_1lbann__quantizer_aaa0c20f755437130172c40ca8e95bc3f_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_copy_threads" alt="" coords="235,35,416,91"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a7e4dfca5770dfd88ae6255b0407d8f80" title="lbann::lbann_quantizer\l::adaptive_quantize" alt="" coords="480,10,632,51"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a25ed3869c6bc615ae51198803ea4e33d" title="lbann::lbann_quantizer\l::adaptive_quantize_replace" alt="" coords="464,91,648,133"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#acf8d21e8114a00fdea53d919d76dd511" title="lbann::lbann_quantizer\l::adaptive_unquantize" alt="" coords="249,166,401,207"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a1f63f7be2e227a48ebaa25056e6f85bc" title="lbann::lbann_quantizer\l::adaptive_unquantize_add" alt="" coords="237,231,414,273"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a14314b419477c48bdf9a2465c02fce17"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">El::Int lbann::lbann_quantizer::get_onebit_quantized_matrix_height </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the height of mat after quantization with <a class="el" href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3">onebit_quantize()</a>. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00267">267</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                                                                        {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">return</span> (mat.Height() + (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>-1)) / <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> + 2;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00245">quantizer.hpp:245</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a14314b419477c48bdf9a2465c02fce17_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a14314b419477c48bdf9a2465c02fce17_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a14314b419477c48bdf9a2465c02fce17_icgraph" id="classlbann_1_1lbann__quantizer_a14314b419477c48bdf9a2465c02fce17_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3" title="lbann::lbann_quantizer\l::onebit_quantize" alt="" coords="208,18,360,59"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a4b326de1ca5b7eba6415b6f42f83335b" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="409,69,573,125"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a9eeb89150026bf4b7bea15bffdba10d3" title="lbann::lbann_quantizer\l::onebit_quantize" alt="" coords="415,5,567,46"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="622,29,786,85"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#af24e00e26e157f102f3cef547de40ae1" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="622,109,786,165"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5b9d72b9133517e0212f73908a576c7e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_proportion_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00230">230</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                     {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">proportion_time</a>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a6bd266728f578df0c86fc2e493742cc1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">lbann::lbann_quantizer::proportion_time</a></div><div class="ttdeci">double proportion_time</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00262">quantizer.hpp:262</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0d9f7cc689b44935a347ff0b7e3d1820"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_quantized_count </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the most recent number of quantized entries. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00239">239</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                     {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a716fae78ef5ba082a8093f0d06550804"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">lbann::lbann_quantizer::quantized_count</a></div><div class="ttdeci">size_t quantized_count</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00264">quantizer.hpp:264</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0d9f7cc689b44935a347ff0b7e3d1820_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0d9f7cc689b44935a347ff0b7e3d1820_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a0d9f7cc689b44935a347ff0b7e3d1820_icgraph" id="classlbann_1_1lbann__quantizer_a0d9f7cc689b44935a347ff0b7e3d1820_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ad45c39a7a85fb8e1d99eca97aa4d9d09" title="lbann::lbann_callback\l_imcomm::do_summary" alt="" coords="205,11,368,53"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="417,4,581,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a87e856d8bf5e8a678a39cdb8f547dfd9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As with intermodel_sum_onebit_quantized, but use adaptive quantization. </p>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00471">471</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                                           {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">// Select which algorithm to use based on the size of mat.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="comment">// Multiply at 64 bits to avoid overflows.</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordtype">size_t</span> mat_size = ((size_t) mat.Height()) * ((<span class="keywordtype">size_t</span>) mat.Width());</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="comment">// Check signed version because we need one bit for the quantized value.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  <span class="keywordflow">if</span> (mat_size &gt; std::numeric_limits&lt;int32_t&gt;::max()) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    intermodel_sum_adaptive_quantized_impl&lt;uint64_t, uint64_t&gt;(</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <a class="code" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, qerror, proportion);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">// Check whether we can use 16-bit row indices.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="comment">// Determine the column type (at compile time) based upon DataType.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keyword">using</span> colT = std::conditional&lt;sizeof(DataType) &lt;= 4, uint32_t, uint64_t&gt;::type;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span> (mat.Height() &gt; std::numeric_limits&lt;int16_t&gt;::max()) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      intermodel_sum_adaptive_quantized_impl&lt;colT, uint32_t&gt;(</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <a class="code" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, qerror, proportion);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      intermodel_sum_adaptive_quantized_impl&lt;colT, uint16_t&gt;(</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <a class="code" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, qerror, proportion);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div>
<div class="ttc" id="file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="file__io_8cpp_source.html#l00044">file_io.cpp:44</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a87e856d8bf5e8a678a39cdb8f547dfd9_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a87e856d8bf5e8a678a39cdb8f547dfd9_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a87e856d8bf5e8a678a39cdb8f547dfd9_icgraph" id="classlbann_1_1lbann__quantizer_a87e856d8bf5e8a678a39cdb8f547dfd9_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="239,5,403,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aa2d4e5b9bc90f8feaaa32f3fc4183d10" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_quantized" alt="" coords="232,85,411,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa2d4e5b9bc90f8feaaa32f3fc4183d10"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00494">494</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                                               {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a87e856d8bf5e8a678a39cdb8f547dfd9">intermodel_sum_adaptive_quantized</a>(<a class="code" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror,</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                                    proportion);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="ttc" id="file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="file__io_8cpp_source.html#l00044">file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a87e856d8bf5e8a678a39cdb8f547dfd9"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a87e856d8bf5e8a678a39cdb8f547dfd9">lbann::lbann_quantizer::intermodel_sum_adaptive_quantized</a></div><div class="ttdeci">void intermodel_sum_adaptive_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, int proportion)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00471">quantizer.cpp:471</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa2d4e5b9bc90f8feaaa32f3fc4183d10_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa2d4e5b9bc90f8feaaa32f3fc4183d10_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa2d4e5b9bc90f8feaaa32f3fc4183d10_cgraph" id="classlbann_1_1lbann__quantizer_aa2d4e5b9bc90f8feaaa32f3fc4183d10_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a87e856d8bf5e8a678a39cdb8f547dfd9" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_quantized" alt="" coords="232,4,411,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3fe3493cb16b85bd4eaf251980408f1b"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_quantized_impl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer__impl_8hpp_source.html#l00496">496</a> of file <a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                                                           {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(DataType),</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keywordflow">if</span> (qerror.Height() == 0) {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    qerror.Resize(mat.Height(), mat.Width(), mat.LDim());</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    Zero(qerror);</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * mat.Width() +</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                          row_header_factor;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keyword">const</span> colT max_size = (header_len +</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                         <a class="code" href="classlbann_1_1lbann__quantizer.html#abe63d57e62be1b498848f7920de4433a">MAX_QUANTIZED_EXCESS</a> * mat.Width() * mat.Height() / proportion) *</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                         <span class="keyword">sizeof</span>(rowT);</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  std::vector&lt;rowT&gt; quant;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  std::vector&lt;std::vector&lt;rowT&gt;&gt; quant_slices(4);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="keyword">auto</span> send_transform =</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    [&amp;qerror, &amp;quant, &amp;quant_slices, proportion, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  (<a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp; to_trans, El::IR h, El::IR w, <span class="keywordtype">int</span>&amp; count, <span class="keywordtype">bool</span> const_data, <span class="keywordtype">int</span> call_idx) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keyword">auto</span> to_send = to_trans(h, w);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keyword">auto</span> to_send_qerr = qerror(h, w);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">if</span> (const_data) {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">// In this case we can quantize the entire matrix then slice it.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">if</span> (quant.empty()) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        adaptive_quantize&lt;colT, rowT&gt;(to_trans, quant, qerror, proportion);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      }</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      std::vector&lt;rowT&gt;&amp; quant_slice = quant_slices[call_idx];</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      quant_slice.clear();</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      adaptive_quantize_slice&lt;colT, rowT&gt;(quant, to_send, to_send_qerr,</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                                          quant_slice, w.beg, w.end,</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                          proportion);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      count = <span class="keyword">sizeof</span>(rowT) * quant_slice.size();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">return</span> (uint8_t *) quant_slice.data();</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      quant.clear();</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      adaptive_quantize_replace&lt;colT, rowT&gt;(to_send, quant, to_send_qerr,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                            proportion);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      count = <span class="keyword">sizeof</span>(rowT) * quant.size();</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">return</span> (uint8_t *) quant.data();</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  };</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keyword">auto</span> recv_transform =</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  [<span class="keyword">this</span>] (uint8_t *recv_buf, <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    adaptive_unquantize&lt;colT, rowT&gt;((rowT *) recv_buf, accum);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keyword">const</span> colT *q_col = (colT *) recv_buf;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(rowT) * q_col[accum.Width() * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>];</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  };</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <span class="keyword">auto</span> recv_apply_transform =</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  [<span class="keyword">this</span>] (uint8_t *recv_buf, <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp; accum, <span class="keywordtype">bool</span> is_local) -&gt; <span class="keywordtype">int</span> {</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span> (is_local) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> recv_mat;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      recv_mat.LockedAttach(accum.Height(), accum.Width(),</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                            (DataType *) recv_buf, accum.LDim());</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      accum += recv_mat;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(DataType) * recv_mat.Height() * recv_mat.Width();</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      adaptive_unquantize_add&lt;colT, rowT&gt;((rowT *) recv_buf, accum);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keyword">const</span> colT *q_col = (colT *) recv_buf;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(rowT) * q_col[accum.Width() * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>];</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  };</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  lbann_comm::allreduce_options opts;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  opts.max_reduces = 4;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <a class="code" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;intermodel_allreduce(</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    mat, max_size,</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    std::function&lt;uint8_t *(<a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp;, El::IR, El::IR, <span class="keywordtype">int</span>&amp;, <span class="keywordtype">bool</span>, <span class="keywordtype">int</span>)&gt;(send_transform),</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    std::function&lt;<span class="keywordtype">int</span>(uint8_t *, <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp;)&gt;(recv_transform),</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    std::function&lt;<span class="keywordtype">int</span>(uint8_t *, <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp;, <span class="keywordtype">bool</span>)&gt;(recv_apply_transform),</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    opts);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00256">quantizer.hpp:256</a></div></div>
<div class="ttc" id="base_8hpp_html_a68f11fdc31b62516cb310831bbe54d73"><div class="ttname"><a href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a></div><div class="ttdeci">El::Matrix&lt; lbann::DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="base_8hpp_source.html#l00042">base.hpp:42</a></div></div>
<div class="ttc" id="file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="file__io_8cpp_source.html#l00044">file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_abe63d57e62be1b498848f7920de4433a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#abe63d57e62be1b498848f7920de4433a">lbann::lbann_quantizer::MAX_QUANTIZED_EXCESS</a></div><div class="ttdeci">static const El::Int MAX_QUANTIZED_EXCESS</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00259">quantizer.hpp:259</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a3fe3493cb16b85bd4eaf251980408f1b_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a3fe3493cb16b85bd4eaf251980408f1b_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a3fe3493cb16b85bd4eaf251980408f1b_cgraph" id="classlbann_1_1lbann__quantizer_a3fe3493cb16b85bd4eaf251980408f1b_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__comm.html#a502bd724f9fb27f0e899306c69a3ec47" title="lbann::lbann_comm::\lintermodel_allreduce" alt="" coords="233,11,375,53"/><area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#af5631e5f0f54e4df4958eba9df2599ef" title="lbann::lbann_comm::\lallreduce" alt="" coords="425,11,567,53"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4b326de1ca5b7eba6415b6f42f83335b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_onebit_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Do a sum reduction of mat over comm's inter-model communicator, with all communication being quantized. im_querror is a separate quantization error matrix that should be passed in each time this is called. This implements the allreduce using a ring-based reduce-scatter followed by a ring-based allgather. Matrices are sent quantized, are unquantized for the reduction, then the reduced matrix is requantized for the allgather. If do_adagrad is true, this scales the inter-mediate unquantized result as in AdaGrad, and uses gradhist to store the gradient history. If used, you should use SGD as the optimizer for those layers to avoid applying AdaGrad twice. </p>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00210">210</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                           {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">// Initialize qerror.</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span> (qerror.Height() == 0) {</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    qerror.Resize(mat.Height(), mat.Width(), mat.LDim());</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    Zero(qerror);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  std::vector&lt;QuantizedMatrix&gt; qmats(4);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keyword">auto</span> send_transform =</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    [&amp;qerror, &amp;qmats, <span class="keyword">this</span>] (<a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp; to_trans, El::IR h, El::IR w, <span class="keywordtype">int</span>&amp; count,</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                             <span class="keywordtype">bool</span> const_data, <span class="keywordtype">int</span> call_idx) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keyword">auto</span> to_send = to_trans(h, w);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keyword">auto</span> to_send_qerr = qerror(h, w);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a>&amp; qmat = qmats[call_idx];</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3">onebit_quantize</a>(to_send, qmat, to_send_qerr);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    count = <span class="keyword">sizeof</span>(<a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a>) * qmat.Height() * qmat.Width();</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">if</span> (!const_data) {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="comment">// Need to accumulate local errors.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e">onebit_unquantize</a>(qmat, to_send);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">return</span> (uint8_t *) qmat.Buffer();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  };</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keyword">auto</span> recv_transform =</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  [<span class="keyword">this</span>] (uint8_t *recv_buf, <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> recv_mat;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    recv_mat.LockedAttach(</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">get_onebit_quantized_matrix_height</a>(accum), accum.Width(),</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      (<a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> *) recv_buf, <a class="code" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">get_onebit_quantized_matrix_height</a>(accum));</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e">onebit_unquantize</a>(recv_mat, accum);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a>) * recv_mat.Height() * recv_mat.Width();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  };</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keyword">auto</span> recv_apply_transform =</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  [<span class="keyword">this</span>] (uint8_t *recv_buf, <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp; accum, <span class="keywordtype">bool</span> is_local) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> (is_local) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> recv_mat;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      recv_mat.LockedAttach(accum.Height(), accum.Width(),</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                            (DataType *) recv_buf, accum.LDim());</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      accum += recv_mat;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(DataType) * recv_mat.Height() * recv_mat.Width();</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> recv_mat;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      recv_mat.LockedAttach(<a class="code" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">get_onebit_quantized_matrix_height</a>(accum),</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                            accum.Width(), (<a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> *) recv_buf,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                            <a class="code" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">get_onebit_quantized_matrix_height</a>(accum));</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a879cea8464408b8265be9e55edd83b2c">onebit_unquantize_add</a>(recv_mat, accum);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a>) * recv_mat.Height() * recv_mat.Width();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  };</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  lbann_comm::allreduce_options opts;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  opts.max_reduces = 4;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <a class="code" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;intermodel_allreduce(</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    mat, <span class="keyword">sizeof</span>(<a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a>) * <a class="code" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">get_onebit_quantized_matrix_height</a>(mat) * mat.Width(),</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    std::function&lt;uint8_t *(Mat&amp;, El::IR, El::IR, int&amp;, bool, int)&gt;(send_transform),</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    std::function&lt;<span class="keywordtype">int</span>(uint8_t *, <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp;)&gt;(recv_transform),</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    std::function&lt;<span class="keywordtype">int</span>(uint8_t *, <a class="code" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a>&amp;, <span class="keywordtype">bool</span>)&gt;(recv_apply_transform),</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    opts);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a399f3f8c393b6021b43e95d1ce6ea28c"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">lbann::lbann_quantizer::QuantizedMatrix</a></div><div class="ttdeci">El::Matrix&lt; qtype &gt; QuantizedMatrix</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00069">quantizer.hpp:69</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a14314b419477c48bdf9a2465c02fce17"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">lbann::lbann_quantizer::get_onebit_quantized_matrix_height</a></div><div class="ttdeci">El::Int get_onebit_quantized_matrix_height(const Mat &amp;mat) const </div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00267">quantizer.hpp:267</a></div></div>
<div class="ttc" id="base_8hpp_html_a68f11fdc31b62516cb310831bbe54d73"><div class="ttname"><a href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a></div><div class="ttdeci">El::Matrix&lt; lbann::DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="base_8hpp_source.html#l00042">base.hpp:42</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afcda642ff1b44d31eec910909c3d013e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">El::Int qtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00060">quantizer.hpp:60</a></div></div>
<div class="ttc" id="file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="file__io_8cpp_source.html#l00044">file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad5592daa122b40c275cce3dc93bba41e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e">lbann::lbann_quantizer::onebit_unquantize</a></div><div class="ttdeci">void onebit_unquantize(const QuantizedMatrix &amp;qmat, Mat &amp;mat)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00140">quantizer.cpp:140</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a879cea8464408b8265be9e55edd83b2c"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a879cea8464408b8265be9e55edd83b2c">lbann::lbann_quantizer::onebit_unquantize_add</a></div><div class="ttdeci">void onebit_unquantize_add(const QuantizedMatrix &amp;qmat, Mat &amp;mat)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00177">quantizer.cpp:177</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4dd4696cbbfd93c73e5fb3c40fcb16c3"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3">lbann::lbann_quantizer::onebit_quantize</a></div><div class="ttdeci">void onebit_quantize(const Mat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00045">quantizer.cpp:45</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4b326de1ca5b7eba6415b6f42f83335b_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4b326de1ca5b7eba6415b6f42f83335b_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4b326de1ca5b7eba6415b6f42f83335b_cgraph" id="classlbann_1_1lbann__quantizer_a4b326de1ca5b7eba6415b6f42f83335b_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3" title="lbann::lbann_quantizer\l::onebit_quantize" alt="" coords="224,75,376,117"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17" title="lbann::lbann_quantizer\l::get_onebit_quantized\l_matrix_height" alt="" coords="438,5,591,61"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e" title="lbann::lbann_quantizer\l::onebit_unquantize" alt="" coords="224,141,376,182"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a879cea8464408b8265be9e55edd83b2c" title="lbann::lbann_quantizer\l::onebit_unquantize_add" alt="" coords="219,206,381,247"/><area shape="rect" id="node8" href="classlbann_1_1lbann__comm.html#a502bd724f9fb27f0e899306c69a3ec47" title="lbann::lbann_comm::\lintermodel_allreduce" alt="" coords="229,271,371,313"/><area shape="rect" id="node4" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="430,85,599,112"/><area shape="rect" id="node5" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="447,136,583,163"/><area shape="rect" id="node9" href="classlbann_1_1lbann__comm.html#af5631e5f0f54e4df4958eba9df2599ef" title="lbann::lbann_comm::\lallreduce" alt="" coords="443,271,586,313"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4b326de1ca5b7eba6415b6f42f83335b_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4b326de1ca5b7eba6415b6f42f83335b_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4b326de1ca5b7eba6415b6f42f83335b_icgraph" id="classlbann_1_1lbann__quantizer_a4b326de1ca5b7eba6415b6f42f83335b_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="219,5,383,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#af24e00e26e157f102f3cef547de40ae1" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="219,85,383,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af24e00e26e157f102f3cef547de40ae1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_onebit_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00268">268</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                               {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a4b326de1ca5b7eba6415b6f42f83335b">intermodel_sum_onebit_quantized</a>(<a class="code" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="ttc" id="file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="file__io_8cpp_source.html#l00044">file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4b326de1ca5b7eba6415b6f42f83335b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4b326de1ca5b7eba6415b6f42f83335b">lbann::lbann_quantizer::intermodel_sum_onebit_quantized</a></div><div class="ttdeci">void intermodel_sum_onebit_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00210">quantizer.cpp:210</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_af24e00e26e157f102f3cef547de40ae1_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_af24e00e26e157f102f3cef547de40ae1_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_af24e00e26e157f102f3cef547de40ae1_cgraph" id="classlbann_1_1lbann__quantizer_af24e00e26e157f102f3cef547de40ae1_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4b326de1ca5b7eba6415b6f42f83335b" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="219,133,383,189"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3" title="lbann::lbann_quantizer\l::onebit_quantize" alt="" coords="437,75,589,117"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17" title="lbann::lbann_quantizer\l::get_onebit_quantized\l_matrix_height" alt="" coords="651,5,805,61"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e" title="lbann::lbann_quantizer\l::onebit_unquantize" alt="" coords="437,141,589,182"/><area shape="rect" id="node8" href="classlbann_1_1lbann__quantizer.html#a879cea8464408b8265be9e55edd83b2c" title="lbann::lbann_quantizer\l::onebit_unquantize_add" alt="" coords="432,206,595,247"/><area shape="rect" id="node9" href="classlbann_1_1lbann__comm.html#a502bd724f9fb27f0e899306c69a3ec47" title="lbann::lbann_comm::\lintermodel_allreduce" alt="" coords="442,271,585,313"/><area shape="rect" id="node5" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="643,85,813,112"/><area shape="rect" id="node6" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="660,136,796,163"/><area shape="rect" id="node10" href="classlbann_1_1lbann__comm.html#af5631e5f0f54e4df4958eba9df2599ef" title="lbann::lbann_comm::\lallreduce" alt="" coords="657,271,799,313"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0bd572557675705c5e080b92d74b02ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>neg_thresh</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As with intermodel_sum_onebit_quantized, but use threshold quantization. </p>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00456">456</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                       {</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">// Temporarily not supported until threshold quantization is updated to</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// have upper bounds on its send size.</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="keywordflow">throw</span> lbann_exception(<span class="stringliteral">&quot;Threshold quantized allreduce not supported&quot;</span>);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0bd572557675705c5e080b92d74b02ae_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0bd572557675705c5e080b92d74b02ae_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a0bd572557675705c5e080b92d74b02ae_icgraph" id="classlbann_1_1lbann__quantizer_a0bd572557675705c5e080b92d74b02ae_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="247,5,411,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ac2afc78996f35d90b5d0462292a1a2e3" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="238,85,421,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac2afc78996f35d90b5d0462292a1a2e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>neg_thresh</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00464">464</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                       {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a0bd572557675705c5e080b92d74b02ae">intermodel_sum_threshold_quantized</a>(<a class="code" href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, pos_thresh,</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                     neg_thresh);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;}</div>
<div class="ttc" id="file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="file__io_8cpp_source.html#l00044">file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0bd572557675705c5e080b92d74b02ae"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0bd572557675705c5e080b92d74b02ae">lbann::lbann_quantizer::intermodel_sum_threshold_quantized</a></div><div class="ttdeci">void intermodel_sum_threshold_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00456">quantizer.cpp:456</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ac2afc78996f35d90b5d0462292a1a2e3_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ac2afc78996f35d90b5d0462292a1a2e3_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ac2afc78996f35d90b5d0462292a1a2e3_cgraph" id="classlbann_1_1lbann__quantizer_ac2afc78996f35d90b5d0462292a1a2e3_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a0bd572557675705c5e080b92d74b02ae" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="238,4,421,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4dd4696cbbfd93c73e5fb3c40fcb16c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::onebit_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sample</em> = <code><a class="el" href="namespacelbann.html#aa1002432debb16a265bccfa035b0c582">true</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Quantize a matrix with onebit quantization. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width()). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">qmat</td><td>The output quantized matrix (will be resized). </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
    <tr><td class="paramname">sample</td><td>Whether to use samples to approximate averages. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00045">45</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                                                   {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="comment">// Set up the quantized matrix. (+2 for the averages.)</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keyword">const</span> El::Int qheight = <a class="code" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">get_onebit_quantized_matrix_height</a>(mat);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keyword">const</span> El::Int qwidth = mat.Width();</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  qmat.Resize(qheight, qwidth);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keyword">const</span> El::Int width = mat.Width();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keyword">const</span> El::Int height = mat.Height();</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keyword">const</span> El::Int ldim = mat.LDim();</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keyword">const</span> El::Int qmat_ldim = qmat.LDim();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keyword">const</span> DataType *__restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  DataType *__restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> *__restrict__ qmat_buf = qmat.Buffer();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(static)</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (El::Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// First compute the positive and negative column averages.</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    DataType pos_sum = 0.0f;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    DataType neg_sum = 0.0f;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    El::Unsigned num_pos = 0;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    El::Unsigned num_neg = 0;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> (height &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a8e25785452736c54861a69207a48252d">NUM_ONEBIT_SAMPLES</a> || !sample) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <span class="keywordflow">for</span> (El::Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keyword">const</span> El::Int pos = row + col * ldim;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;          pos_sum += val;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;          ++num_pos;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;          neg_sum += val;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;          ++num_neg;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">// Randomly sample NUM_ONEBIT_SAMPLES to approximate.</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <a class="code" href="namespacelbann.html#af16616ffa6a3616836eabadd6ce837ec">fast_rng_gen</a>&amp; gen = <a class="code" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">get_fast_generator</a>();</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordflow">for</span> (El::Int i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a8e25785452736c54861a69207a48252d">NUM_ONEBIT_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keyword">const</span> El::Int pos = <a class="code" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">fast_rand_int</a>(gen, height);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;          pos_sum += val;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;          ++num_pos;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;          neg_sum += val;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;          ++num_neg;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    DataType avg_pos = 0.0f;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span> (num_pos &gt; 0) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      avg_pos = pos_sum / num_pos;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    DataType avg_neg = 0.0f;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">if</span> (num_neg &gt; 0) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      avg_neg = neg_sum / num_neg;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// Store the averages.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// Use memcpy so that we don&#39;t violate aliasing rules.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> tmp = 0;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    memcpy(&amp;tmp, &amp;avg_pos, <span class="keyword">sizeof</span>(avg_pos));</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    qmat.Set(0, col, tmp);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    tmp = 0;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    memcpy(&amp;tmp, &amp;avg_neg, <span class="keyword">sizeof</span>(avg_neg));</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    qmat.Set(1, col, tmp);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// Now quantize the column, NUM_BITS entries at a time.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    El::Int qrow = 2;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">for</span> (El::Int row_chunk = 0; row_chunk &lt; height; row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a> q = 0;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        El::Int row = row_chunk + bit;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">if</span> (row &gt;= height) {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keyword">const</span> El::Int pos = row + col * ldim;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          q |= <a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a>(1) &lt;&lt; bit;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          qerror_buf[pos] = val - avg_pos;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;          qerror_buf[pos] = val - avg_neg;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      qmat_buf[qrow + col * qmat_ldim] = (<a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a>) q;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      ++qrow;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a8e25785452736c54861a69207a48252d"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a8e25785452736c54861a69207a48252d">lbann::lbann_quantizer::NUM_ONEBIT_SAMPLES</a></div><div class="ttdeci">static const El::Int NUM_ONEBIT_SAMPLES</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00251">quantizer.hpp:251</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ac8b63c86fc871e248ce20c7af19a7fad"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00059">quantizer.hpp:59</a></div></div>
<div class="ttc" id="namespacelbann_html_a557aaed6267e7aaf583a75149e9c670c"><div class="ttname"><a href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">lbann::fast_rand_int</a></div><div class="ttdeci">T fast_rand_int(Generator &amp;g, T max)</div><div class="ttdef"><b>Definition:</b> <a href="random_8hpp_source.html#l00068">random.hpp:68</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a14314b419477c48bdf9a2465c02fce17"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17">lbann::lbann_quantizer::get_onebit_quantized_matrix_height</a></div><div class="ttdeci">El::Int get_onebit_quantized_matrix_height(const Mat &amp;mat) const </div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00267">quantizer.hpp:267</a></div></div>
<div class="ttc" id="namespacelbann_html_ae6ce9c2fdec6f81803f6b1a6555c31c5"><div class="ttname"><a href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">lbann::get_fast_generator</a></div><div class="ttdeci">fast_rng_gen &amp; get_fast_generator()</div><div class="ttdef"><b>Definition:</b> <a href="random_8cpp_source.html#l00065">random.cpp:65</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afcda642ff1b44d31eec910909c3d013e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">El::Int qtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00060">quantizer.hpp:60</a></div></div>
<div class="ttc" id="namespacelbann_html_af16616ffa6a3616836eabadd6ce837ec"><div class="ttname"><a href="namespacelbann.html#af16616ffa6a3616836eabadd6ce837ec">lbann::fast_rng_gen</a></div><div class="ttdeci">std::minstd_rand fast_rng_gen</div><div class="ttdef"><b>Definition:</b> <a href="random_8hpp_source.html#l00038">random.hpp:38</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00245">quantizer.hpp:245</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4dd4696cbbfd93c73e5fb3c40fcb16c3_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4dd4696cbbfd93c73e5fb3c40fcb16c3_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4dd4696cbbfd93c73e5fb3c40fcb16c3_cgraph" id="classlbann_1_1lbann__quantizer_a4dd4696cbbfd93c73e5fb3c40fcb16c3_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17" title="lbann::lbann_quantizer\l::get_onebit_quantized\l_matrix_height" alt="" coords="214,5,367,61"/><area shape="rect" id="node3" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="206,85,375,112"/><area shape="rect" id="node4" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="223,136,359,163"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4dd4696cbbfd93c73e5fb3c40fcb16c3_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4dd4696cbbfd93c73e5fb3c40fcb16c3_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4dd4696cbbfd93c73e5fb3c40fcb16c3_icgraph" id="classlbann_1_1lbann__quantizer_a4dd4696cbbfd93c73e5fb3c40fcb16c3_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a9eeb89150026bf4b7bea15bffdba10d3" title="lbann::lbann_quantizer\l::onebit_quantize" alt="" coords="212,5,364,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4b326de1ca5b7eba6415b6f42f83335b" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="206,69,370,125"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="419,29,583,85"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#af24e00e26e157f102f3cef547de40ae1" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="419,109,583,165"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9eeb89150026bf4b7bea15bffdba10d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::onebit_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sample</em> = <code><a class="el" href="namespacelbann.html#aa1002432debb16a265bccfa035b0c582">true</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00135">135</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                                                {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3">onebit_quantize</a>(mat.LockedMatrix(), qmat, qerror, sample);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4dd4696cbbfd93c73e5fb3c40fcb16c3"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3">lbann::lbann_quantizer::onebit_quantize</a></div><div class="ttdeci">void onebit_quantize(const Mat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00045">quantizer.cpp:45</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a9eeb89150026bf4b7bea15bffdba10d3_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a9eeb89150026bf4b7bea15bffdba10d3_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a9eeb89150026bf4b7bea15bffdba10d3_cgraph" id="classlbann_1_1lbann__quantizer_a9eeb89150026bf4b7bea15bffdba10d3_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4dd4696cbbfd93c73e5fb3c40fcb16c3" title="lbann::lbann_quantizer\l::onebit_quantize" alt="" coords="205,78,357,119"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a14314b419477c48bdf9a2465c02fce17" title="lbann::lbann_quantizer\l::get_onebit_quantized\l_matrix_height" alt="" coords="414,5,567,61"/><area shape="rect" id="node4" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="406,85,575,112"/><area shape="rect" id="node5" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="423,136,559,163"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad5592daa122b40c275cce3dc93bba41e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::onebit_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize a onebit-quantized matrix.. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qmat</td><td>The matrix to unquantize. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00140">140</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                                                                             {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keyword">const</span> El::Int width = mat.Width();</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  <span class="keyword">const</span> El::Int height = mat.Height();</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keyword">const</span> El::Int ldim = mat.LDim();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keyword">const</span> El::Int qmat_ldim = qmat.LDim();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> *__restrict__ qmat_buf = qmat.LockedBuffer();</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  DataType *__restrict__ mat_buf = mat.Buffer();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(static)</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (El::Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    El::Int qrow = 2;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// Extract the averages.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> tmp = qmat.Get(0, col);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    DataType avg_pos;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    memcpy(&amp;avg_pos, &amp;tmp, <span class="keyword">sizeof</span>(avg_pos));</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    tmp = qmat.Get(1, col);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    DataType avg_neg;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    memcpy(&amp;avg_neg, &amp;tmp, <span class="keyword">sizeof</span>(avg_neg));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">// Unquantize this column.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">for</span> (El::Int row_chunk = 0; row_chunk &lt; height; row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keyword">auto</span> q = (<a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a>) qmat_buf[qrow + col * qmat_ldim];</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        El::Int row = row_chunk + bit;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">if</span> (row &gt;= height) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        mat_buf[row + col * ldim] = (q &gt;&gt; bit) &amp; 0x1 ? avg_pos : avg_neg;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      }</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      ++qrow;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ac8b63c86fc871e248ce20c7af19a7fad"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00059">quantizer.hpp:59</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afcda642ff1b44d31eec910909c3d013e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">El::Int qtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00060">quantizer.hpp:60</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00245">quantizer.hpp:245</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ad5592daa122b40c275cce3dc93bba41e_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ad5592daa122b40c275cce3dc93bba41e_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ad5592daa122b40c275cce3dc93bba41e_icgraph" id="classlbann_1_1lbann__quantizer_ad5592daa122b40c275cce3dc93bba41e_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#afc7a47fb5a5e87a09f2913a46a2bacf7" title="lbann::lbann_quantizer\l::onebit_unquantize" alt="" coords="212,5,364,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4b326de1ca5b7eba6415b6f42f83335b" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="206,69,370,125"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="419,29,583,85"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#af24e00e26e157f102f3cef547de40ae1" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="419,109,583,165"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afc7a47fb5a5e87a09f2913a46a2bacf7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::onebit_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00172">172</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                                                      {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e">onebit_unquantize</a>(qmat, mat.Matrix());</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad5592daa122b40c275cce3dc93bba41e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e">lbann::lbann_quantizer::onebit_unquantize</a></div><div class="ttdeci">void onebit_unquantize(const QuantizedMatrix &amp;qmat, Mat &amp;mat)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00140">quantizer.cpp:140</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_afc7a47fb5a5e87a09f2913a46a2bacf7_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_afc7a47fb5a5e87a09f2913a46a2bacf7_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_afc7a47fb5a5e87a09f2913a46a2bacf7_cgraph" id="classlbann_1_1lbann__quantizer_afc7a47fb5a5e87a09f2913a46a2bacf7_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#ad5592daa122b40c275cce3dc93bba41e" title="lbann::lbann_quantizer\l::onebit_unquantize" alt="" coords="205,5,357,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a879cea8464408b8265be9e55edd83b2c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::onebit_unquantize_add </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a399f3f8c393b6021b43e95d1ce6ea28c">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Variant of unquantize that adds its entries. </p>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00177">177</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;              {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keyword">const</span> El::Int width = mat.Width();</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keyword">const</span> El::Int height = mat.Height();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keyword">const</span> El::Int ldim = mat.LDim();</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keyword">const</span> El::Int qmat_ldim = qmat.LDim();</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> *__restrict__ qmat_buf = qmat.LockedBuffer();</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  DataType *__restrict__ mat_buf = mat.Buffer();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(static)</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (El::Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    El::Int qrow = 2;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">// Extract the averages.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a> tmp = qmat.Get(0, col);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    DataType avg_pos;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    memcpy(&amp;avg_pos, &amp;tmp, <span class="keyword">sizeof</span>(avg_pos));</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    tmp = qmat.Get(1, col);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    DataType avg_neg;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    memcpy(&amp;avg_neg, &amp;tmp, <span class="keyword">sizeof</span>(avg_neg));</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="comment">// Unquantize this column.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">for</span> (El::Int row_chunk = 0; row_chunk &lt; height; row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keyword">auto</span> q = (<a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a>) qmat_buf[qrow + col * qmat_ldim];</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        El::Int row = row_chunk + bit;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">if</span> (row &gt;= height) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        mat_buf[row + col * ldim] += (q &gt;&gt; bit) &amp; 0x1 ? avg_pos : avg_neg;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      ++qrow;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ac8b63c86fc871e248ce20c7af19a7fad"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00059">quantizer.hpp:59</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afcda642ff1b44d31eec910909c3d013e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">El::Int qtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00060">quantizer.hpp:60</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00245">quantizer.hpp:245</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a879cea8464408b8265be9e55edd83b2c_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a879cea8464408b8265be9e55edd83b2c_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a879cea8464408b8265be9e55edd83b2c_icgraph" id="classlbann_1_1lbann__quantizer_a879cea8464408b8265be9e55edd83b2c_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4b326de1ca5b7eba6415b6f42f83335b" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="217,45,381,101"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="430,5,594,61"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#af24e00e26e157f102f3cef547de40ae1" title="lbann::lbann_quantizer\l::intermodel_sum_onebit\l_quantized" alt="" coords="430,85,594,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa5aabc1cb4163e95aee993d9b37b9b32"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">lbann_quantizer::adaptive_thresholds</a> lbann::lbann_quantizer::proportion_threshold </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sample</em> = <code><a class="el" href="namespacelbann.html#aa1002432debb16a265bccfa035b0c582">true</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute positive and negative thresholds such that only one in proportion of values in mat are &gt;= to the positive threshold or &lt;= to the negative threshold. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to compute threshold values for. </td></tr>
    <tr><td class="paramname">qerror</td><td>The accumulated quantization error in mat. </td></tr>
    <tr><td class="paramname">proportion</td><td>Proportion of entries to keep. </td></tr>
    <tr><td class="paramname">sample</td><td>Whether to approximate stats by randomly sampling mat. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The threshold values. </dd></dl>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00500">500</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                                                  {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="keywordtype">double</span> proportion_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  std::vector&lt;DataType&gt; entries;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  <span class="keyword">const</span> El::Int height = mat.Height();</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  <span class="keyword">const</span> El::Int width = mat.Width();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;  <span class="keyword">const</span> El::Int ldim = mat.LDim();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="keyword">const</span> DataType *__restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keyword">const</span> DataType *__restrict__ qerror_buf = qerror.LockedBuffer();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="comment">// Bail out if needed.</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">if</span> (width == 0) {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">return</span> { 0.0f, 0.0f };</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="keywordflow">if</span> (width * height &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a7745dbc282bebe812ff5523a4b3df3f2">NUM_THRESHOLD_SAMPLES</a> || !sample) {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="comment">// Copy entire matrix into vector.</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    entries.reserve(width * height);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">for</span> (El::Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keyword">const</span> El::Int col_offset = col * ldim;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="keywordflow">for</span> (El::Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keyword">const</span> El::Unsigned pos = row + col_offset;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        entries.emplace_back(mat_buf[pos] + qerror_buf[pos]);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    }</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">// Randomly sample entries to approximate everything.</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    entries.reserve(<a class="code" href="classlbann_1_1lbann__quantizer.html#a7745dbc282bebe812ff5523a4b3df3f2">NUM_THRESHOLD_SAMPLES</a>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <a class="code" href="namespacelbann.html#af16616ffa6a3616836eabadd6ce837ec">fast_rng_gen</a>&amp; gen = <a class="code" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">get_fast_generator</a>();</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    std::vector&lt;El::Unsigned&gt; poses(<a class="code" href="classlbann_1_1lbann__quantizer.html#a7745dbc282bebe812ff5523a4b3df3f2">NUM_THRESHOLD_SAMPLES</a>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a7745dbc282bebe812ff5523a4b3df3f2">NUM_THRESHOLD_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <span class="keyword">const</span> El::Unsigned pos = <a class="code" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">fast_rand_int</a>(gen, height) + <a class="code" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">fast_rand_int</a>(gen, width) * ldim;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      __builtin_prefetch(&amp;mat_buf[pos]);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      __builtin_prefetch(&amp;qerror_buf[pos]);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      poses[i] = pos;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a7745dbc282bebe812ff5523a4b3df3f2">NUM_THRESHOLD_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keyword">const</span> El::Unsigned pos = poses[i];</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      entries.emplace_back(mat_buf[pos] + qerror_buf[pos]);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="comment">// Determine the number of entries to keep.</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  El::Int num_to_keep = std::max(1, (<span class="keywordtype">int</span>) entries.size() / proportion);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="comment">// Determine the threshold values.</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="comment">// This finds the num_to_keep&#39;th value if sample were sorted by magnitude</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">// and assigns it to the appropriate threshold, then checks the upper portion</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">// of the partially-sorted vector to find the other threshold.</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">// In the case that the threshold would be 0, it is instead a small non-zero</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="comment">// value.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  DataType pos_thresh = std::numeric_limits&lt;DataType&gt;::max();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  DataType neg_thresh = -std::numeric_limits&lt;DataType&gt;::max();</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keyword">auto</span> i = entries.begin() + (entries.size() - num_to_keep);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  std::nth_element(entries.begin(), i, entries.end(),</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  [] (<span class="keyword">const</span> DataType a, <span class="keyword">const</span> DataType b) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">return</span> std::abs(a) &lt; std::abs(b);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  });</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keywordflow">if</span> (*i &gt; 0) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    pos_thresh = *i;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">for</span> (++i; i &lt; entries.end(); ++i) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="comment">// Find the largest (closest to 0) negative value.</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">if</span> (*i &lt; 0) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        neg_thresh = std::max(neg_thresh, *i);</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*i &lt; 0) {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    neg_thresh = *i;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">for</span> (++i; i &lt; entries.end(); ++i) {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="comment">// Find the smallest (closest to 0) positive value.</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="keywordflow">if</span> (*i &gt; 0) {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        pos_thresh = std::min(pos_thresh, *i);</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  }</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="comment">// If there are no values of a sign, select threshold such that none are sent.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordflow">if</span> (pos_thresh == std::numeric_limits&lt;DataType&gt;::max()) {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    pos_thresh = -neg_thresh;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keywordflow">if</span> (neg_thresh == -std::numeric_limits&lt;DataType&gt;::max()) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    neg_thresh = -pos_thresh;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">proportion_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - proportion_start;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keywordflow">return</span> { pos_thresh, neg_thresh };</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="ttc" id="namespacelbann_html_a557aaed6267e7aaf583a75149e9c670c"><div class="ttname"><a href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">lbann::fast_rand_int</a></div><div class="ttdeci">T fast_rand_int(Generator &amp;g, T max)</div><div class="ttdef"><b>Definition:</b> <a href="random_8hpp_source.html#l00068">random.hpp:68</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a7745dbc282bebe812ff5523a4b3df3f2"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a7745dbc282bebe812ff5523a4b3df3f2">lbann::lbann_quantizer::NUM_THRESHOLD_SAMPLES</a></div><div class="ttdeci">static const El::Int NUM_THRESHOLD_SAMPLES</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00247">quantizer.hpp:247</a></div></div>
<div class="ttc" id="namespacelbann_html_ae6ce9c2fdec6f81803f6b1a6555c31c5"><div class="ttname"><a href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">lbann::get_fast_generator</a></div><div class="ttdeci">fast_rng_gen &amp; get_fast_generator()</div><div class="ttdef"><b>Definition:</b> <a href="random_8cpp_source.html#l00065">random.cpp:65</a></div></div>
<div class="ttc" id="namespacelbann_html_af16616ffa6a3616836eabadd6ce837ec"><div class="ttname"><a href="namespacelbann.html#af16616ffa6a3616836eabadd6ce837ec">lbann::fast_rng_gen</a></div><div class="ttdeci">std::minstd_rand fast_rng_gen</div><div class="ttdef"><b>Definition:</b> <a href="random_8hpp_source.html#l00038">random.hpp:38</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a6bd266728f578df0c86fc2e493742cc1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">lbann::lbann_quantizer::proportion_time</a></div><div class="ttdeci">double proportion_time</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00262">quantizer.hpp:262</a></div></div>
<div class="ttc" id="namespacelbann_html_a478d36031ff0659893c4322cd856157f"><div class="ttname"><a href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">lbann::get_time</a></div><div class="ttdeci">double get_time()</div><div class="ttdef"><b>Definition:</b> <a href="timer_8hpp_source.html#l00037">timer.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_cgraph" id="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_cgraph">
<area shape="rect" id="node2" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="235,5,346,32"/><area shape="rect" id="node3" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="206,56,375,83"/><area shape="rect" id="node4" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="223,107,359,133"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_icgraph" id="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a7e4dfca5770dfd88ae6255b0407d8f80" title="lbann::lbann_quantizer\l::adaptive_quantize" alt="" coords="221,5,373,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a25ed3869c6bc615ae51198803ea4e33d" title="lbann::lbann_quantizer\l::adaptive_quantize_replace" alt="" coords="205,70,389,111"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aee1ea46e3191ad25fd310938eaf5a2e0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::reset_counters </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reset recorded counters. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00234">234</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">proportion_time</a> = 0.0;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a> = 0;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a716fae78ef5ba082a8093f0d06550804"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">lbann::lbann_quantizer::quantized_count</a></div><div class="ttdeci">size_t quantized_count</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00264">quantizer.hpp:264</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a6bd266728f578df0c86fc2e493742cc1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">lbann::lbann_quantizer::proportion_time</a></div><div class="ttdeci">double proportion_time</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00262">quantizer.hpp:262</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aee1ea46e3191ad25fd310938eaf5a2e0_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aee1ea46e3191ad25fd310938eaf5a2e0_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aee1ea46e3191ad25fd310938eaf5a2e0_icgraph" id="classlbann_1_1lbann__quantizer_aee1ea46e3191ad25fd310938eaf5a2e0_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ad45c39a7a85fb8e1d99eca97aa4d9d09" title="lbann::lbann_callback\l_imcomm::do_summary" alt="" coords="205,13,368,54"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914" title="lbann::lbann_quantizer\l::lbann_quantizer" alt="" coords="211,78,363,119"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#a0a425ba562f7637b25cd6ba094e7885b" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="417,5,581,61"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a00106e69ea8a6dfe9e9a91c75b845bcd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Threshold and quantize a matrix. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width())). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">q</td><td>The output list of quantized entries. </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
    <tr><td class="paramname">pos_thresh</td><td>The positive threshold level. </td></tr>
    <tr><td class="paramname">neg_thresh</td><td>The negative threshold level. </td></tr>
    <tr><td class="paramname">delta</td><td>Whether to do delta encoding (default false). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00273">273</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                     {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keyword">const</span> El::Int ldim = mat.LDim();</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keyword">const</span> El::Int width = mat.Width();</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <span class="keyword">const</span> El::Int height = mat.Height();</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">if</span> (ldim != qerror.LDim()) {</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;ldims don&#39;t match!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keyword">const</span> DataType *__restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  DataType *__restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  std::vector&lt;ThreshQuantized&gt; thread_qs(omp_get_max_threads());</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">if</span> (delta) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    El::Unsigned prev_pos = 0;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">for</span> (El::Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">for</span> (El::Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keyword">const</span> El::Unsigned pos = row + col * ldim;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          qerror_buf[pos] = val - pos_thresh;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          <span class="comment">// Delta encode pos.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          quant.emplace_back(((pos - prev_pos) &lt;&lt; 1) | 1);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;          prev_pos = pos;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;          qerror_buf[pos] = val - neg_thresh;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          quant.emplace_back((pos - prev_pos) &lt;&lt; 1);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          prev_pos = pos;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          qerror_buf[pos] = val;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">    #pragma omp parallel</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">      #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">for</span> (El::Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">for</span> (El::Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;          <span class="keyword">const</span> El::Unsigned pos = row + col * ldim;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            qerror_buf[pos] = val - pos_thresh;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            thread_qs[tid].emplace_back((pos &lt;&lt; 1) | 1);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            qerror_buf[pos] = val - neg_thresh;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            thread_qs[tid].emplace_back(pos &lt;&lt; 1);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            qerror_buf[pos] = val;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;          }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    }</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">// Copy the temporary vectors.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; thread_q : thread_qs) {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      quant.insert(quant.end(), thread_q.begin(), thread_q.end());</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;}</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph" id="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#ae9949af6bec1e95adf5a32ba9bb4afd8" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="205,5,357,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae9949af6bec1e95adf5a32ba9bb4afd8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00333">333</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                   {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">threshold_quantize</a>(mat.LockedMatrix(), q, qerror, pos_thresh, neg_thresh,</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                     delta);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a00106e69ea8a6dfe9e9a91c75b845bcd"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">lbann::lbann_quantizer::threshold_quantize</a></div><div class="ttdeci">void threshold_quantize(const Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, bool delta=false)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00273">quantizer.cpp:273</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph" id="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="205,5,357,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2bcdf31781bf72bbe63940ea0d92990f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize_apply </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; El::Unsigned &gt; &amp;&#160;</td>
          <td class="paramname"><em>positions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Quantize only the locations in mat in positions; the companion of threshold_unquantize_apply. </p>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00416">416</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                                                     {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="keyword">const</span> DataType *__restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  DataType *__restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="keywordflow">if</span> (delta) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// Need to sort so positions are in order, otherwise our delta encoding</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// doesn&#39;t work. (Could be solved by adding stops, but maybe not worth it.)</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    std::sort(positions.begin(), positions.end());</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    El::Unsigned prev_pos = 0;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pos : positions) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        qerror_buf[pos] = val - pos_thresh;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        quant.emplace_back(((pos - prev_pos) &lt;&lt; 1) | 1);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        prev_pos = pos;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        qerror_buf[pos] = val - neg_thresh;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        quant.emplace_back((pos - prev_pos) &lt;&lt; 1);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        prev_pos = pos;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        qerror_buf[pos] = val;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      }</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pos : positions) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keyword">const</span> DataType val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        quant.emplace_back((pos &lt;&lt; 1) | 1);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        qerror_buf[pos] = val - pos_thresh;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        quant.emplace_back(pos &lt;&lt; 1);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        qerror_buf[pos] = val - neg_thresh;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        qerror_buf[pos] = val;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0f5f3b0149715ab59202b8884a87c7d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize a thresholded-and-quantized matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">q</td><td>The quantized matrix. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
    <tr><td class="paramname">pos_thresh</td><td>The positive threshold value. </td></tr>
    <tr><td class="paramname">neg_thresh</td><td>The negative negative value. </td></tr>
    <tr><td class="paramname">delta</td><td>Whether q was quantized with delta encoding (default false). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00340">340</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                   {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  DataType *__restrict__ buf = mat.Buffer();</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordflow">if</span> (delta) {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    El::Unsigned prev_pos = 0;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; quant.size(); ++i) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a> q = quant[i];</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keyword">const</span> El::Unsigned pos = (q &gt;&gt; 1) + prev_pos;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      prev_pos = pos;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        buf[pos] = pos_thresh;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        buf[pos] = neg_thresh;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor">    #pragma omp parallel for schedule(static)</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; quant.size(); ++i) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a> q = quant[i];</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keyword">const</span> El::Unsigned pos = q &gt;&gt; 1;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        buf[pos] = pos_thresh;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        buf[pos] = neg_thresh;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ac8b63c86fc871e248ce20c7af19a7fad"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00059">quantizer.hpp:59</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph" id="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a2324bba3cbb6c0d3e51bbe21555e7f1a" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="209,5,362,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2324bba3cbb6c0d3e51bbe21555e7f1a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a0fab5387556805cfeac3e7e567bf66c5">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00370">370</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                   {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a>(quant, mat.Matrix(), pos_thresh, neg_thresh, delta);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0f5f3b0149715ab59202b8884a87c7d5"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">lbann::lbann_quantizer::threshold_unquantize</a></div><div class="ttdeci">void threshold_unquantize(const ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_thresh, DataType neg_thresh, bool delta=false)</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8cpp_source.html#l00340">quantizer.cpp:340</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph" id="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="209,5,362,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab12b432ba2901347b025e8b6ec40a3c6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize_apply </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a85ea8e298c2975b4f802855278406aa7">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="base_8hpp.html#a68f11fdc31b62516cb310831bbe54d73">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; El::Unsigned &gt; &amp;&#160;</td>
          <td class="paramname"><em>positions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Do threshold unquantization from arbitrary locations, adding the unquantized values to existing ones instead of replacing them, and storing the locations applied. </p>

<p>Definition at line <a class="el" href="quantizer_8cpp_source.html#l00376">376</a> of file <a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                                                     {</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">// A general note on positions that I&#39;m putting here because I&#39;m not sure</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">// where else to: Using a vector admits the possibility that we have</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="comment">// duplicate entries. This could be fixed by using an unordered_set, but when</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="comment">// I benchmarked this, it increased our runtime by ~5 times. Having duplicate</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="comment">// entries should not change the final result: it means that</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">// threshold_quantize_apply may quantize the same entry multiple times, but</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// the final unquantize is not an _apply, and so will just set that entry to</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// the same value multiple times. We send some extra data, but the overhead</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">// is small.</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  DataType *__restrict__ buf = mat.Buffer();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">if</span> (delta) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    El::Unsigned prev_pos = 0;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; quant.size(); ++i) {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a> q = quant[i];</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keyword">const</span> El::Unsigned pos = (q &gt;&gt; 1) + prev_pos;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      prev_pos = pos;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      positions.emplace_back(pos);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        buf[pos] += pos_thresh;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        buf[pos] += neg_thresh;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">for</span> (El::Unsigned i = 0; i &lt; quant.size(); ++i) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">uqtype</a> q = quant[i];</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keyword">const</span> El::Unsigned pos = q &gt;&gt; 1;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      positions.emplace_back(pos);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        buf[pos] += pos_thresh;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        buf[pos] += neg_thresh;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ac8b63c86fc871e248ce20c7af19a7fad"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ac8b63c86fc871e248ce20c7af19a7fad">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="quantizer_8hpp_source.html#l00059">quantizer.hpp:59</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="afb4315625e371169cabfac56c3f75d37"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int lbann::lbann_quantizer::HEADER_FACTOR = 3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Factor used when computing header lengths in adaptive quantization. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00256">256</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="abe63d57e62be1b498848f7920de4433a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const El::Int lbann::lbann_quantizer::MAX_QUANTIZED_EXCESS = 4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Max factor by which adaptive quantization can exceed optimal amount. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00259">259</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a33ea17392f53b90e91aea1ffb7e11d68"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t lbann::lbann_quantizer::NUM_BITS = sizeof(<a class="el" href="classlbann_1_1lbann__quantizer.html#afcda642ff1b44d31eec910909c3d013e">qtype</a>) * 8</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of bits per quantized word. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00245">245</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a8e25785452736c54861a69207a48252d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const El::Int lbann::lbann_quantizer::NUM_ONEBIT_SAMPLES = 128</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Samples to use to approximate column averages in onebit quantization. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00251">251</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a10667e56db4218aac3912c6bae28fc41"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const El::Int lbann::lbann_quantizer::NUM_RECON_SAMPLES = 128</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of samples to use in col_reconstruction. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00249">249</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7745dbc282bebe812ff5523a4b3df3f2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const El::Int lbann::lbann_quantizer::NUM_THRESHOLD_SAMPLES = 1024</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of samples to use in proportion_threshold. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00247">247</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6bd266728f578df0c86fc2e493742cc1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::proportion_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in proportion_threshold. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00262">262</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a716fae78ef5ba082a8093f0d06550804"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::quantized_count</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Most recent number of quantized entries. </p>

<p>Definition at line <a class="el" href="quantizer_8hpp_source.html#l00264">264</a> of file <a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/travis/build/LLNL/lbann/include/lbann/utils/<a class="el" href="quantizer_8hpp_source.html">quantizer.hpp</a></li>
<li>/home/travis/build/LLNL/lbann/src/utils/<a class="el" href="quantizer_8cpp_source.html">quantizer.cpp</a></li>
<li>/home/travis/build/LLNL/lbann/include/lbann/utils/<a class="el" href="quantizer__impl_8hpp_source.html">quantizer_impl.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacelbann.html">lbann</a></li><li class="navelem"><a class="el" href="classlbann_1_1lbann__quantizer.html">lbann_quantizer</a></li>
    <li class="footer">Generated on Fri May 11 2018 08:30:04 for LBANN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
