<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LBANN: lbann::lbann_quantizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LBANN
   &#160;<span id="projectnumber">5f0dad8-ci229457743</span>
   </div>
   <div id="projectbrief">LivermoreBigArtificialNeuralNetworkToolkit</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classlbann_1_1lbann__quantizer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classlbann_1_1lbann__quantizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">lbann::lbann_quantizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__reconstructions.html">adaptive_reconstructions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">adaptive_thresholds</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a018cddfc9b73d94c2d60bdd7a11a0079"><td class="memItemLeft" align="right" valign="top">typedef El::Unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a></td></tr>
<tr class="separator:a018cddfc9b73d94c2d60bdd7a11a0079"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab93df328abd13df0403d7483c8edfa89"><td class="memItemLeft" align="right" valign="top">typedef El::Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a></td></tr>
<tr class="separator:ab93df328abd13df0403d7483c8edfa89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f0b1c91b994c91dfa506869e3329db6"><td class="memItemLeft" align="right" valign="top">typedef El::Matrix&lt; <a class="el" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a></td></tr>
<tr class="separator:a2f0b1c91b994c91dfa506869e3329db6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84c968d0f772235faa39f6ad91e7eadb"><td class="memItemLeft" align="right" valign="top">typedef std::vector&lt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a></td></tr>
<tr class="separator:a84c968d0f772235faa39f6ad91e7eadb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a8cdad444da3fa7230416d163ebdda1"><td class="memItemLeft" align="right" valign="top">typedef std::vector&lt; uint32_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9a8cdad444da3fa7230416d163ebdda1">ThreshQuantized32</a></td></tr>
<tr class="separator:a9a8cdad444da3fa7230416d163ebdda1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b8d3075d732a292bc24fa113cc3a0a0"><td class="memItemLeft" align="right" valign="top">typedef std::vector&lt; uint64_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a1b8d3075d732a292bc24fa113cc3a0a0">ThreshQuantized64</a></td></tr>
<tr class="separator:a1b8d3075d732a292bc24fa113cc3a0a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a430cd47f333c678d2cb77f4ab2693914"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914">lbann_quantizer</a> ()</td></tr>
<tr class="separator:a430cd47f333c678d2cb77f4ab2693914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0cc07008ff963949c2cb7b91786c61c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ac0cc07008ff963949c2cb7b91786c61c">~lbann_quantizer</a> ()</td></tr>
<tr class="separator:ac0cc07008ff963949c2cb7b91786c61c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55d3136bd05809271643a056cd990d24"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a55d3136bd05809271643a056cd990d24">intermodel_sum</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat)</td></tr>
<tr class="separator:a55d3136bd05809271643a056cd990d24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa711b0b2de0ccd9265f66304dee26606"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa711b0b2de0ccd9265f66304dee26606">intermodel_sum</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat)</td></tr>
<tr class="separator:aa711b0b2de0ccd9265f66304dee26606"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3801d9cd1a1adefb160b69dbd7e499ef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, bool sample=true)</td></tr>
<tr class="separator:a3801d9cd1a1adefb160b69dbd7e499ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa516ede3d1fd798bb5ef5c2cf28cb53d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa516ede3d1fd798bb5ef5c2cf28cb53d">quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, bool sample=true)</td></tr>
<tr class="separator:aa516ede3d1fd798bb5ef5c2cf28cb53d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46b83f4012a8d14a62bbfe79a9c4ede5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5">unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat)</td></tr>
<tr class="separator:a46b83f4012a8d14a62bbfe79a9c4ede5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d3469fdcca399c8cc12f11d900e2c8e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a6d3469fdcca399c8cc12f11d900e2c8e">unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat)</td></tr>
<tr class="separator:a6d3469fdcca399c8cc12f11d900e2c8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97db186341c0819c8d52e2f815deb2a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7">intermodel_sum_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool do_adagrad=<a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *gradhist=nullptr)</td></tr>
<tr class="separator:a97db186341c0819c8d52e2f815deb2a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4877befb2683f16a03fdf91ed1353636"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636">intermodel_sum_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool do_adagrad=<a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *gradhist=nullptr)</td></tr>
<tr class="separator:a4877befb2683f16a03fdf91ed1353636"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00106e69ea8a6dfe9e9a91c75b845bcd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">threshold_quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, bool delta=<a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a>)</td></tr>
<tr class="separator:a00106e69ea8a6dfe9e9a91c75b845bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9949af6bec1e95adf5a32ba9bb4afd8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae9949af6bec1e95adf5a32ba9bb4afd8">threshold_quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, bool delta=<a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a>)</td></tr>
<tr class="separator:ae9949af6bec1e95adf5a32ba9bb4afd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f5f3b0149715ab59202b8884a87c7d5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, bool delta=<a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a>)</td></tr>
<tr class="separator:a0f5f3b0149715ab59202b8884a87c7d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2324bba3cbb6c0d3e51bbe21555e7f1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2324bba3cbb6c0d3e51bbe21555e7f1a">threshold_unquantize</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, bool delta=<a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a>)</td></tr>
<tr class="separator:a2324bba3cbb6c0d3e51bbe21555e7f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1d5338e2e1682156e4f654b110be70d"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:af1d5338e2e1682156e4f654b110be70d"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af1d5338e2e1682156e4f654b110be70d">adaptive_threshold_quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, std::vector&lt; rowT &gt; &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:af1d5338e2e1682156e4f654b110be70d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1e9dc46de4c29a6ae7867b61107ba10"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:af1e9dc46de4c29a6ae7867b61107ba10"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af1e9dc46de4c29a6ae7867b61107ba10">adaptive_threshold_quantize</a> (const <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat, std::vector&lt; rowT &gt; &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:af1e9dc46de4c29a6ae7867b61107ba10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa255344d87e8aa9e889aa626ac1b4c81"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:aa255344d87e8aa9e889aa626ac1b4c81"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa255344d87e8aa9e889aa626ac1b4c81">adaptive_threshold_unquantize</a> (const std::vector&lt; rowT &gt; &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat)</td></tr>
<tr class="separator:aa255344d87e8aa9e889aa626ac1b4c81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addabdd44f5cb2edbc440591e0c614b0a"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:addabdd44f5cb2edbc440591e0c614b0a"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#addabdd44f5cb2edbc440591e0c614b0a">adaptive_threshold_unquantize</a> (const std::vector&lt; rowT &gt; &amp;q, <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat)</td></tr>
<tr class="separator:addabdd44f5cb2edbc440591e0c614b0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cf9d4cd5262b21939e95fc34ad0a09f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f">intermodel_sum_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr class="separator:a4cf9d4cd5262b21939e95fc34ad0a09f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae99dc11003cecd04e599d68c99d90c0b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b">intermodel_sum_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr class="separator:ae99dc11003cecd04e599d68c99d90c0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af51ff97c4c81fe027a6fa1b0d03107f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af51ff97c4c81fe027a6fa1b0d03107f7">intermodel_sum_adaptive_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror)</td></tr>
<tr class="separator:af51ff97c4c81fe027a6fa1b0d03107f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17ac196d3ccc93137ae03f8451fea4b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a17ac196d3ccc93137ae03f8451fea4b8">intermodel_sum_adaptive_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror)</td></tr>
<tr class="separator:a17ac196d3ccc93137ae03f8451fea4b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8d07c3ffddff08800887dff354ffed2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq)</td></tr>
<tr class="separator:ad8d07c3ffddff08800887dff354ffed2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb58d63b174c3a937f3c3b21eb269b77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q)</td></tr>
<tr class="separator:afb58d63b174c3a937f3c3b21eb269b77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5aabc1cb4163e95aee993d9b37b9b32"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">adaptive_thresholds</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">proportion_threshold</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, bool sample=true)</td></tr>
<tr class="separator:aa5aabc1cb4163e95aee993d9b37b9b32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa58689369b5b3898b75b7b31ca574b38"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__reconstructions.html">adaptive_reconstructions</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa58689369b5b3898b75b7b31ca574b38">col_reconstruction</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, Int col, const <a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">adaptive_thresholds</a> threshes, bool sample=true)</td></tr>
<tr class="separator:aa58689369b5b3898b75b7b31ca574b38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad318aefe6f75c8d68363affce55f6190"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad318aefe6f75c8d68363affce55f6190">get_bytes_sent</a> () const </td></tr>
<tr class="separator:ad318aefe6f75c8d68363affce55f6190"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c1b69b38cf93d43e9b4eca7d4c5e28f"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2c1b69b38cf93d43e9b4eca7d4c5e28f">get_rs_bytes_sent</a> () const </td></tr>
<tr class="separator:a2c1b69b38cf93d43e9b4eca7d4c5e28f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c64c6960852ca25f81ba7bc80c05d2d"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a6c64c6960852ca25f81ba7bc80c05d2d">get_ag_bytes_sent</a> () const </td></tr>
<tr class="separator:a6c64c6960852ca25f81ba7bc80c05d2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a029f692e679ac4475a51fa2ac8f7c1"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9a029f692e679ac4475a51fa2ac8f7c1">get_bytes_received</a> () const </td></tr>
<tr class="separator:a9a029f692e679ac4475a51fa2ac8f7c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeefaa02ea30dc89f58420e019950207f"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aeefaa02ea30dc89f58420e019950207f">get_rs_bytes_received</a> () const </td></tr>
<tr class="separator:aeefaa02ea30dc89f58420e019950207f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9befb796840b21d1238e8169421005f9"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9befb796840b21d1238e8169421005f9">get_ag_bytes_received</a> () const </td></tr>
<tr class="separator:a9befb796840b21d1238e8169421005f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa32b747b7ac0dbea8df3b47593d54b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afa32b747b7ac0dbea8df3b47593d54b7">reset_bytes_counters</a> ()</td></tr>
<tr class="separator:afa32b747b7ac0dbea8df3b47593d54b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4484f37237d53c4992d00698b72fd45f"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4484f37237d53c4992d00698b72fd45f">get_rs_time</a> () const </td></tr>
<tr class="separator:a4484f37237d53c4992d00698b72fd45f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affd6ee0a9c259ba5999c8f18ee7a58a7"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#affd6ee0a9c259ba5999c8f18ee7a58a7">get_ag_time</a> () const </td></tr>
<tr class="separator:affd6ee0a9c259ba5999c8f18ee7a58a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea9f348cd6f48b706870e1a5e48e8827"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aea9f348cd6f48b706870e1a5e48e8827">get_rs_send_trans_time</a> () const </td></tr>
<tr class="separator:aea9f348cd6f48b706870e1a5e48e8827"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12b8e87e51866a6b028b8dbd4faebe55"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a12b8e87e51866a6b028b8dbd4faebe55">get_rs_recv_buf_time</a> () const </td></tr>
<tr class="separator:a12b8e87e51866a6b028b8dbd4faebe55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5f4f573c3ed285265e9d7834446b3a0"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae5f4f573c3ed285265e9d7834446b3a0">get_rs_recv_trans_time</a> () const </td></tr>
<tr class="separator:ae5f4f573c3ed285265e9d7834446b3a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf13fdd86351a63f8765eb7d36494d03"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aaf13fdd86351a63f8765eb7d36494d03">get_rs_send_time</a> () const </td></tr>
<tr class="separator:aaf13fdd86351a63f8765eb7d36494d03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab42d987061378cff2d4e5918ceb7e94c"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ab42d987061378cff2d4e5918ceb7e94c">get_rs_recv_wait_time</a> () const </td></tr>
<tr class="separator:ab42d987061378cff2d4e5918ceb7e94c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a983b603f83ebdaee5eb924ca0d6495b9"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a983b603f83ebdaee5eb924ca0d6495b9">get_ag_reduced_trans_time</a> () const </td></tr>
<tr class="separator:a983b603f83ebdaee5eb924ca0d6495b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54a63a467a16d24c12010edcf8b28f03"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a54a63a467a16d24c12010edcf8b28f03">get_ag_recv_buf_time</a> () const </td></tr>
<tr class="separator:a54a63a467a16d24c12010edcf8b28f03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebc22819c53ce8a836bd20e938f6c59e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aebc22819c53ce8a836bd20e938f6c59e">get_ag_recv_trans_time</a> () const </td></tr>
<tr class="separator:aebc22819c53ce8a836bd20e938f6c59e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74d934a5d2e9a8e33e95e631a5f5dcb1"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a74d934a5d2e9a8e33e95e631a5f5dcb1">get_ag_send_time</a> () const </td></tr>
<tr class="separator:a74d934a5d2e9a8e33e95e631a5f5dcb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a882dcd266f67f98d5dfdf339edb8c31e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a882dcd266f67f98d5dfdf339edb8c31e">get_ag_recv_wait_time</a> () const </td></tr>
<tr class="separator:a882dcd266f67f98d5dfdf339edb8c31e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b9d72b9133517e0212f73908a576c7e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a5b9d72b9133517e0212f73908a576c7e">get_proportion_time</a> () const </td></tr>
<tr class="separator:a5b9d72b9133517e0212f73908a576c7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdba3762c51a2820f70adba32169f57b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#abdba3762c51a2820f70adba32169f57b">reset_time_counters</a> ()</td></tr>
<tr class="separator:abdba3762c51a2820f70adba32169f57b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d9f7cc689b44935a347ff0b7e3d1820"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0d9f7cc689b44935a347ff0b7e3d1820">get_quantized_count</a> () const </td></tr>
<tr class="separator:a0d9f7cc689b44935a347ff0b7e3d1820"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ab91c3defbec372e4b5c35db7dfe522b0"><td class="memItemLeft" align="right" valign="top">Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0">get_quantized_matrix_height</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat) const </td></tr>
<tr class="separator:ab91c3defbec372e4b5c35db7dfe522b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1e0ef48887b28d16e22efcd215b4d8a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa1e0ef48887b28d16e22efcd215b4d8a">unquantize_add</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat)</td></tr>
<tr class="separator:aa1e0ef48887b28d16e22efcd215b4d8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6336263dbcf910503df46e1ae36c7a9b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a6336263dbcf910503df46e1ae36c7a9b">threshold_unquantize_apply</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, std::vector&lt; Unsigned &gt; &amp;positions, bool delta=<a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a>)</td></tr>
<tr class="separator:a6336263dbcf910503df46e1ae36c7a9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a616ff1a37dcf931a5eb6bd36ec9c395e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a616ff1a37dcf931a5eb6bd36ec9c395e">threshold_quantize_apply</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, std::vector&lt; Unsigned &gt; &amp;positions, bool delta=<a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a>)</td></tr>
<tr class="separator:a616ff1a37dcf931a5eb6bd36ec9c395e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4551fb3f9423f8a41248628f739337e6"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a4551fb3f9423f8a41248628f739337e6"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4551fb3f9423f8a41248628f739337e6">adaptive_threshold_unquantize_add</a> (const std::vector&lt; rowT &gt; &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat)</td></tr>
<tr class="separator:a4551fb3f9423f8a41248628f739337e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1fe245c411c515540f9d0ac289f2203"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:ad1fe245c411c515540f9d0ac289f2203"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad1fe245c411c515540f9d0ac289f2203">adaptive_threshold_quantize_replace</a> (<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, std::vector&lt; rowT &gt; &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:ad1fe245c411c515540f9d0ac289f2203"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30825c7e6f42ad2d9dad842fad41f237"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a30825c7e6f42ad2d9dad842fad41f237"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a30825c7e6f42ad2d9dad842fad41f237">adaptive_threshold_bound</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, std::vector&lt; rowT &gt; &amp;q, int proportion)</td></tr>
<tr class="separator:a30825c7e6f42ad2d9dad842fad41f237"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10ecb0a087bc5330129e471b6a2fb8da"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a10ecb0a087bc5330129e471b6a2fb8da"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a10ecb0a087bc5330129e471b6a2fb8da">adaptive_threshold_quantize_slice</a> (const std::vector&lt; rowT &gt; &amp;q, const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, std::vector&lt; rowT &gt; &amp;slice, colT start, colT end, int proportion)</td></tr>
<tr class="separator:a10ecb0a087bc5330129e471b6a2fb8da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e44697cb293e422ee42f4dfcb07a25c"><td class="memTemplParams" colspan="2">template&lt;typename colT , typename rowT &gt; </td></tr>
<tr class="memitem:a8e44697cb293e422ee42f4dfcb07a25c"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a8e44697cb293e422ee42f4dfcb07a25c">intermodel_sum_adaptive_threshold_quantized_impl</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, std::unordered_map&lt; Int, std::vector&lt; rowT &gt;&gt; &amp;adaptive_recv_bufs1, std::unordered_map&lt; Int, std::vector&lt; rowT &gt;&gt; &amp;adaptive_recv_bufs2)</td></tr>
<tr class="separator:a8e44697cb293e422ee42f4dfcb07a25c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2b9b9ef877eaa51a1320030cc97f200"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae2b9b9ef877eaa51a1320030cc97f200">compress_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, ThreshQuantized::const_iterator qstart, ThreshQuantized::const_iterator qend, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq)</td></tr>
<tr class="separator:ae2b9b9ef877eaa51a1320030cc97f200"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad80eac1e1fe0847b52a039ec9f1c8c7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aad80eac1e1fe0847b52a039ec9f1c8c7">uncompress_thresholds</a> (const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq, ThreshQuantized::const_iterator cqstart, ThreshQuantized::const_iterator cqend, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q)</td></tr>
<tr class="separator:aad80eac1e1fe0847b52a039ec9f1c8c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa0c20f755437130172c40ca8e95bc3f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a> (El::Int width)</td></tr>
<tr class="separator:aaa0c20f755437130172c40ca8e95bc3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22b898932caed41ccf24abcb67c00ba1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">get_adaptive_quantization_copy_threads</a> (El::Int width)</td></tr>
<tr class="separator:a22b898932caed41ccf24abcb67c00ba1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad56a9a2d4a56c0dd252fdfbefaff50f8"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ad56a9a2d4a56c0dd252fdfbefaff50f8"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad56a9a2d4a56c0dd252fdfbefaff50f8">intermodel_pairwise_exchange_reduce_scatter</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool var_recv, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, IR, IR, int &amp;)&gt; send_trans, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; recv_trans)</td></tr>
<tr class="separator:ad56a9a2d4a56c0dd252fdfbefaff50f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdfe2509be7c3761f4b98dfce03b18a6"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:acdfe2509be7c3761f4b98dfce03b18a6"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#acdfe2509be7c3761f4b98dfce03b18a6">intermodel_ring_allgather</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool var_recv, std::function&lt; void(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; reduced_trans, std::function&lt; T *(int &amp;)&gt; get_send_buf, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; recv_trans, std::function&lt; void(T *, T *)&gt; swap_bufs)</td></tr>
<tr class="separator:acdfe2509be7c3761f4b98dfce03b18a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4aba2f6afde9ebf4d8775554b19285d"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ab4aba2f6afde9ebf4d8775554b19285d"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ab4aba2f6afde9ebf4d8775554b19285d">intermodel_recursive_doubling_allreduce</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt; send_trans, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; recv_trans, std::function&lt; void(T *, T *)&gt; swap_bufs)</td></tr>
<tr class="separator:ab4aba2f6afde9ebf4d8775554b19285d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a484e392b671e8eeaa3af5b5faa683bee"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a></td></tr>
<tr class="separator:a484e392b671e8eeaa3af5b5faa683bee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a9e25785189c84ba5a7fe055382ca92"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a></td></tr>
<tr class="separator:a3a9e25785189c84ba5a7fe055382ca92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b02b1adbc432e0d5b417ad6e098ed75"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a></td></tr>
<tr class="separator:a9b02b1adbc432e0d5b417ad6e098ed75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae29843bccd4f211f36f4dd357a066a5d"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a></td></tr>
<tr class="separator:ae29843bccd4f211f36f4dd357a066a5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa25d9dbcc7af16370142f46a6c23d178"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a></td></tr>
<tr class="separator:aa25d9dbcc7af16370142f46a6c23d178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d3c330826fbaff8ee38f4b05cafa84a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">ag_time</a></td></tr>
<tr class="separator:a4d3c330826fbaff8ee38f4b05cafa84a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a824b8b6d8964621e6a02aee94c38332a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a></td></tr>
<tr class="separator:a824b8b6d8964621e6a02aee94c38332a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7fa4275835362b7d9ec91201f4f73436"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a></td></tr>
<tr class="separator:a7fa4275835362b7d9ec91201f4f73436"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81db6fb79472d86023dd470c2948ea5a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a></td></tr>
<tr class="separator:a81db6fb79472d86023dd470c2948ea5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a961b2b067876adef034c3bd075d13925"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a961b2b067876adef034c3bd075d13925">rs_send_time</a></td></tr>
<tr class="separator:a961b2b067876adef034c3bd075d13925"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa064118f6206f6ac61308e290a1b459"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afa064118f6206f6ac61308e290a1b459">rs_recv_wait_time</a></td></tr>
<tr class="separator:afa064118f6206f6ac61308e290a1b459"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e997657d1164ed23f912809492d8999"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">ag_reduced_trans_time</a></td></tr>
<tr class="separator:a0e997657d1164ed23f912809492d8999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b7575ba8c4c3c2fcd7ea7e668c02178"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a></td></tr>
<tr class="separator:a0b7575ba8c4c3c2fcd7ea7e668c02178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9258429db2bb93e7f42e7b8573d83225"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a></td></tr>
<tr class="separator:a9258429db2bb93e7f42e7b8573d83225"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab74ab07fa1c26bcf29d9d8bf267905a4"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ab74ab07fa1c26bcf29d9d8bf267905a4">ag_send_time</a></td></tr>
<tr class="separator:ab74ab07fa1c26bcf29d9d8bf267905a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64b9d2a56f4f2c64482377104d26c1f0"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a64b9d2a56f4f2c64482377104d26c1f0">ag_recv_wait_time</a></td></tr>
<tr class="separator:a64b9d2a56f4f2c64482377104d26c1f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bd266728f578df0c86fc2e493742cc1"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">proportion_time</a></td></tr>
<tr class="separator:a6bd266728f578df0c86fc2e493742cc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a716fae78ef5ba082a8093f0d06550804"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a></td></tr>
<tr class="separator:a716fae78ef5ba082a8093f0d06550804"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c040e0ac664033c11be7508b748ab9e"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; Int, <br class="typebreak"/>
std::vector&lt; uint16_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a1c040e0ac664033c11be7508b748ab9e">adaptive_recv16_bufs1</a></td></tr>
<tr class="separator:a1c040e0ac664033c11be7508b748ab9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30dbfa80352a74ef679621aec49baa03"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; Int, <br class="typebreak"/>
std::vector&lt; uint16_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a30dbfa80352a74ef679621aec49baa03">adaptive_recv16_bufs2</a></td></tr>
<tr class="separator:a30dbfa80352a74ef679621aec49baa03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebbc279d18ea35693ce5bbcb22c0b9e6"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; Int, <br class="typebreak"/>
std::vector&lt; uint32_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aebbc279d18ea35693ce5bbcb22c0b9e6">adaptive_recv32_bufs1</a></td></tr>
<tr class="separator:aebbc279d18ea35693ce5bbcb22c0b9e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38765ea10abe26432832e91da9f3adc0"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; Int, <br class="typebreak"/>
std::vector&lt; uint32_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a38765ea10abe26432832e91da9f3adc0">adaptive_recv32_bufs2</a></td></tr>
<tr class="separator:a38765ea10abe26432832e91da9f3adc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a487b6490b8452e85fce46c8c1b75ec7b"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; Int, <br class="typebreak"/>
std::vector&lt; uint64_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a487b6490b8452e85fce46c8c1b75ec7b">adaptive_recv64_bufs1</a></td></tr>
<tr class="separator:a487b6490b8452e85fce46c8c1b75ec7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24ba8dd73278f8b10410fa7e6dec676f"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; Int, <br class="typebreak"/>
std::vector&lt; uint64_t &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a24ba8dd73278f8b10410fa7e6dec676f">adaptive_recv64_bufs2</a></td></tr>
<tr class="separator:a24ba8dd73278f8b10410fa7e6dec676f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a33ea17392f53b90e91aea1ffb7e11d68"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> = sizeof(<a class="el" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a>) * 8</td></tr>
<tr class="separator:a33ea17392f53b90e91aea1ffb7e11d68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad98118c77f676fa3d3fb4ba27b814070"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> = 128</td></tr>
<tr class="separator:ad98118c77f676fa3d3fb4ba27b814070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f645c840854c584c9224af063fee23b"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> = 7</td></tr>
<tr class="separator:a5f645c840854c584c9224af063fee23b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada4c3ff82169a90e0c59db80f0768711"><td class="memItemLeft" align="right" valign="top">static const Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ada4c3ff82169a90e0c59db80f0768711">NUM_THRESHOLD_SAMPLES</a> = 1024</td></tr>
<tr class="separator:ada4c3ff82169a90e0c59db80f0768711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6e99d098a4d4c1488241b3484132904"><td class="memItemLeft" align="right" valign="top">static const Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad6e99d098a4d4c1488241b3484132904">NUM_RECON_SAMPLES</a> = 128</td></tr>
<tr class="separator:ad6e99d098a4d4c1488241b3484132904"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37f0c719ced064cfe80dacfa90b4a0b6"><td class="memItemLeft" align="right" valign="top">static const Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a37f0c719ced064cfe80dacfa90b4a0b6">NUM_ONEBIT_SAMPLES</a> = 128</td></tr>
<tr class="separator:a37f0c719ced064cfe80dacfa90b4a0b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb4315625e371169cabfac56c3f75d37"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> = 3</td></tr>
<tr class="separator:afb4315625e371169cabfac56c3f75d37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bbd160584fc34cf42cfd8c38752b7bd"><td class="memItemLeft" align="right" valign="top">static const Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4bbd160584fc34cf42cfd8c38752b7bd">MAX_QUANTIZED_EXCESS</a> = 4</td></tr>
<tr class="separator:a4bbd160584fc34cf42cfd8c38752b7bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Support different kinds of quantization. Relevant references: "1-Bit Stochastic Gradient Descent and its Application to Data-Parallel
Distributed Training of Speech DNNs" by Frank Seide et al. (MSR) "Scalable Distributed DNN Training Using Commodity GPU Cloud Computing" by Nikko Strom. (Amazon) "Communication Quantization for Data-parallel Training of Deep Neural
Networks" by Nikoli Dryden et al. (LLNL/UIUC) </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00057">57</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="ab93df328abd13df0403d7483c8edfa89"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef El::Int <a class="el" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">lbann::lbann_quantizer::qtype</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00062">62</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2f0b1c91b994c91dfa506869e3329db6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef El::Matrix&lt;<a class="el" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a>&gt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">lbann::lbann_quantizer::QuantizedMatrix</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This represents a quantized version of a matrix. Each column is quantized separately. The first two entries are floats representing the positive and negative averages for the column (used in dequantizion). The rest is one-bit quantized entries. Quantization is by column to keep averages nice and because Elemental uses column-major ordering. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00071">71</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a84c968d0f772235faa39f6ad91e7eadb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::vector&lt;<a class="el" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>&gt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">lbann::lbann_quantizer::ThreshQuantized</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00072">72</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9a8cdad444da3fa7230416d163ebdda1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::vector&lt;uint32_t&gt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a9a8cdad444da3fa7230416d163ebdda1">lbann::lbann_quantizer::ThreshQuantized32</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00073">73</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a1b8d3075d732a292bc24fa113cc3a0a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::vector&lt;uint64_t&gt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a1b8d3075d732a292bc24fa113cc3a0a0">lbann::lbann_quantizer::ThreshQuantized64</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00074">74</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a018cddfc9b73d94c2d60bdd7a11a0079"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef El::Unsigned <a class="el" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>We require that sizeof(DataType) &lt;= sizeof(qtype) == sizeof(uqtype). </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00061">61</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a430cd47f333c678d2cb77f4ab2693914"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::lbann_quantizer::lbann_quantizer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00037">37</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                                 {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#afa32b747b7ac0dbea8df3b47593d54b7">reset_bytes_counters</a>();</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#abdba3762c51a2820f70adba32169f57b">reset_time_counters</a>();</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a> = 0;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a716fae78ef5ba082a8093f0d06550804"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">lbann::lbann_quantizer::quantized_count</a></div><div class="ttdeci">size_t quantized_count</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00379">lbann_quantizer.hpp:379</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_abdba3762c51a2820f70adba32169f57b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#abdba3762c51a2820f70adba32169f57b">lbann::lbann_quantizer::reset_time_counters</a></div><div class="ttdeci">void reset_time_counters()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00301">lbann_quantizer.hpp:301</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afa32b747b7ac0dbea8df3b47593d54b7"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afa32b747b7ac0dbea8df3b47593d54b7">lbann::lbann_quantizer::reset_bytes_counters</a></div><div class="ttdeci">void reset_bytes_counters()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00268">lbann_quantizer.hpp:268</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph" id="classlbann_1_1lbann__quantizer_a430cd47f333c678d2cb77f4ab2693914_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#afa32b747b7ac0dbea8df3b47593d54b7" title="lbann::lbann_quantizer\l::reset_bytes_counters" alt="" coords="205,5,360,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#abdba3762c51a2820f70adba32169f57b" title="lbann::lbann_quantizer\l::reset_time_counters" alt="" coords="207,70,359,111"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac0cc07008ff963949c2cb7b91786c61c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::lbann_quantizer::~lbann_quantizer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00043">43</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                  {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a30825c7e6f42ad2d9dad842fad41f237"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_bound </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Ensure that q is no more than a factor of MAX_QUANTIZED_EXCESS larger than optimal. </p>

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00394">394</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                                                   {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>),</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* <span class="keyword">const</span> __restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="keyword">const</span> colT width = mat.Width();</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width +</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    row_header_factor;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keyword">const</span> colT num_quantized = q.size() - header_len;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  colT* q_col = (colT*) q.data();</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">if</span> (num_quantized &gt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a4bbd160584fc34cf42cfd8c38752b7bd">MAX_QUANTIZED_EXCESS</a> * width * height / proportion) {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="comment">// Ensure there is a maximum bound on the number of entries sent.</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">// This should only occur if the threshold sampling is really bad.</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// As a simple recovery process, this just removes enough entries to fit</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// within the appropriate size. Removals begin from the end to avoid copies</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// when deleting entries.</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    colT excess = num_quantized -</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      (<a class="code" href="classlbann_1_1lbann__quantizer.html#a4bbd160584fc34cf42cfd8c38752b7bd">MAX_QUANTIZED_EXCESS</a> * width * height / proportion);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    std::vector&lt;colT&gt; remove_counts(width, 0);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">for</span> (colT header_loc = (width - 1) * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;         header_loc &gt;= 0 &amp;&amp; excess &gt; 0;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;         header_loc -= <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      colT num_in_col = q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] - q_col[header_loc];</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">if</span> (num_in_col == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keyword">const</span> colT col_offset = (header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) * ldim;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      colT num_remove = std::min(excess, num_in_col);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      colT num_left = num_in_col - num_remove;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_recon, neg_recon;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      memcpy(&amp;pos_recon, &amp;q_col[header_loc + 1], <span class="keyword">sizeof</span>(pos_recon));</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      memcpy(&amp;neg_recon, &amp;q_col[header_loc + 2], <span class="keyword">sizeof</span>(neg_recon));</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_col = &amp;qerror_buf[col_offset];</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="comment">// Add the deleted portions to qerror.</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">for</span> (colT i = q_col[header_loc] + num_left;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;           i &lt; q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>]; ++i) {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keyword">const</span> rowT val = q[i];</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keyword">const</span> rowT row = val &gt;&gt; 1;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">if</span> (val &amp; 1) {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;          qerror_col[row] += pos_recon;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;          qerror_col[row] += neg_recon;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="comment">// TODO: When this is called from quantize_replace, this does not update</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="comment">// the local matrix.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      q.erase(q.begin() + q_col[header_loc] + num_left, q.end());</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      excess -= num_remove;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      remove_counts[header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] = num_remove;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// Update all the header locations.</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    std::partial_sum(remove_counts.begin(), remove_counts.end(),</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                     remove_counts.begin());</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">for</span> (colT header_loc = 0; header_loc &lt; width * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;         header_loc += <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] -= remove_counts[header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>];</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00339">lbann_quantizer.hpp:339</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4bbd160584fc34cf42cfd8c38752b7bd"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4bbd160584fc34cf42cfd8c38752b7bd">lbann::lbann_quantizer::MAX_QUANTIZED_EXCESS</a></div><div class="ttdeci">static const Int MAX_QUANTIZED_EXCESS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00342">lbann_quantizer.hpp:342</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af1d5338e2e1682156e4f654b110be70d"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Threshold and quantize a matrix, dynamically choosing the threshold and quantization values. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width()). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">q</td><td>The output list of quantized entries. </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
    <tr><td class="paramname">proportion</td><td>Quantize one in proportion of the values. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00038">38</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                                                   {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>),</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="comment">// This uses a header to store all information needed to do unquantization in</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="comment">// one spot, which makes unquantization easier to multi-thread. The header has</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="comment">// one entry for each column, consisting of the starting offset of the</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">// quantized data in the array (including the header) and the two/three</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="comment">// reconstruction values. The number of quantized entries is included as a</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// final entry to simplify unquantization.</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keyword">const</span> colT width = mat.Width();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* <span class="keyword">const</span> __restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width +</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    row_header_factor;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  q.resize(header_len);  <span class="comment">// Space for the header.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// Select the appropriate number of threads.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(width);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  std::vector&lt;std::vector&lt;rowT&gt;&gt; thread_qs(num_threads);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  std::vector&lt;colT&gt; quantized_sums(num_threads, 0);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  std::vector&lt;colT&gt; quantized_counts(num_threads, 0);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">// Compute the thresholds.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keyword">const</span> adaptive_thresholds threshes =</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">proportion_threshold</a>(mat, qerror, proportion);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="comment">// This is for accessing q in different ways.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  colT* q_col = (colT*) q.data();</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">  #pragma omp parallel firstprivate(threshes, height, width, ldim, mat_buf, qerror_buf) num_threads(num_threads)</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    colT num_quantized = 0;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    std::vector&lt;rowT&gt;&amp; thread_q = thread_qs[tid];</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    thread_q.resize(std::max(</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      2 * height * width / proportion / num_threads,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      (colT) 4));</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    colT size = thread_q.size();</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">    #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (colT col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keyword">const</span> colT header_loc = <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * col;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      q_col[header_loc] = num_quantized;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keyword">const</span> adaptive_reconstructions recons =</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#aa58689369b5b3898b75b7b31ca574b38">col_reconstruction</a>(mat, qerror, col, threshes);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="comment">// Store the averages for reconstruction.</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      q_col[header_loc + 1] = 0;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      memcpy(&amp;q_col[header_loc + 1], &amp;recons.pos_recon, <span class="keyword">sizeof</span>(recons.pos_recon));</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      q_col[header_loc + 2] = 0;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      memcpy(&amp;q_col[header_loc + 2], &amp;recons.neg_recon, <span class="keyword">sizeof</span>(recons.neg_recon));</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor"></span>      q_col[header_loc + 3] = 0;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      memcpy(&amp;q_col[header_loc + 3], &amp;recons.zero_recon, <span class="keyword">sizeof</span>(recons.zero_recon));</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor"></span>      <span class="keyword">const</span> colT col_offset = col * ldim;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* <span class="keyword">const</span> __restrict__ mat_col = &amp;mat_buf[col_offset];</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_col = &amp;qerror_buf[col_offset];</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <span class="keywordflow">for</span> (rowT row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_col[row] + qerror_col[row];</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> x = val &gt;= threshes.pos_thresh;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> y = val &lt;= threshes.neg_thresh;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">if</span> (__builtin_expect(!!(x || y), 0)) {  <span class="comment">// Unlikely.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          <span class="keywordflow">if</span> (x) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            qerror_col[row] = val - recons.pos_recon;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            thread_q[num_quantized++] = (row &lt;&lt; 1) | 1;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            qerror_col[row] = val - recons.neg_recon;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            thread_q[num_quantized++] = row &lt;&lt; 1;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;          }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;          <span class="keywordflow">if</span> (__builtin_expect(!!(num_quantized &gt;= size), 0)) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            thread_q.resize(2 * size);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            size *= 2;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;          }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor"></span>          qerror_col[row] = val - recons.zero_recon;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor"></span>          qerror_col[row] = val;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor"></span>        }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    quantized_counts[tid] = num_quantized;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">    #pragma omp barrier</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor"></span><span class="preprocessor">    #pragma omp single</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="comment">// Compute the amount to adjust header counts by. This is essentially</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="comment">// a shifted prefix-sum.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 1; t &lt; num_threads; ++t) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        quantized_sums[t] = quantized_sums[t - 1] + quantized_counts[t - 1];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// Have threads patch up the header counts.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// Static schedule guarantees threads are assigned the same way.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="preprocessor">    #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (colT col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * col] += quantized_sums[tid] + header_len;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  colT total_quantized = std::accumulate(quantized_counts.begin(),</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    quantized_counts.end(), 0);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  q.resize(header_len + total_quantized);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_copy_threads =</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">get_adaptive_quantization_copy_threads</a>(width);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(dynamic, 1) num_threads(num_copy_threads)</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> tid = 0; tid &lt; thread_qs.size(); ++tid) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    std::copy(thread_qs[tid].begin(),</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;              thread_qs[tid].begin() + quantized_counts[tid],</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;              q.begin() + quantized_sums[tid] + header_len);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">// Store the final number of entries. Get a new q_col pointer because of the</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// resize.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  q_col = (colT*) q.data();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width] = (colT) q.size();</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a> = q.size() - header_len;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">//adaptive_threshold_bound&lt;colT, rowT&gt;(mat, qerror, q, proportion);</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a22b898932caed41ccf24abcb67c00ba1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">lbann::lbann_quantizer::get_adaptive_quantization_copy_threads</a></div><div class="ttdeci">int get_adaptive_quantization_copy_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00488">lbann_quantizer.hpp:488</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa5aabc1cb4163e95aee993d9b37b9b32"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">lbann::lbann_quantizer::proportion_threshold</a></div><div class="ttdeci">adaptive_thresholds proportion_threshold(const Mat &amp;mat, const Mat &amp;qerror, int proportion, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00769">lbann_quantizer.cpp:769</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00465">lbann_quantizer.hpp:465</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a716fae78ef5ba082a8093f0d06550804"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">lbann::lbann_quantizer::quantized_count</a></div><div class="ttdeci">size_t quantized_count</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00379">lbann_quantizer.hpp:379</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00339">lbann_quantizer.hpp:339</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa58689369b5b3898b75b7b31ca574b38"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa58689369b5b3898b75b7b31ca574b38">lbann::lbann_quantizer::col_reconstruction</a></div><div class="ttdeci">adaptive_reconstructions col_reconstruction(const Mat &amp;mat, const Mat &amp;qerror, Int col, const adaptive_thresholds threshes, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00847">lbann_quantizer.cpp:847</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_af1d5338e2e1682156e4f654b110be70d_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_af1d5338e2e1682156e4f654b110be70d_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_af1d5338e2e1682156e4f654b110be70d_cgraph" id="classlbann_1_1lbann__quantizer_af1d5338e2e1682156e4f654b110be70d_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="248,5,429,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32" title="lbann::lbann_quantizer\l::proportion_threshold" alt="" coords="263,85,415,126"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#aa58689369b5b3898b75b7b31ca574b38" title="lbann::lbann_quantizer\l::col_reconstruction" alt="" coords="263,150,415,191"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_copy_threads" alt="" coords="248,215,429,271"/><area shape="rect" id="node4" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="510,49,621,76"/><area shape="rect" id="node5" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="481,100,650,127"/><area shape="rect" id="node6" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="497,151,633,177"/><area shape="rect" id="node8" href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006" title="lbann::fast_rand_int_pow2" alt="" coords="478,201,653,228"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af1e9dc46de4c29a6ae7867b61107ba10"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00165">165</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                                                       {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  adaptive_threshold_quantize&lt;colT, rowT&gt;(mat.LockedMatrix(), q, qerror, proportion);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad1fe245c411c515540f9d0ac289f2203"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_quantize_replace </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Variant of adaptive_threshold_quantize that also replaces entries in mat with their quantized version. This is equivalent to: adaptive_threshold_quantize(mat, q, qerror, proportion); adaptive_threshold_unquantize(q, mat); Note this does not (currently) support compression. </p>

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00271">271</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                                             {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>),</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keyword">const</span> colT width = mat.Width();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.Buffer();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width +</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    row_header_factor;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  q.resize(header_len);  <span class="comment">// Space for the header.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// Select the appropriate number of threads.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(width);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  std::vector&lt;std::vector&lt;rowT&gt;&gt; thread_qs(num_threads);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  std::vector&lt;colT&gt; quantized_sums(num_threads, 0);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  std::vector&lt;colT&gt; quantized_counts(num_threads, 0);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">// Compute the thresholds.</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keyword">const</span> adaptive_thresholds threshes =</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">proportion_threshold</a>(mat, qerror, proportion);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  colT* q_col = (colT*) q.data();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">  #pragma omp parallel firstprivate(threshes, height, width, ldim, mat_buf, qerror_buf) num_threads(num_threads)</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="preprocessor"></span>  {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    colT num_quantized = 0;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    std::vector&lt;rowT&gt;&amp; thread_q = thread_qs[tid];</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    thread_q.resize(std::max(</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      2 * height * width / proportion / num_threads,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      (colT) 4));</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    colT size = thread_q.size();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor">    #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (colT col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keyword">const</span> colT header_loc = <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * col;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      q_col[header_loc] = num_quantized;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keyword">const</span> adaptive_reconstructions recons =</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#aa58689369b5b3898b75b7b31ca574b38">col_reconstruction</a>(mat, qerror, col, threshes);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="comment">// Store the averages for reconstruction.</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      q_col[header_loc + 1] = 0;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      memcpy(&amp;q_col[header_loc + 1], &amp;recons.pos_recon, <span class="keyword">sizeof</span>(recons.pos_recon));</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      q_col[header_loc + 2] = 0;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      memcpy(&amp;q_col[header_loc + 2], &amp;recons.neg_recon, <span class="keyword">sizeof</span>(recons.neg_recon));</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor"></span>      q_col[header_loc + 3] = 0;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      memcpy(&amp;q_col[header_loc + 3], &amp;recons.zero_recon, <span class="keyword">sizeof</span>(recons.zero_recon));</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="preprocessor"></span>      <span class="keyword">const</span> colT col_offset = col * ldim;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_col = &amp;mat_buf[col_offset];</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_col = &amp;qerror_buf[col_offset];</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">for</span> (rowT row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_col[row] + qerror_col[row];</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> x = val &gt;= threshes.pos_thresh;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> y = val &lt;= threshes.neg_thresh;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordflow">if</span> (__builtin_expect(!!(x || y), 0)) {  <span class="comment">// Unlikely.</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;          <span class="keywordflow">if</span> (x) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            qerror_col[row] = val - recons.pos_recon;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            thread_q[num_quantized++] = (row &lt;&lt; 1) | 1;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            mat_col[row] = recons.pos_recon;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            qerror_col[row] = val - recons.neg_recon;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            thread_q[num_quantized++] = row &lt;&lt; 1;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            mat_col[row] = recons.neg_recon;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;          }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;          <span class="keywordflow">if</span> (__builtin_expect(!!(num_quantized &gt;= size), 0)) {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            thread_q.resize(2 * size);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            size *= 2;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="preprocessor"></span>          qerror_col[row] = val - recons.zero_recon;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;          mat_col[row] = recons.zero_recon;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor"></span>          qerror_col[row] = val;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor"></span>        }</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      }</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    quantized_counts[tid] = num_quantized;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">    #pragma omp barrier</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor"></span><span class="preprocessor">    #pragma omp single</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="comment">// Compute the amount to adjust header counts by. This is essentially</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <span class="comment">// a shifted prefix-sum.</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> t = 1; t &lt; num_threads; ++t) {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        quantized_sums[t] = quantized_sums[t - 1] + quantized_counts[t - 1];</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">// Have threads patch up the header counts.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">// Static schedule guarantees threads are assigned the same way.</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="preprocessor">    #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (colT col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * col] += quantized_sums[tid] + header_len;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  colT total_quantized = std::accumulate(quantized_counts.begin(),</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    quantized_counts.end(), 0);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  q.resize(header_len + total_quantized);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_copy_threads =</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">get_adaptive_quantization_copy_threads</a>(width);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(dynamic, 1) num_threads(num_copy_threads)</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> tid = 0; tid &lt; thread_qs.size(); ++tid) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    std::copy(thread_qs[tid].begin(),</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;              thread_qs[tid].begin() + quantized_counts[tid],</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;              q.begin() + quantized_sums[tid] + header_len);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// Store the final number of entries. Get a new q_col pointer because of the</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// resize.</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  q_col = (colT*) q.data();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width] = q.size();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a> = q.size() - header_len;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  adaptive_threshold_bound&lt;colT, rowT&gt;(mat, qerror, q, proportion);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a22b898932caed41ccf24abcb67c00ba1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1">lbann::lbann_quantizer::get_adaptive_quantization_copy_threads</a></div><div class="ttdeci">int get_adaptive_quantization_copy_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00488">lbann_quantizer.hpp:488</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa5aabc1cb4163e95aee993d9b37b9b32"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32">lbann::lbann_quantizer::proportion_threshold</a></div><div class="ttdeci">adaptive_thresholds proportion_threshold(const Mat &amp;mat, const Mat &amp;qerror, int proportion, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00769">lbann_quantizer.cpp:769</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00465">lbann_quantizer.hpp:465</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a716fae78ef5ba082a8093f0d06550804"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">lbann::lbann_quantizer::quantized_count</a></div><div class="ttdeci">size_t quantized_count</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00379">lbann_quantizer.hpp:379</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00339">lbann_quantizer.hpp:339</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa58689369b5b3898b75b7b31ca574b38"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa58689369b5b3898b75b7b31ca574b38">lbann::lbann_quantizer::col_reconstruction</a></div><div class="ttdeci">adaptive_reconstructions col_reconstruction(const Mat &amp;mat, const Mat &amp;qerror, Int col, const adaptive_thresholds threshes, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00847">lbann_quantizer.cpp:847</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ad1fe245c411c515540f9d0ac289f2203_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ad1fe245c411c515540f9d0ac289f2203_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ad1fe245c411c515540f9d0ac289f2203_cgraph" id="classlbann_1_1lbann__quantizer_ad1fe245c411c515540f9d0ac289f2203_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="248,5,429,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aa5aabc1cb4163e95aee993d9b37b9b32" title="lbann::lbann_quantizer\l::proportion_threshold" alt="" coords="263,85,415,126"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#aa58689369b5b3898b75b7b31ca574b38" title="lbann::lbann_quantizer\l::col_reconstruction" alt="" coords="263,150,415,191"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a22b898932caed41ccf24abcb67c00ba1" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_copy_threads" alt="" coords="248,215,429,271"/><area shape="rect" id="node4" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="510,49,621,76"/><area shape="rect" id="node5" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="481,100,650,127"/><area shape="rect" id="node6" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="497,151,633,177"/><area shape="rect" id="node8" href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006" title="lbann::fast_rand_int_pow2" alt="" coords="478,201,653,228"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a10ecb0a087bc5330129e471b6a2fb8da"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_quantize_slice </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">colT&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">colT&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00466">466</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                                                {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="keyword">const</span> colT width = end - start;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * width * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> +</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    row_header_factor;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">// Copy the header over. Locations will need to be adjusted later.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  <span class="keyword">const</span> colT* q_col = (<span class="keyword">const</span> colT*) q.data();</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keyword">const</span> colT total_len = header_len + q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * end] - q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * start];</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  slice.resize(total_len);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  colT* slice_col = (colT*) slice.data();</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  std::copy(&amp;q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>*start], &amp;q_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>*end + 1],</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    slice_col);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// Copy data over.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  std::copy(q.begin() + slice_col[0], q.begin() + slice_col[<a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width],</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    slice.begin() + header_len);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">// Adjust locations.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="keyword">const</span> colT adjust = slice_col[0] - header_len;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordflow">for</span> (colT header_loc = 0; header_loc &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * width; header_loc += <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    slice_col[header_loc] -= adjust;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  adaptive_threshold_bound&lt;colT, rowT&gt;(mat, qerror, slice, proportion);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00339">lbann_quantizer.hpp:339</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa255344d87e8aa9e889aa626ac1b4c81"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize an adaptively-thresholded-and-quantized matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">q</td><td>The quantizd matrix. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00171">171</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                      {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>),</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf = mat.Buffer();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">const</span> colT header_len = mat.Width() * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keyword">const</span> colT* q_col = (<span class="keyword">const</span> colT*) q.data();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(mat.Width());</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(dynamic, 1), firstprivate(header_len, buf) num_threads(num_threads)</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (colT header_loc = 0; header_loc &lt; header_len; header_loc += <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keyword">const</span> colT col_offset = (header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) * ldim;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// Extract averages.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_recon, neg_recon;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    memcpy(&amp;pos_recon, &amp;q_col[header_loc + 1], <span class="keyword">sizeof</span>(pos_recon));</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    memcpy(&amp;neg_recon, &amp;q_col[header_loc + 2], <span class="keyword">sizeof</span>(neg_recon));</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor"></span>    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> zero_recon;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    memcpy(&amp;zero_recon, &amp;q_col[header_loc + 3], <span class="keyword">sizeof</span>(zero_recon));</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">// Fill the column, then update with the other values.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    std::fill_n(&amp;buf[(header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) * ldim], height, zero_recon);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="preprocessor"></span>    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf_col = &amp;buf[col_offset];</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keyword">const</span> colT chunk_start = q_col[header_loc];</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">const</span> colT chunk_end = q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] - chunk_start;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">const</span> rowT* <span class="keyword">const</span> __restrict__ q_ = &amp;(q.data()[chunk_start]);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">for</span> (rowT i = 0; i &lt; chunk_end; ++i) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keyword">const</span> rowT val = q_[i];</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keyword">const</span> rowT row = val &gt;&gt; 1;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      buf_col[row] = val &amp; 0x1 ? pos_recon : neg_recon;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00465">lbann_quantizer.hpp:465</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00339">lbann_quantizer.hpp:339</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa255344d87e8aa9e889aa626ac1b4c81_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa255344d87e8aa9e889aa626ac1b4c81_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa255344d87e8aa9e889aa626ac1b4c81_cgraph" id="classlbann_1_1lbann__quantizer_aa255344d87e8aa9e889aa626ac1b4c81_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="264,4,445,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="addabdd44f5cb2edbc440591e0c614b0a"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00216">216</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                                          {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  adaptive_threshold_unquantize&lt;colT, rowT&gt;(q, mat.Matrix());</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4551fb3f9423f8a41248628f739337e6"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_unquantize_add </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; rowT &gt; &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Variant of adaptive_threshold_unquantize that adds its entries. </p>

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00222">222</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                      {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>),</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf = mat.Buffer();</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keyword">const</span> colT header_len = mat.Width() * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">const</span> colT height = mat.Height();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keyword">const</span> colT ldim = mat.LDim();</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keyword">const</span> colT* q_col = (<span class="keyword">const</span> colT*) q.data();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(mat.Width());</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(dynamic, 1), firstprivate(header_len, buf) num_threads(num_threads)</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (colT header_loc = 0; header_loc &lt; header_len; header_loc += <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keyword">const</span> colT col_offset = (header_loc / <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>) * ldim;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// Extract averages.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_recon, neg_recon;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    memcpy(&amp;pos_recon, &amp;q_col[header_loc + 1], <span class="keyword">sizeof</span>(pos_recon));</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    memcpy(&amp;neg_recon, &amp;q_col[header_loc + 2], <span class="keyword">sizeof</span>(neg_recon));</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor"></span>    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> zero_recon;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    memcpy(&amp;zero_recon, &amp;q_col[header_loc + 3], <span class="keyword">sizeof</span>(zero_recon));</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// Add zero_recon to everything and adjust the other means.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">for</span> (rowT row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      buf[row + col_offset] += zero_recon;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    pos_recon -= zero_recon;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    neg_recon += zero_recon;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor"></span>    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf_col = &amp;buf[col_offset];</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keyword">const</span> colT chunk_start = q_col[header_loc];</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keyword">const</span> colT chunk_end = q_col[header_loc + <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>] - chunk_start;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keyword">const</span> rowT* <span class="keyword">const</span> __restrict__ q_ = &amp;(q.data()[chunk_start]);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">for</span> (rowT i = 0; i &lt; chunk_end; ++i) {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keyword">const</span> rowT val = q_[i];</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keyword">const</span> rowT row = val &gt;&gt; 1;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      buf_col[row] += val &amp; 0x1 ? pos_recon : neg_recon;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00465">lbann_quantizer.hpp:465</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00339">lbann_quantizer.hpp:339</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4551fb3f9423f8a41248628f739337e6_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4551fb3f9423f8a41248628f739337e6_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4551fb3f9423f8a41248628f739337e6_cgraph" id="classlbann_1_1lbann__quantizer_a4551fb3f9423f8a41248628f739337e6_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f" title="lbann::lbann_quantizer\l::get_adaptive_quantization\l_threads" alt="" coords="291,4,472,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa58689369b5b3898b75b7b31ca574b38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__reconstructions.html">lbann_quantizer::adaptive_reconstructions</a> lbann::lbann_quantizer::col_reconstruction </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Int&#160;</td>
          <td class="paramname"><em>col</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">adaptive_thresholds</a>&#160;</td>
          <td class="paramname"><em>threshes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sample</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute reconstruction values for col. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to compute reconstruction values for. </td></tr>
    <tr><td class="paramname">qerror</td><td>The accumulated quantization error in mat. </td></tr>
    <tr><td class="paramname">col</td><td>The column to compute reconstruction values for. </td></tr>
    <tr><td class="paramname">ainfo</td><td>Adaptive quantization info with thresholds filled in. </td></tr>
    <tr><td class="paramname">sample</td><td>Whether to approximate stats by randomly sampling mat. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Adaptive reconstruction values. </dd></dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00847">847</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                                                   {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_sum = 0.0f;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  Unsigned pos_count = 0;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_sum = 0.0f;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  Unsigned neg_count = 0;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="preprocessor"></span>  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> zero_sum = 0.0f;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  Unsigned zero_count = 0;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="preprocessor"></span>  <span class="keyword">const</span> Int height = mat.Height();</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keyword">const</span> Int col_offset = col * mat.LDim();</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.LockedBuffer();</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordflow">if</span> (height &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#ad6e99d098a4d4c1488241b3484132904">NUM_RECON_SAMPLES</a> || !sample) {</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">for</span> (Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <span class="keyword">const</span> Unsigned pos = row + col_offset;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="keywordflow">if</span> (val &gt;= threshes.pos_thresh) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        pos_sum += val;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        ++pos_count;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">if</span> (val &lt;= threshes.neg_thresh) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;          neg_sum += val;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          ++neg_count;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        } </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;          zero_sum += val;</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;          ++zero_count;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="comment">// Randomly sample entries to approximate the means.</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <a class="code" href="namespacelbann.html#ab909b5afe4b0047a3bfe13d519a90290">fast_rng_gen</a>&amp; gen = <a class="code" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">get_fast_generator</a>();</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordtype">bool</span> is_pow2 = !(height &amp; (height - 1));  <span class="comment">// Assumes height != 0.</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    std::vector&lt;Unsigned&gt; poses(<a class="code" href="classlbann_1_1lbann__quantizer.html#ad6e99d098a4d4c1488241b3484132904">NUM_RECON_SAMPLES</a>);</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordflow">if</span> (is_pow2) {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#ad6e99d098a4d4c1488241b3484132904">NUM_RECON_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="keyword">const</span> Unsigned pos = <a class="code" href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006">fast_rand_int_pow2</a>(gen, height) + col_offset;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        __builtin_prefetch(&amp;mat_buf[pos]);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        __builtin_prefetch(&amp;qerror_buf[pos]);</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        poses[i] = pos;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#ad6e99d098a4d4c1488241b3484132904">NUM_RECON_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keyword">const</span> Unsigned pos = <a class="code" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">fast_rand_int</a>(gen, height) + col_offset;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        __builtin_prefetch(&amp;mat_buf[pos]);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        __builtin_prefetch(&amp;qerror_buf[pos]);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        poses[i] = pos;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#ad6e99d098a4d4c1488241b3484132904">NUM_RECON_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="comment">//const unsigned pos = row_dist(gen) + col_offset;</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      <span class="keyword">const</span> Unsigned pos = poses[i];</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">if</span> (val &gt;= threshes.pos_thresh) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        pos_sum += val;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        ++pos_count;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">if</span> (val &lt;= threshes.neg_thresh) {</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          neg_sum += val;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;          ++neg_count;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;          zero_sum += val;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;          ++zero_count;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="preprocessor"></span>      }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="comment">// Compute the means. Use the thresholds as initial values in case the</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="comment">// sampling does not include any positive or negative values.</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_recon = threshes.pos_thresh;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_recon = threshes.neg_thresh;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="preprocessor"></span>  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> zero_recon = 0.0f;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (pos_count &gt; 0) {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    pos_recon = pos_sum / pos_count;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <span class="keywordflow">if</span> (neg_count &gt; 0) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    neg_recon = neg_sum / neg_count;</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  }</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="preprocessor">#if LBANN_QUANTIZER_TERNARY</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">if</span> (zero_count &gt; 0) {</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    zero_recon = zero_sum / zero_count;</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keywordflow">return</span> { pos_recon, neg_recon, zero_recon };</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">return</span> { pos_recon, neg_recon };</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="preprocessor"></span>}</div>
<div class="ttc" id="namespacelbann_html_a557aaed6267e7aaf583a75149e9c670c"><div class="ttname"><a href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">lbann::fast_rand_int</a></div><div class="ttdeci">T fast_rand_int(Generator &amp;g, T max)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8hpp_source.html#l00068">lbann_random.hpp:68</a></div></div>
<div class="ttc" id="namespacelbann_html_ae6ce9c2fdec6f81803f6b1a6555c31c5"><div class="ttname"><a href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">lbann::get_fast_generator</a></div><div class="ttdeci">fast_rng_gen &amp; get_fast_generator()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8cpp_source.html#l00064">lbann_random.cpp:64</a></div></div>
<div class="ttc" id="namespacelbann_html_ab909b5afe4b0047a3bfe13d519a90290"><div class="ttname"><a href="namespacelbann.html#ab909b5afe4b0047a3bfe13d519a90290">lbann::fast_rng_gen</a></div><div class="ttdeci">std::minstd_rand fast_rng_gen</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8hpp_source.html#l00037">lbann_random.hpp:37</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad6e99d098a4d4c1488241b3484132904"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad6e99d098a4d4c1488241b3484132904">lbann::lbann_quantizer::NUM_RECON_SAMPLES</a></div><div class="ttdeci">static const Int NUM_RECON_SAMPLES</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00332">lbann_quantizer.hpp:332</a></div></div>
<div class="ttc" id="namespacelbann_html_a2fe8cea17a147566b73260f557b51006"><div class="ttname"><a href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006">lbann::fast_rand_int_pow2</a></div><div class="ttdeci">T fast_rand_int_pow2(Generator &amp;g, T max)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8hpp_source.html#l00081">lbann_random.hpp:81</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa58689369b5b3898b75b7b31ca574b38_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa58689369b5b3898b75b7b31ca574b38_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa58689369b5b3898b75b7b31ca574b38_cgraph" id="classlbann_1_1lbann__quantizer_aa58689369b5b3898b75b7b31ca574b38_cgraph">
<area shape="rect" id="node2" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="209,5,378,32"/><area shape="rect" id="node3" href="namespacelbann.html#a2fe8cea17a147566b73260f557b51006" title="lbann::fast_rand_int_pow2" alt="" coords="206,56,381,83"/><area shape="rect" id="node4" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="225,107,361,133"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa58689369b5b3898b75b7b31ca574b38_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa58689369b5b3898b75b7b31ca574b38_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa58689369b5b3898b75b7b31ca574b38_icgraph" id="classlbann_1_1lbann__quantizer_aa58689369b5b3898b75b7b31ca574b38_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#af1d5338e2e1682156e4f654b110be70d" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="205,5,400,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ad1fe245c411c515540f9d0ac289f2203" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize\l_replace" alt="" coords="205,69,400,125"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad8d07c3ffddff08800887dff354ffed2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::compress_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compress the output of threshold_quantize. This uses Golomb-Rice coding, with the quotient stored first, followed by the remainder. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00659">659</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                                                               {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a>(q, q.begin(), q.end(), cq);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad8d07c3ffddff08800887dff354ffed2"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">lbann::lbann_quantizer::compress_thresholds</a></div><div class="ttdeci">void compress_thresholds(const ThreshQuantized &amp;q, ThreshQuantized &amp;cq)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00659">lbann_quantizer.cpp:659</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ad8d07c3ffddff08800887dff354ffed2_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ad8d07c3ffddff08800887dff354ffed2_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ad8d07c3ffddff08800887dff354ffed2_icgraph" id="classlbann_1_1lbann__quantizer_ad8d07c3ffddff08800887dff354ffed2_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="209,45,391,101"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="450,5,614,61"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="441,85,623,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae2b9b9ef877eaa51a1320030cc97f200"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::compress_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::const_iterator&#160;</td>
          <td class="paramname"><em>qstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::const_iterator&#160;</td>
          <td class="paramname"><em>qend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handle compression starting from arbitrary locations. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00664">664</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                                               {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">// Current bit to write to. This is in the range [0, NUM_BITS-1] (e.g. 0-31).</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> cur_bit = 0;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  comp_q.emplace_back(0);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iter = qstart; iter != qend; ++iter) {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> entry = *iter;</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> quotient = entry &gt;&gt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> remainder = entry &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> - 1);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordtype">size_t</span> cur_pos = comp_q.size() - 1;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">// quotient should usually be 0; if not, choose a better GR_K.</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> (quotient == 0) {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <span class="comment">// Just increment the current bit, since cur_bit &lt;= 31 here.</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      ++cur_bit;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="comment">// The quotient needs quotient 1s then a 0.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="comment">// Determine how many bits we need to set in the current word.</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> bits_set_cur = std::min((<a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>) <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit, quotient);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="comment">// This shift is done with 64 bits to deal with the case that:</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="comment">// cur_bit == 0 &amp;&amp; quotient == NUM_BITS =&gt; bits_set_cur = 32</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="comment">// which breaks when sizeof(uqtype) == 32 (which we use).</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="comment">// If we switch to 64 bits, we&#39;ll need to come up with something else,</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="comment">// since the same problem will occur.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      comp_q[cur_pos] |= ((((uint64_t) 1) &lt;&lt; bits_set_cur) - 1) &lt;&lt; cur_bit;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="comment">// Add the appropriate number of words filled with 1s (may be 0).</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      comp_q.resize(comp_q.size() + (quotient - bits_set_cur) / <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>,</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                    ~((<a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>) 0));</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="comment">// Add the final bits if any and update cur_bit.</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> final_bits = (quotient - bits_set_cur) &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - 1);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      comp_q.resize(comp_q.size() + (final_bits &gt; 0), (1 &lt;&lt; final_bits) - 1);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      cur_bit = (cur_bit + quotient) &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - 1);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="comment">// Add the 0 terminator.</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      comp_q.resize(comp_q.size() + !cur_bit, 0);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      ++cur_bit;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="comment">// Write remainder using GR_K bits. cur_bit == NUM_BITS is possible here.</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> bits_set_cur = std::min((<a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>) <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit,</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                                   static_cast&lt;uqtype&gt;(GR_K));</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    cur_pos = comp_q.size() - 1;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="comment">// Write what we can to the current word.</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    comp_q[cur_pos] |= (remainder &amp; ((1 &lt;&lt; bits_set_cur) - 1)) &lt;&lt; cur_bit;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Write the rest to a new word, if needed.</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    comp_q.resize(comp_q.size() + (bits_set_cur != <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>),</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                  remainder &gt;&gt; bits_set_cur);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    cur_bit = (cur_bit + <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>) &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - 1);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">// Add a new word if needed.</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    comp_q.resize(comp_q.size() + !cur_bit, 0);</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">// Pad the final word with 1s to terminate.</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordtype">size_t</span> cur_pos = comp_q.size() - 1;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  comp_q[cur_pos] |= ((1 &lt;&lt; (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit)) - 1) &lt;&lt; cur_bit;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad98118c77f676fa3d3fb4ba27b814070"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">lbann::lbann_quantizer::GR_M</a></div><div class="ttdeci">static const uqtype GR_M</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00326">lbann_quantizer.hpp:326</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a5f645c840854c584c9224af063fee23b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">lbann::lbann_quantizer::GR_K</a></div><div class="ttdeci">static const uqtype GR_K</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00328">lbann_quantizer.hpp:328</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a018cddfc9b73d94c2d60bdd7a11a0079"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00061">lbann_quantizer.hpp:61</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00321">lbann_quantizer.hpp:321</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a22b898932caed41ccf24abcb67c00ba1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lbann::lbann_quantizer::get_adaptive_quantization_copy_threads </td>
          <td>(</td>
          <td class="paramtype">El::Int&#160;</td>
          <td class="paramname"><em>width</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of threads adaptive quantization uses in its copy loop. This is empirically determined. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">width</td><td>The width of the matrix being quantized. </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000027">Todo:</a></b></dt><dd>Make this configurable at compile time. <dl class="section note"><dt>Note</dt><dd>If this and get_adaptive_quantization_threads return different values for the same width, OpenMP may reap its threads and add additional overhead when invoking a parallel region with more threads. </dd></dl>
</dd></dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00488">488</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                                                                 {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordtype">int</span> num_threads = <a class="code" href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">get_adaptive_quantization_threads</a>(width);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> (width &gt;= 16384) {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      num_threads /= 2;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">return</span> num_threads;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aaa0c20f755437130172c40ca8e95bc3f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aaa0c20f755437130172c40ca8e95bc3f">lbann::lbann_quantizer::get_adaptive_quantization_threads</a></div><div class="ttdeci">int get_adaptive_quantization_threads(El::Int width)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00465">lbann_quantizer.hpp:465</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_icgraph" id="classlbann_1_1lbann__quantizer_a22b898932caed41ccf24abcb67c00ba1_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#af1d5338e2e1682156e4f654b110be70d" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="235,5,429,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ad1fe245c411c515540f9d0ac289f2203" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize\l_replace" alt="" coords="235,69,429,125"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aaa0c20f755437130172c40ca8e95bc3f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lbann::lbann_quantizer::get_adaptive_quantization_threads </td>
          <td>(</td>
          <td class="paramtype">El::Int&#160;</td>
          <td class="paramname"><em>width</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the number of threads adaptive quantization should use for a matrix with the given width. This number of threads is empirically determined. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000026">Todo:</a></b></dt><dd>Make this configurable at compile time. </dd></dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00465">465</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                                                            {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">int</span> num_threads = omp_get_max_threads();</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">if</span> (width &lt;= 64) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      num_threads = 2;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 128) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      num_threads = 8;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 256) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      num_threads = 12;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 1024) {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      num_threads = 24;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">return</span> std::min(omp_get_max_threads(), num_threads);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  }</div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aaa0c20f755437130172c40ca8e95bc3f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aaa0c20f755437130172c40ca8e95bc3f_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aaa0c20f755437130172c40ca8e95bc3f_icgraph" id="classlbann_1_1lbann__quantizer_aaa0c20f755437130172c40ca8e95bc3f_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#af1d5338e2e1682156e4f654b110be70d" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="256,5,451,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aa255344d87e8aa9e889aa626ac1b4c81" title="lbann::lbann_quantizer\l::adaptive_threshold_unquantize" alt="" coords="249,70,458,111"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a4551fb3f9423f8a41248628f739337e6" title="lbann::lbann_quantizer\l::adaptive_threshold_unquantize_add" alt="" coords="235,135,472,177"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ad1fe245c411c515540f9d0ac289f2203" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize\l_replace" alt="" coords="256,200,451,256"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9befb796840b21d1238e8169421005f9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_ag_bytes_received </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the total number of bytes received during the all-gather phase. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00266">266</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ae29843bccd4f211f36f4dd357a066a5d"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">lbann::lbann_quantizer::ag_bytes_received</a></div><div class="ttdeci">size_t ag_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00351">lbann_quantizer.hpp:351</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a9befb796840b21d1238e8169421005f9_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a9befb796840b21d1238e8169421005f9_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a9befb796840b21d1238e8169421005f9_icgraph" id="classlbann_1_1lbann__quantizer_a9befb796840b21d1238e8169421005f9_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="219,4,383,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6c64c6960852ca25f81ba7bc80c05d2d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_ag_bytes_sent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the total number of bytes sent during the all-gather phase. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00258">258</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a3a9e25785189c84ba5a7fe055382ca92"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">lbann::lbann_quantizer::ag_bytes_sent</a></div><div class="ttdeci">size_t ag_bytes_sent</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00347">lbann_quantizer.hpp:347</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a6c64c6960852ca25f81ba7bc80c05d2d_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a6c64c6960852ca25f81ba7bc80c05d2d_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a6c64c6960852ca25f81ba7bc80c05d2d_icgraph" id="classlbann_1_1lbann__quantizer_a6c64c6960852ca25f81ba7bc80c05d2d_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="206,4,370,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a54a63a467a16d24c12010edcf8b28f03"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_recv_buf_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in the allgather get_recv_buf. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00291">291</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0b7575ba8c4c3c2fcd7ea7e668c02178"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">lbann::lbann_quantizer::ag_recv_buf_time</a></div><div class="ttdeci">double ag_recv_buf_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00369">lbann_quantizer.hpp:369</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aebc22819c53ce8a836bd20e938f6c59e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_recv_trans_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in the all-gather send_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00293">293</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a9258429db2bb93e7f42e7b8573d83225"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">lbann::lbann_quantizer::ag_recv_trans_time</a></div><div class="ttdeci">double ag_recv_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00371">lbann_quantizer.hpp:371</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aebc22819c53ce8a836bd20e938f6c59e_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aebc22819c53ce8a836bd20e938f6c59e_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aebc22819c53ce8a836bd20e938f6c59e_icgraph" id="classlbann_1_1lbann__quantizer_aebc22819c53ce8a836bd20e938f6c59e_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="225,4,389,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a882dcd266f67f98d5dfdf339edb8c31e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_recv_wait_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in recvs/waiting for recvs in the allgather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00297">297</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a64b9d2a56f4f2c64482377104d26c1f0">ag_recv_wait_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a64b9d2a56f4f2c64482377104d26c1f0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a64b9d2a56f4f2c64482377104d26c1f0">lbann::lbann_quantizer::ag_recv_wait_time</a></div><div class="ttdeci">double ag_recv_wait_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00375">lbann_quantizer.hpp:375</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a983b603f83ebdaee5eb924ca0d6495b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_reduced_trans_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in the allgather reduce_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00289">289</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">ag_reduced_trans_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0e997657d1164ed23f912809492d8999"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">lbann::lbann_quantizer::ag_reduced_trans_time</a></div><div class="ttdeci">double ag_reduced_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00367">lbann_quantizer.hpp:367</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a74d934a5d2e9a8e33e95e631a5f5dcb1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_send_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in sends in the allgather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00295">295</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ab74ab07fa1c26bcf29d9d8bf267905a4">ag_send_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab74ab07fa1c26bcf29d9d8bf267905a4"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab74ab07fa1c26bcf29d9d8bf267905a4">lbann::lbann_quantizer::ag_send_time</a></div><div class="ttdeci">double ag_send_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00373">lbann_quantizer.hpp:373</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="affd6ee0a9c259ba5999c8f18ee7a58a7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_ag_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in the allgather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00277">277</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">ag_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4d3c330826fbaff8ee38f4b05cafa84a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">lbann::lbann_quantizer::ag_time</a></div><div class="ttdeci">double ag_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00355">lbann_quantizer.hpp:355</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9a029f692e679ac4475a51fa2ac8f7c1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_bytes_received </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the total number of bytes received during quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00260">260</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                    {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> + <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a9b02b1adbc432e0d5b417ad6e098ed75"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">lbann::lbann_quantizer::rs_bytes_received</a></div><div class="ttdeci">size_t rs_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00349">lbann_quantizer.hpp:349</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ae29843bccd4f211f36f4dd357a066a5d"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">lbann::lbann_quantizer::ag_bytes_received</a></div><div class="ttdeci">size_t ag_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00351">lbann_quantizer.hpp:351</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a9a029f692e679ac4475a51fa2ac8f7c1_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a9a029f692e679ac4475a51fa2ac8f7c1_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a9a029f692e679ac4475a51fa2ac8f7c1_icgraph" id="classlbann_1_1lbann__quantizer_a9a029f692e679ac4475a51fa2ac8f7c1_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="206,4,370,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad318aefe6f75c8d68363affce55f6190"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_bytes_sent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the total number of bytes sent during quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00254">254</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a> + <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a484e392b671e8eeaa3af5b5faa683bee"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">lbann::lbann_quantizer::rs_bytes_sent</a></div><div class="ttdeci">size_t rs_bytes_sent</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00345">lbann_quantizer.hpp:345</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a3a9e25785189c84ba5a7fe055382ca92"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">lbann::lbann_quantizer::ag_bytes_sent</a></div><div class="ttdeci">size_t ag_bytes_sent</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00347">lbann_quantizer.hpp:347</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ad318aefe6f75c8d68363affce55f6190_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ad318aefe6f75c8d68363affce55f6190_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ad318aefe6f75c8d68363affce55f6190_icgraph" id="classlbann_1_1lbann__quantizer_ad318aefe6f75c8d68363affce55f6190_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="206,4,370,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5b9d72b9133517e0212f73908a576c7e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_proportion_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in proportion_threshold. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00299">299</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">proportion_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a6bd266728f578df0c86fc2e493742cc1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">lbann::lbann_quantizer::proportion_time</a></div><div class="ttdeci">double proportion_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00377">lbann_quantizer.hpp:377</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0d9f7cc689b44935a347ff0b7e3d1820"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_quantized_count </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the most recent number of quantized entries. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00317">317</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">quantized_count</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a716fae78ef5ba082a8093f0d06550804"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a716fae78ef5ba082a8093f0d06550804">lbann::lbann_quantizer::quantized_count</a></div><div class="ttdeci">size_t quantized_count</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00379">lbann_quantizer.hpp:379</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0d9f7cc689b44935a347ff0b7e3d1820_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0d9f7cc689b44935a347ff0b7e3d1820_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a0d9f7cc689b44935a347ff0b7e3d1820_icgraph" id="classlbann_1_1lbann__quantizer_a0d9f7cc689b44935a347ff0b7e3d1820_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="206,4,370,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab91c3defbec372e4b5c35db7dfe522b0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Int lbann::lbann_quantizer::get_quantized_matrix_height </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the height of mat after quantization with <a class="el" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize()</a>. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00390">390</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                                               {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">return</span> (mat.Height() + (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>-1)) / <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> + 2;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00321">lbann_quantizer.hpp:321</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ab91c3defbec372e4b5c35db7dfe522b0_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ab91c3defbec372e4b5c35db7dfe522b0_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ab91c3defbec372e4b5c35db7dfe522b0_icgraph" id="classlbann_1_1lbann__quantizer_ab91c3defbec372e4b5c35db7dfe522b0_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer\l::quantize" alt="" coords="208,11,360,53"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="409,70,594,111"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aa516ede3d1fd798bb5ef5c2cf28cb53d" title="lbann::lbann_quantizer\l::quantize" alt="" coords="425,5,577,46"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="654,27,818,83"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="643,106,829,147"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aeefaa02ea30dc89f58420e019950207f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_rs_bytes_received </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the total number of bytes received during the reduce-scatter phase. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00264">264</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a9b02b1adbc432e0d5b417ad6e098ed75"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">lbann::lbann_quantizer::rs_bytes_received</a></div><div class="ttdeci">size_t rs_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00349">lbann_quantizer.hpp:349</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aeefaa02ea30dc89f58420e019950207f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aeefaa02ea30dc89f58420e019950207f_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aeefaa02ea30dc89f58420e019950207f_icgraph" id="classlbann_1_1lbann__quantizer_aeefaa02ea30dc89f58420e019950207f_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="217,4,381,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2c1b69b38cf93d43e9b4eca7d4c5e28f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::get_rs_bytes_sent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the total number of bytes sent during the reduce-scatter phase. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00256">256</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a484e392b671e8eeaa3af5b5faa683bee"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">lbann::lbann_quantizer::rs_bytes_sent</a></div><div class="ttdeci">size_t rs_bytes_sent</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00345">lbann_quantizer.hpp:345</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a2c1b69b38cf93d43e9b4eca7d4c5e28f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a2c1b69b38cf93d43e9b4eca7d4c5e28f_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a2c1b69b38cf93d43e9b4eca7d4c5e28f_icgraph" id="classlbann_1_1lbann__quantizer_a2c1b69b38cf93d43e9b4eca7d4c5e28f_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="206,4,370,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a12b8e87e51866a6b028b8dbd4faebe55"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_recv_buf_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in the reduce-scatter get_recv_buf. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00281">281</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a7fa4275835362b7d9ec91201f4f73436"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">lbann::lbann_quantizer::rs_recv_buf_time</a></div><div class="ttdeci">double rs_recv_buf_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00359">lbann_quantizer.hpp:359</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae5f4f573c3ed285265e9d7834446b3a0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_recv_trans_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in the reduce-scatter recv_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00283">283</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a81db6fb79472d86023dd470c2948ea5a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">lbann::lbann_quantizer::rs_recv_trans_time</a></div><div class="ttdeci">double rs_recv_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00361">lbann_quantizer.hpp:361</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae5f4f573c3ed285265e9d7834446b3a0_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae5f4f573c3ed285265e9d7834446b3a0_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ae5f4f573c3ed285265e9d7834446b3a0_icgraph" id="classlbann_1_1lbann__quantizer_ae5f4f573c3ed285265e9d7834446b3a0_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="222,4,386,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab42d987061378cff2d4e5918ceb7e94c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_recv_wait_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in recvs/waiting for recvs in the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00287">287</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#afa064118f6206f6ac61308e290a1b459">rs_recv_wait_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afa064118f6206f6ac61308e290a1b459"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afa064118f6206f6ac61308e290a1b459">lbann::lbann_quantizer::rs_recv_wait_time</a></div><div class="ttdeci">double rs_recv_wait_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00365">lbann_quantizer.hpp:365</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaf13fdd86351a63f8765eb7d36494d03"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_send_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in sends in the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00285">285</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a961b2b067876adef034c3bd075d13925">rs_send_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a961b2b067876adef034c3bd075d13925"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a961b2b067876adef034c3bd075d13925">lbann::lbann_quantizer::rs_send_time</a></div><div class="ttdeci">double rs_send_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00363">lbann_quantizer.hpp:363</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aea9f348cd6f48b706870e1a5e48e8827"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_send_trans_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in the reduce-scatter send_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00279">279</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a824b8b6d8964621e6a02aee94c38332a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">lbann::lbann_quantizer::rs_send_trans_time</a></div><div class="ttdeci">double rs_send_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00357">lbann_quantizer.hpp:357</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aea9f348cd6f48b706870e1a5e48e8827_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aea9f348cd6f48b706870e1a5e48e8827_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aea9f348cd6f48b706870e1a5e48e8827_icgraph" id="classlbann_1_1lbann__quantizer_aea9f348cd6f48b706870e1a5e48e8827_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="225,4,389,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4484f37237d53c4992d00698b72fd45f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::get_rs_time </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the time spent in the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00275">275</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a>; }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa25d9dbcc7af16370142f46a6c23d178"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">lbann::lbann_quantizer::rs_time</a></div><div class="ttdeci">double rs_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00353">lbann_quantizer.hpp:353</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad56a9a2d4a56c0dd252fdfbefaff50f8"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_pairwise_exchange_reduce_scatter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>var_recv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, IR, IR, int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>send_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>get_recv_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&#160;</td>
          <td class="paramname"><em>recv_trans</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00617">617</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                          {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="keywordtype">double</span> rs_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="keywordtype">int</span> rank = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank();</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="keywordtype">int</span> nprocs = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models();</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">// Compute the number of columns each processor sends.</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="comment">// The last processor handles the excess.</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  Int cols_per_proc = mat.Width() / nprocs;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  Int cols_remainder = mat.Width() % nprocs;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  Int local_col_width = cols_per_proc;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="keywordflow">if</span> (rank == nprocs - 1) local_col_width += cols_remainder;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// Local view into which to accumulate our received data.</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keyword">auto</span> accum_view = mat(IR(0, mat.Height()),</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                        IR(rank * cols_per_proc,</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                           rank * cols_per_proc + local_col_width));</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <span class="comment">// Do the reduce-scatter.</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 1; step &lt; nprocs; ++step) {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="comment">// Compute the source/destination.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordtype">int</span> dst = (rank + step) % nprocs;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">int</span> src = (rank - step) % nprocs;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordflow">if</span> (src &lt; 0) src += nprocs;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// Determine the number of columns to send.</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordtype">int</span> send_col_width = cols_per_proc;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">if</span> (dst == nprocs - 1) send_col_width += cols_remainder;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">// Transform the portion to send.</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="keywordtype">int</span> send_size;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordtype">double</span> send_trans_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    T* send_buf = send_trans(</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      mat, IR(0, mat.Height()),</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      IR(dst * cols_per_proc, dst * cols_per_proc + send_col_width), send_size);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - send_trans_start;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a> += send_size * <span class="keyword">sizeof</span>(T);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    mpi::Request&lt;T&gt; req;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">if</span> (var_recv) {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="comment">// Send.</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;nb_send(send_buf, send_size, dst, req);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="comment">// Get receive buffer.</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordtype">double</span> recv_buf_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordtype">int</span> recv_size = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_count&lt;T&gt;(src);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      T* recv_buf = get_recv_buf(accum_view, recv_size);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_buf_start;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="comment">// Receive.</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;recv(recv_buf, recv_size, src);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> += recv_size * <span class="keyword">sizeof</span>(T);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="comment">// Transform the received portion.</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="keywordtype">double</span> recv_trans_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      recv_trans(recv_buf, accum_view);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_trans_start;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;wait&lt;T&gt;(req);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="comment">// Get receive buffer.</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="keywordtype">double</span> recv_buf_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <span class="keywordtype">int</span> recv_size = 0;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      T* recv_buf = get_recv_buf(accum_view, recv_size);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_buf_start;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="comment">// Post the receive first.</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordtype">double</span> recv_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;nb_recv(recv_buf, recv_size, src, req);</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordtype">double</span> recv_tot = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_start;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> += recv_size * <span class="keyword">sizeof</span>(T);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="comment">// Do the send.</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keywordtype">double</span> send_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;send(send_buf, send_size, dst);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a961b2b067876adef034c3bd075d13925">rs_send_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - send_start;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="comment">// Complete the receive and transform.</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      recv_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;wait&lt;T&gt;(req);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#afa064118f6206f6ac61308e290a1b459">rs_recv_wait_time</a> += recv_tot + <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_start;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="keywordtype">double</span> recv_trans_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      recv_trans(recv_buf, accum_view);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_trans_start;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - rs_start;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a9b02b1adbc432e0d5b417ad6e098ed75"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">lbann::lbann_quantizer::rs_bytes_received</a></div><div class="ttdeci">size_t rs_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00349">lbann_quantizer.hpp:349</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a961b2b067876adef034c3bd075d13925"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a961b2b067876adef034c3bd075d13925">lbann::lbann_quantizer::rs_send_time</a></div><div class="ttdeci">double rs_send_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00363">lbann_quantizer.hpp:363</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa25d9dbcc7af16370142f46a6c23d178"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">lbann::lbann_quantizer::rs_time</a></div><div class="ttdeci">double rs_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00353">lbann_quantizer.hpp:353</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a484e392b671e8eeaa3af5b5faa683bee"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">lbann::lbann_quantizer::rs_bytes_sent</a></div><div class="ttdeci">size_t rs_bytes_sent</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00345">lbann_quantizer.hpp:345</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a824b8b6d8964621e6a02aee94c38332a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">lbann::lbann_quantizer::rs_send_trans_time</a></div><div class="ttdeci">double rs_send_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00357">lbann_quantizer.hpp:357</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a81db6fb79472d86023dd470c2948ea5a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">lbann::lbann_quantizer::rs_recv_trans_time</a></div><div class="ttdeci">double rs_recv_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00361">lbann_quantizer.hpp:361</a></div></div>
<div class="ttc" id="namespacelbann_html_a478d36031ff0659893c4322cd856157f"><div class="ttname"><a href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">lbann::get_time</a></div><div class="ttdeci">double get_time()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__timer_8hpp_source.html#l00037">lbann_timer.hpp:37</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a7fa4275835362b7d9ec91201f4f73436"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">lbann::lbann_quantizer::rs_recv_buf_time</a></div><div class="ttdeci">double rs_recv_buf_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00359">lbann_quantizer.hpp:359</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afa064118f6206f6ac61308e290a1b459"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afa064118f6206f6ac61308e290a1b459">lbann::lbann_quantizer::rs_recv_wait_time</a></div><div class="ttdeci">double rs_recv_wait_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00365">lbann_quantizer.hpp:365</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ad56a9a2d4a56c0dd252fdfbefaff50f8_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ad56a9a2d4a56c0dd252fdfbefaff50f8_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ad56a9a2d4a56c0dd252fdfbefaff50f8_cgraph" id="classlbann_1_1lbann__quantizer_ad56a9a2d4a56c0dd252fdfbefaff50f8_cgraph">
<area shape="rect" id="node2" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="262,5,373,32"/><area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::\lget_model_rank" alt="" coords="246,57,389,98"/><area shape="rect" id="node4" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::\lget_num_models" alt="" coords="246,122,389,163"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#ae891816f1eedb749136bd87418e29233" title="lbann::lbann_comm::\lnb_send" alt="" coords="246,187,389,229"/><area shape="rect" id="node6" href="classlbann_1_1lbann__comm.html#aa1db618eb587ead21fb0420bf94bfd45" title="lbann::lbann_comm::\lget_count" alt="" coords="246,253,389,294"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#af8842cd4cea390f76d9146e1c4578de4" title="lbann::lbann_comm::recv" alt="" coords="233,319,401,345"/><area shape="rect" id="node8" href="classlbann_1_1lbann__comm.html#a44faf6c010f45067e2951350e9e52d37" title="lbann::lbann_comm::wait" alt="" coords="234,369,401,396"/><area shape="rect" id="node9" href="classlbann_1_1lbann__comm.html#ae39f9ea155914634015a83ab615735bf" title="lbann::lbann_comm::\lnb_recv" alt="" coords="246,421,389,462"/><area shape="rect" id="node10" href="classlbann_1_1lbann__comm.html#a086078b881e7250df140ac116adb1939" title="lbann::lbann_comm::send" alt="" coords="232,487,403,513"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab4aba2f6afde9ebf4d8775554b19285d"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_recursive_doubling_allreduce </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>send_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>get_recv_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&#160;</td>
          <td class="paramname"><em>recv_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, T *)&gt;&#160;</td>
          <td class="paramname"><em>swap_bufs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00791">791</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                                       {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordtype">int</span> rank = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank();</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordtype">int</span> nprocs = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models();</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="comment">// This implementation requires a power-of-2 number of processes.</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordflow">if</span> (nprocs &amp; (nprocs - 1)) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="comment">// TODO: Fail.</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mask = 1;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="keywordflow">while</span> (mask &lt; nprocs) {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordtype">int</span> partner = rank ^ mask;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">// Transform and get buffers.</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordtype">int</span> send_size, recv_size;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    T* send_buf = send_trans(mat, send_size);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    T* recv_buf = get_recv_buf(mat, recv_size);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="comment">// Send/recv.</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;sendrecv(send_buf, send_size, partner, recv_buf, recv_size, partner);</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="comment">// Transform + accumulate.</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    recv_trans(recv_buf, mat);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="comment">// Swap buffers.</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    swap_bufs(send_buf, recv_buf);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    mask &lt;&lt;= 1;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  }</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ab4aba2f6afde9ebf4d8775554b19285d_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ab4aba2f6afde9ebf4d8775554b19285d_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ab4aba2f6afde9ebf4d8775554b19285d_cgraph" id="classlbann_1_1lbann__quantizer_ab4aba2f6afde9ebf4d8775554b19285d_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::\lget_model_rank" alt="" coords="206,5,349,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::\lget_num_models" alt="" coords="206,70,349,111"/><area shape="rect" id="node4" href="classlbann_1_1lbann__comm.html#a178261e3ecb101cf9add514845235eb3" title="lbann::lbann_comm::\lsendrecv" alt="" coords="206,135,349,177"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acdfe2509be7c3761f4b98dfce03b18a6"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_ring_allgather </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>var_recv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&#160;</td>
          <td class="paramname"><em>reduced_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>get_send_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>get_recv_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&#160;</td>
          <td class="paramname"><em>recv_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, T *)&gt;&#160;</td>
          <td class="paramname"><em>swap_bufs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00697">697</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                                         {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordtype">double</span> ag_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordtype">int</span> rank = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank();</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordtype">int</span> nprocs = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models();</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="comment">// Compute the number of columns each processor sends.</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <span class="comment">// The last processor handles the excess.</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordtype">int</span> cols_per_proc = mat.Width() / nprocs;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordtype">int</span> cols_remainder = mat.Width() % nprocs;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordtype">int</span> local_col_width = cols_per_proc;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <span class="keywordflow">if</span> (rank == nprocs - 1) local_col_width += cols_remainder;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">// Get the portion of mat that was reduced.</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordtype">double</span> reduced_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="keyword">auto</span> reduced = mat(IR(0, mat.Height()),</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                     IR(rank * cols_per_proc,</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                        rank * cols_per_proc + local_col_width));</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="comment">// Transform the reduced data.</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  reduced_trans(reduced);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">ag_reduced_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - reduced_start;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  <span class="comment">// Compute the previous/next ranks in the ring.</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  <span class="keywordtype">int</span> src = rank - 1;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <span class="keywordflow">if</span> (src &lt; 0) src = nprocs - 1;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordtype">int</span> dst = (rank + 1) % nprocs;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="comment">// Do the allgather.</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 0; step &lt; nprocs - 1; ++step) {</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">// Send our data or forward received data.</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    mpi::Request&lt;T&gt; req;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordtype">int</span> send_size;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="comment">// Compute the original rank that sent the data we&#39;re going to receive.</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordtype">int</span> data_src = (rank - step - 1) % nprocs;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">if</span> (data_src &lt; 0) data_src += nprocs;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">// Compute the amount of data we&#39;re receiving.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordtype">int</span> recv_col_width = cols_per_proc;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordflow">if</span> (data_src == nprocs - 1) recv_col_width += cols_remainder;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="comment">// Get the portion of mat to receive into.</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keyword">auto</span> recv_view = mat(IR(0, mat.Height()),</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                         IR(data_src * cols_per_proc,</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                            data_src * cols_per_proc + recv_col_width));</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    T* send_buf;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    T* recv_buf;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordflow">if</span> (var_recv) {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      send_buf = get_send_buf(send_size);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;nb_send(send_buf, send_size, dst, req);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a> += send_size * <span class="keyword">sizeof</span>(T);</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="comment">// Get receive buffer.</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="keywordtype">double</span> recv_buf_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordtype">int</span> recv_size = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_count&lt;T&gt;(src);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      recv_buf = get_recv_buf(recv_view, recv_size);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_buf_start;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <span class="comment">// Receive data.</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;recv(recv_buf, recv_size, src);</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a> += recv_size * <span class="keyword">sizeof</span>(T);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">// Transform the received portion.</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="keywordtype">double</span> recv_trans_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      recv_trans(recv_buf, recv_view);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_trans_start;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;wait&lt;T&gt;(req);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="comment">// Get receive buffer.</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="keywordtype">double</span> recv_buf_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="keywordtype">int</span> recv_size = 0;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      recv_buf = get_recv_buf(recv_view, recv_size);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_buf_start;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <span class="comment">// Post the receive first.</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordtype">double</span> recv_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;nb_recv(recv_buf, recv_size, src, req);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      <span class="keywordtype">double</span> recv_tot = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_start;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a> += recv_size * <span class="keyword">sizeof</span>(T);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="comment">// Do the send.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="keywordtype">double</span> send_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      send_buf = get_send_buf(send_size);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;send(send_buf, send_size, dst);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ab74ab07fa1c26bcf29d9d8bf267905a4">ag_send_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - send_start;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a> += send_size * <span class="keyword">sizeof</span>(T);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      <span class="comment">// Complete the receive and transform.</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      recv_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;wait&lt;T&gt;(req);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a64b9d2a56f4f2c64482377104d26c1f0">ag_recv_wait_time</a> += recv_tot + <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_start;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordtype">double</span> recv_trans_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      recv_trans(recv_buf, recv_view);</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - recv_trans_start;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="comment">// Swap so we forward the data we just received.</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    swap_bufs(send_buf, recv_buf);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">ag_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - ag_start;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a64b9d2a56f4f2c64482377104d26c1f0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a64b9d2a56f4f2c64482377104d26c1f0">lbann::lbann_quantizer::ag_recv_wait_time</a></div><div class="ttdeci">double ag_recv_wait_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00375">lbann_quantizer.hpp:375</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ae29843bccd4f211f36f4dd357a066a5d"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">lbann::lbann_quantizer::ag_bytes_received</a></div><div class="ttdeci">size_t ag_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00351">lbann_quantizer.hpp:351</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab74ab07fa1c26bcf29d9d8bf267905a4"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab74ab07fa1c26bcf29d9d8bf267905a4">lbann::lbann_quantizer::ag_send_time</a></div><div class="ttdeci">double ag_send_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00373">lbann_quantizer.hpp:373</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4d3c330826fbaff8ee38f4b05cafa84a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">lbann::lbann_quantizer::ag_time</a></div><div class="ttdeci">double ag_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00355">lbann_quantizer.hpp:355</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a3a9e25785189c84ba5a7fe055382ca92"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">lbann::lbann_quantizer::ag_bytes_sent</a></div><div class="ttdeci">size_t ag_bytes_sent</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00347">lbann_quantizer.hpp:347</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0b7575ba8c4c3c2fcd7ea7e668c02178"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">lbann::lbann_quantizer::ag_recv_buf_time</a></div><div class="ttdeci">double ag_recv_buf_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00369">lbann_quantizer.hpp:369</a></div></div>
<div class="ttc" id="namespacelbann_html_a478d36031ff0659893c4322cd856157f"><div class="ttname"><a href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">lbann::get_time</a></div><div class="ttdeci">double get_time()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__timer_8hpp_source.html#l00037">lbann_timer.hpp:37</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0e997657d1164ed23f912809492d8999"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">lbann::lbann_quantizer::ag_reduced_trans_time</a></div><div class="ttdeci">double ag_reduced_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00367">lbann_quantizer.hpp:367</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a9258429db2bb93e7f42e7b8573d83225"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">lbann::lbann_quantizer::ag_recv_trans_time</a></div><div class="ttdeci">double ag_recv_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00371">lbann_quantizer.hpp:371</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_acdfe2509be7c3761f4b98dfce03b18a6_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_acdfe2509be7c3761f4b98dfce03b18a6_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_acdfe2509be7c3761f4b98dfce03b18a6_cgraph" id="classlbann_1_1lbann__quantizer_acdfe2509be7c3761f4b98dfce03b18a6_cgraph">
<area shape="rect" id="node2" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="259,5,370,32"/><area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::\lget_model_rank" alt="" coords="243,57,386,98"/><area shape="rect" id="node4" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::\lget_num_models" alt="" coords="243,122,386,163"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#ae891816f1eedb749136bd87418e29233" title="lbann::lbann_comm::\lnb_send" alt="" coords="243,187,386,229"/><area shape="rect" id="node6" href="classlbann_1_1lbann__comm.html#aa1db618eb587ead21fb0420bf94bfd45" title="lbann::lbann_comm::\lget_count" alt="" coords="243,253,386,294"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#af8842cd4cea390f76d9146e1c4578de4" title="lbann::lbann_comm::recv" alt="" coords="231,319,399,345"/><area shape="rect" id="node8" href="classlbann_1_1lbann__comm.html#a44faf6c010f45067e2951350e9e52d37" title="lbann::lbann_comm::wait" alt="" coords="231,369,398,396"/><area shape="rect" id="node9" href="classlbann_1_1lbann__comm.html#ae39f9ea155914634015a83ab615735bf" title="lbann::lbann_comm::\lnb_recv" alt="" coords="243,421,386,462"/><area shape="rect" id="node10" href="classlbann_1_1lbann__comm.html#a086078b881e7250df140ac116adb1939" title="lbann::lbann_comm::send" alt="" coords="229,487,400,513"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a55d3136bd05809271643a056cd990d24"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Do an allreduce of mat, using the custom allreduce algorithm. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00047">47</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                               {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> rs_recv;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keyword">auto</span> rs_send_trans = </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    [] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="comment">// Assumes h is the full height of the matrix and column-major order</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <span class="comment">// so the buffer is contiguous.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <span class="keyword">auto</span> to_send = mat(h, w);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      count = to_send.Height() * to_send.Width();</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="keywordflow">return</span> to_send.Buffer();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    };</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keyword">auto</span> rs_get_recv_buf =</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    [&amp;rs_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">if</span> (rs_recv.Width() != mat.Width()) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        rs_recv.Resize(mat.Height(), mat.Width());</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      count = rs_recv.Height() * rs_recv.Width();</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      <span class="keywordflow">return</span> rs_recv.Buffer();</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    };</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keyword">auto</span> rs_recv_trans =</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    [&amp;rs_recv] (<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      accum += rs_recv;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    };</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  intermodel_pairwise_exchange_reduce_scatter&lt;DataType&gt;(</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, rs_send_trans, rs_get_recv_buf, rs_recv_trans);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> ag_send;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> ag_recv;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keyword">auto</span> ag_reduced_trans =</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    [&amp;ag_send] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      View(ag_send, reduced);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    };</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      count = ag_send.Width() * ag_send.Height();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="keywordflow">return</span> ag_send.Buffer();</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    };</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keyword">auto</span> ag_get_recv_buf =</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    [&amp;ag_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      count = recv_view.Height() * recv_view.Width();</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      View(ag_recv, recv_view);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keywordflow">return</span> recv_view.Buffer();</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    };</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keyword">auto</span> ag_recv_trans =</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    [] (<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="comment">// NOP.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    };</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keyword">auto</span> ag_swap_bufs =</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    [&amp;ag_send, &amp;ag_recv] (<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>*, DataType*) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> tmp_view = View(ag_send);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      View(ag_send, ag_recv);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      View(ag_recv, tmp_view);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    };</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  intermodel_ring_allgather&lt;DataType&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, ag_reduced_trans,</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                      ag_get_send_buf, ag_get_recv_buf,</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                                      ag_recv_trans, ag_swap_bufs);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00042">lbann_base.hpp:42</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a55d3136bd05809271643a056cd990d24_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a55d3136bd05809271643a056cd990d24_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a55d3136bd05809271643a056cd990d24_icgraph" id="classlbann_1_1lbann__quantizer_a55d3136bd05809271643a056cd990d24_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="206,5,370,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aa711b0b2de0ccd9265f66304dee26606" title="lbann::lbann_quantizer\l::intermodel_sum" alt="" coords="212,85,364,126"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa711b0b2de0ccd9265f66304dee26606"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00102">102</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                                                                   {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a55d3136bd05809271643a056cd990d24">intermodel_sum</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix());</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a55d3136bd05809271643a056cd990d24"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a55d3136bd05809271643a056cd990d24">lbann::lbann_quantizer::intermodel_sum</a></div><div class="ttdeci">void intermodel_sum(lbann_comm *comm, Mat &amp;mat)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00047">lbann_quantizer.cpp:47</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa711b0b2de0ccd9265f66304dee26606_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa711b0b2de0ccd9265f66304dee26606_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa711b0b2de0ccd9265f66304dee26606_cgraph" id="classlbann_1_1lbann__quantizer_aa711b0b2de0ccd9265f66304dee26606_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a55d3136bd05809271643a056cd990d24" title="lbann::lbann_quantizer\l::intermodel_sum" alt="" coords="205,5,357,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af51ff97c4c81fe027a6fa1b0d03107f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As with intermodel_sum_quantized, but use adaptive threshold quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00627">627</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                                                           {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="comment">// Select which algorithm to use based on the size of mat.</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// Multiply at 64 bits to avoid overflows.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="keywordtype">size_t</span> mat_size = ((size_t) mat.Height()) * ((<span class="keywordtype">size_t</span>) mat.Width());</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// Check signed version because we need one bit for the quantized value.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">if</span> (mat_size &gt; std::numeric_limits&lt;int32_t&gt;::max()) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    intermodel_sum_adaptive_threshold_quantized_impl&lt;uint64_t, uint64_t&gt;(</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, qerror, proportion, im_qerror, <a class="code" href="classlbann_1_1lbann__quantizer.html#a487b6490b8452e85fce46c8c1b75ec7b">adaptive_recv64_bufs1</a>,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a24ba8dd73278f8b10410fa7e6dec676f">adaptive_recv64_bufs2</a>);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">// Check whether we can use 16-bit row indices.</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">// Determine the column type (at compile time) based upon DataType.</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keyword">typedef</span> std::conditional&lt;sizeof(DataType) &lt;= 4, uint32_t, uint64_t&gt;::type colT;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> (mat.Height() &gt; std::numeric_limits&lt;int16_t&gt;::max()) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      intermodel_sum_adaptive_threshold_quantized_impl&lt;colT, uint32_t&gt;(</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, qerror, proportion, im_qerror, <a class="code" href="classlbann_1_1lbann__quantizer.html#aebbc279d18ea35693ce5bbcb22c0b9e6">adaptive_recv32_bufs1</a>,</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a38765ea10abe26432832e91da9f3adc0">adaptive_recv32_bufs2</a>);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      intermodel_sum_adaptive_threshold_quantized_impl&lt;colT, uint16_t&gt;(</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, qerror, proportion, im_qerror, <a class="code" href="classlbann_1_1lbann__quantizer.html#a1c040e0ac664033c11be7508b748ab9e">adaptive_recv16_bufs1</a>,</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a30dbfa80352a74ef679621aec49baa03">adaptive_recv16_bufs2</a>);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a24ba8dd73278f8b10410fa7e6dec676f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a24ba8dd73278f8b10410fa7e6dec676f">lbann::lbann_quantizer::adaptive_recv64_bufs2</a></div><div class="ttdeci">std::unordered_map&lt; Int, std::vector&lt; uint64_t &gt; &gt; adaptive_recv64_bufs2</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00387">lbann_quantizer.hpp:387</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a38765ea10abe26432832e91da9f3adc0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a38765ea10abe26432832e91da9f3adc0">lbann::lbann_quantizer::adaptive_recv32_bufs2</a></div><div class="ttdeci">std::unordered_map&lt; Int, std::vector&lt; uint32_t &gt; &gt; adaptive_recv32_bufs2</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00385">lbann_quantizer.hpp:385</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a487b6490b8452e85fce46c8c1b75ec7b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a487b6490b8452e85fce46c8c1b75ec7b">lbann::lbann_quantizer::adaptive_recv64_bufs1</a></div><div class="ttdeci">std::unordered_map&lt; Int, std::vector&lt; uint64_t &gt; &gt; adaptive_recv64_bufs1</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00386">lbann_quantizer.hpp:386</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a30dbfa80352a74ef679621aec49baa03"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a30dbfa80352a74ef679621aec49baa03">lbann::lbann_quantizer::adaptive_recv16_bufs2</a></div><div class="ttdeci">std::unordered_map&lt; Int, std::vector&lt; uint16_t &gt; &gt; adaptive_recv16_bufs2</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00383">lbann_quantizer.hpp:383</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aebbc279d18ea35693ce5bbcb22c0b9e6"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aebbc279d18ea35693ce5bbcb22c0b9e6">lbann::lbann_quantizer::adaptive_recv32_bufs1</a></div><div class="ttdeci">std::unordered_map&lt; Int, std::vector&lt; uint32_t &gt; &gt; adaptive_recv32_bufs1</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00384">lbann_quantizer.hpp:384</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a1c040e0ac664033c11be7508b748ab9e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a1c040e0ac664033c11be7508b748ab9e">lbann::lbann_quantizer::adaptive_recv16_bufs1</a></div><div class="ttdeci">std::unordered_map&lt; Int, std::vector&lt; uint16_t &gt; &gt; adaptive_recv16_bufs1</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00382">lbann_quantizer.hpp:382</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_af51ff97c4c81fe027a6fa1b0d03107f7_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_af51ff97c4c81fe027a6fa1b0d03107f7_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_af51ff97c4c81fe027a6fa1b0d03107f7_icgraph" id="classlbann_1_1lbann__quantizer_af51ff97c4c81fe027a6fa1b0d03107f7_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="239,5,403,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a17ac196d3ccc93137ae03f8451fea4b8" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="232,85,411,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a17ac196d3ccc93137ae03f8451fea4b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00653">653</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                                                               {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#af51ff97c4c81fe027a6fa1b0d03107f7">intermodel_sum_adaptive_threshold_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror,</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                              proportion, im_qerror);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af51ff97c4c81fe027a6fa1b0d03107f7"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af51ff97c4c81fe027a6fa1b0d03107f7">lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized</a></div><div class="ttdeci">void intermodel_sum_adaptive_threshold_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, int proportion, Mat &amp;im_qerror)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00627">lbann_quantizer.cpp:627</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a17ac196d3ccc93137ae03f8451fea4b8_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a17ac196d3ccc93137ae03f8451fea4b8_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a17ac196d3ccc93137ae03f8451fea4b8_cgraph" id="classlbann_1_1lbann__quantizer_a17ac196d3ccc93137ae03f8451fea4b8_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#af51ff97c4c81fe027a6fa1b0d03107f7" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="232,4,411,60"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8e44697cb293e422ee42f4dfcb07a25c"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename colT , typename rowT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized_impl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unordered_map&lt; Int, std::vector&lt; rowT &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>adaptive_recv_bufs1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unordered_map&lt; Int, std::vector&lt; rowT &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>adaptive_recv_bufs2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer__impl_8hpp_source.html#l00492">492</a> of file <a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                                               {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">// Ensure types are reasonable.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  static_assert(std::is_integral&lt;colT&gt;::value &amp;&amp; std::is_integral&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                <span class="stringliteral">&quot;Types must be integral&quot;</span>);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  static_assert(std::is_unsigned&lt;colT&gt;::value &amp;&amp; std::is_unsigned&lt;rowT&gt;::value,</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="stringliteral">&quot;Types must be unsigned&quot;</span>);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) == 2 || <span class="keyword">sizeof</span>(colT) == 4 || <span class="keyword">sizeof</span>(colT) == 8,</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <span class="stringliteral">&quot;colT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  static_assert(<span class="keyword">sizeof</span>(rowT) == 2 || <span class="keyword">sizeof</span>(rowT) == 4 || <span class="keyword">sizeof</span>(rowT) == 8,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                <span class="stringliteral">&quot;rowT must be 2, 4, or 8 bytes.&quot;</span>);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  static_assert(<span class="keyword">sizeof</span>(colT) &gt;= <span class="keyword">sizeof</span>(<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>),</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <span class="stringliteral">&quot;colT must be at least as large as DataType&quot;</span>);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="comment">// Elemental does not seem to support 16-bit MPI types. Using bytes keeps all</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="comment">// versions simpler.</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keyword">typedef</span> uint8_t mpi_rowT;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  <span class="keywordflow">if</span> (qerror.Height() == 0) {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    qerror.Resize(mat.Height(), mat.Width(), mat.LDim());</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    Zero(qerror);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keyword">const</span> colT row_header_factor = <span class="keyword">sizeof</span>(rowT) == 2 ? 2 : 1;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keyword">const</span> colT header_len = row_header_factor * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a> * mat.Width() +</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    row_header_factor;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keyword">const</span> Int max_size = header_len +</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a4bbd160584fc34cf42cfd8c38752b7bd">MAX_QUANTIZED_EXCESS</a> * mat.Width() * mat.Height() / proportion;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">if</span> (adaptive_recv_bufs1.find(max_size) == adaptive_recv_bufs1.end()) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// Initialize receive buffers.</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    adaptive_recv_bufs1.emplace(std::make_pair(max_size, std::vector&lt;rowT&gt;(max_size)));</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    adaptive_recv_bufs2.emplace(std::make_pair(max_size, std::vector&lt;rowT&gt;(max_size)));</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  std::vector&lt;rowT&gt; rs_quant;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  std::vector&lt;rowT&gt; rs_to_send;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  std::vector&lt;rowT&gt;&amp; rs_recv = adaptive_recv_bufs1[max_size];</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">/* NOTE: std::vector::resize() initializes elements. This is unnecessary, but</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">   * there is no way around it. You cannot use reserve() because that does not</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">   * update the size or guarantee data() returns anything useful. As far as I</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">   * can tell, the only way around this would be to either ensure the</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">   * _implementation_ makes guarantees for reserve(), or implement a custom</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">   * version of vector.</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordtype">double</span> quant_time_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  adaptive_threshold_quantize&lt;colT, rowT&gt;(mat, rs_quant, qerror, proportion);</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordtype">double</span> quant_tot = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - quant_time_start;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a> += quant_tot;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a> += quant_tot;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="keyword">auto</span> rs_send_trans = </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    [&amp;qerror, &amp;rs_quant, &amp;rs_to_send, proportion, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keyword">auto</span> to_send = mat(h, w);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keyword">auto</span> to_send_qerr = qerror(h, w);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      rs_to_send.clear();</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      adaptive_threshold_quantize_slice&lt;colT, rowT&gt;(rs_quant, to_send, to_send_qerr, rs_to_send, w.beg, w.end, proportion);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      count = <span class="keyword">sizeof</span>(rowT) * rs_to_send.size();</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">return</span> (mpi_rowT*) rs_to_send.data();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    };</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keyword">auto</span> rs_get_recv_buf = </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    [&amp;rs_recv, max_size] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      count = <span class="keyword">sizeof</span>(rowT) * max_size;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">return</span> (mpi_rowT*) rs_recv.data();</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    };</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="keyword">auto</span> rs_recv_trans = </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    [&amp;rs_recv, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    (mpi_rowT* buf, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      adaptive_threshold_unquantize_add&lt;colT, rowT&gt;(rs_recv, accum);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="comment">// Fix the received bytes count.</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      colT recv_size = ((colT*) rs_recv.data())[accum.Width() * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>];</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> -= rs_recv.size() * <span class="keyword">sizeof</span>(rowT);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> += recv_size * <span class="keyword">sizeof</span>(rowT);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    };</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  intermodel_pairwise_exchange_reduce_scatter&lt;mpi_rowT&gt;(</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, rs_send_trans,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    rs_get_recv_buf, rs_recv_trans);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  std::vector&lt;rowT&gt; local_send;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  std::vector&lt;rowT&gt; ag_send = adaptive_recv_bufs1[max_size];</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  std::vector&lt;rowT&gt; ag_recv = adaptive_recv_bufs2[max_size];</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  <span class="keywordtype">int</span> send_size = 0;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordtype">bool</span> local_sent = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keyword">auto</span> ag_reduced_trans =</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    [&amp;im_qerror, &amp;local_send, &amp;send_size, proportion, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      <span class="keywordflow">if</span> (im_qerror.Height() == 0) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        im_qerror.Resize(reduced.Height(), reduced.Width(), reduced.LDim());</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        Zero(im_qerror);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      adaptive_threshold_quantize_replace&lt;colT, rowT&gt;(reduced, local_send,</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                                                      im_qerror, proportion);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      send_size = <span class="keyword">sizeof</span>(rowT) * local_send.size();</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    };</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send, &amp;local_send, &amp;send_size, &amp;local_sent]</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    (<span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      count = send_size;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">if</span> (!local_sent) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        local_sent = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <span class="keywordflow">return</span> (mpi_rowT*) local_send.data();</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">return</span> (mpi_rowT*) ag_send.data();</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    };</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keyword">auto</span> ag_get_recv_buf =</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    [&amp;ag_recv, max_size] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      count = <span class="keyword">sizeof</span>(rowT) * max_size;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      <span class="keywordflow">return</span> (mpi_rowT*) ag_recv.data();</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    };</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <span class="keyword">auto</span> ag_recv_trans = </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    [&amp;ag_recv, &amp;send_size, proportion, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    (mpi_rowT*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      adaptive_threshold_unquantize&lt;colT, rowT&gt;(ag_recv, accum);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="keyword">const</span> colT* q_col = (<span class="keyword">const</span> colT*) ag_recv.data();</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      send_size = <span class="keyword">sizeof</span>(rowT) * q_col[accum.Width() * <a class="code" href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">HEADER_FACTOR</a>];</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="comment">// Fix the received bytes count.</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a> -= ag_recv.size() * <span class="keyword">sizeof</span>(rowT);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a> += send_size;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    };</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="keyword">auto</span> ag_swap_bufs =</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    [&amp;ag_send, &amp;ag_recv, max_size] (mpi_rowT*, mpi_rowT*) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      std::swap(ag_send, ag_recv);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    };</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  intermodel_ring_allgather&lt;mpi_rowT&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, ag_reduced_trans,</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                      ag_get_send_buf, ag_get_recv_buf,</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                                      ag_recv_trans, ag_swap_bufs);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb4315625e371169cabfac56c3f75d37"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb4315625e371169cabfac56c3f75d37">lbann::lbann_quantizer::HEADER_FACTOR</a></div><div class="ttdeci">static const int HEADER_FACTOR</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00339">lbann_quantizer.hpp:339</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a9b02b1adbc432e0d5b417ad6e098ed75"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">lbann::lbann_quantizer::rs_bytes_received</a></div><div class="ttdeci">size_t rs_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00349">lbann_quantizer.hpp:349</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4bbd160584fc34cf42cfd8c38752b7bd"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4bbd160584fc34cf42cfd8c38752b7bd">lbann::lbann_quantizer::MAX_QUANTIZED_EXCESS</a></div><div class="ttdeci">static const Int MAX_QUANTIZED_EXCESS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00342">lbann_quantizer.hpp:342</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ae29843bccd4f211f36f4dd357a066a5d"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">lbann::lbann_quantizer::ag_bytes_received</a></div><div class="ttdeci">size_t ag_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00351">lbann_quantizer.hpp:351</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa25d9dbcc7af16370142f46a6c23d178"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">lbann::lbann_quantizer::rs_time</a></div><div class="ttdeci">double rs_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00353">lbann_quantizer.hpp:353</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a824b8b6d8964621e6a02aee94c38332a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">lbann::lbann_quantizer::rs_send_trans_time</a></div><div class="ttdeci">double rs_send_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00357">lbann_quantizer.hpp:357</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00042">lbann_base.hpp:42</a></div></div>
<div class="ttc" id="namespacelbann_html_a478d36031ff0659893c4322cd856157f"><div class="ttname"><a href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">lbann::get_time</a></div><div class="ttdeci">double get_time()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__timer_8hpp_source.html#l00037">lbann_timer.hpp:37</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a8e44697cb293e422ee42f4dfcb07a25c_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a8e44697cb293e422ee42f4dfcb07a25c_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a8e44697cb293e422ee42f4dfcb07a25c_cgraph" id="classlbann_1_1lbann__quantizer_a8e44697cb293e422ee42f4dfcb07a25c_cgraph">
<area shape="rect" id="node2" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="233,19,343,45"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a97db186341c0819c8d52e2f815deb2a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>do_adagrad</em> = <code><a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *&#160;</td>
          <td class="paramname"><em>gradhist</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Do a sum reduction of mat over comm's inter-model communicator, with all communication being quantized. im_querror is a separate quantization error matrix that should be passed in each time this is called. This implements the allreduce using a ring-based reduce-scatter followed by a ring-based allgather. Matrices are sent quantized, are unquantized for the reduction, then the reduced matrix is requantized for the allgather. If do_adagrad is true, this scales the inter-mediate unquantized result as in AdaGrad, and uses gradhist to store the gradient history. If used, you should use SGD as the optimizer for those layers to avoid applying AdaGrad twice. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00269">269</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                  {</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// Initialize qerror.</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">if</span> (qerror.Height() == 0) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    qerror.Resize(mat.Height(), mat.Width(), mat.LDim());</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    Zero(qerror);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> to_send_quant;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> rs_recv;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keyword">auto</span> rs_send_trans =</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    [&amp;qerror, &amp;to_send_quant, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keyword">auto</span> to_send = mat(h, w);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keyword">auto</span> to_send_qerr = qerror(h, w);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a>(to_send, to_send_quant, to_send_qerr);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      count = to_send_quant.Height() * to_send_quant.Width();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">return</span> to_send_quant.Buffer();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    };</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keyword">auto</span> rs_get_recv_buf = </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    [&amp;rs_recv, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">if</span> (rs_recv.Width() != mat.Width()) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        rs_recv.Resize(<a class="code" href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0">get_quantized_matrix_height</a>(mat), mat.Width());</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      count = rs_recv.Height() * rs_recv.Width();</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keywordflow">return</span> rs_recv.Buffer();</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    };</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keyword">auto</span> rs_recv_trans = </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    [&amp;rs_recv, <span class="keyword">this</span>] (<a class="code" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#aa1e0ef48887b28d16e22efcd215b4d8a">unquantize_add</a>(rs_recv, accum);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    };</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  intermodel_pairwise_exchange_reduce_scatter&lt;qtype&gt;(</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, rs_send_trans, rs_get_recv_buf, rs_recv_trans);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> ag_send;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> ag_recv;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  std::function&lt;DataType(const DataType&amp;)&gt; <a class="code" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7">_sq</a> = [](<span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&amp; x) { <span class="keywordflow">return</span> x*x; };</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  std::function&lt;DataType(const DataType&amp;)&gt; <a class="code" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839">_sqrt</a> =</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    [](<span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&amp; x) { <span class="keywordflow">return</span> 1.0f / (std::sqrt(x) + 1e-8f); };</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keyword">auto</span> ag_reduced_trans =</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    [&amp;im_qerror, &amp;ag_send, gradhist, do_adagrad, <a class="code" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7">_sq</a>, <a class="code" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839">_sqrt</a>, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordflow">if</span> (do_adagrad) {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">if</span> (gradhist-&gt;Height() == 0) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;          Zeros(*gradhist, reduced.Height(), reduced.Width());</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> tmp(reduced);  <span class="comment">// Temporary for AdaGrad computations.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="comment">// Compute squared gradient and store in history.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        EntrywiseMap(tmp, _sq);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        *gradhist += tmp;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="comment">// Compute 1/sqrt(gradhist) with small perturbation.</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        Copy(*gradhist, tmp);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        EntrywiseMap(tmp, _sqrt);                     </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="comment">// Adjust update.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> reduced_copy(reduced);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        Hadamard(tmp, reduced_copy, reduced);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keywordflow">if</span> (im_qerror.Height() == 0) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        im_qerror.Resize(reduced.Height(), reduced.Width(), reduced.LDim());</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        Zero(im_qerror);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      }</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a>(reduced, ag_send, im_qerror);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5">unquantize</a>(ag_send, reduced);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    };</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      count = ag_send.Height() * ag_send.Width();</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <span class="keywordflow">return</span> ag_send.Buffer();</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    };</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keyword">auto</span> ag_get_recv_buf = </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    [&amp;ag_recv, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      ag_recv.Resize(<a class="code" href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0">get_quantized_matrix_height</a>(recv_view), recv_view.Width());</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      count = ag_recv.Height() * ag_recv.Width();</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">return</span> ag_recv.Buffer();</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    };</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keyword">auto</span> ag_recv_trans = </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    [&amp;ag_recv, <span class="keyword">this</span>] (qtype*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5">unquantize</a>(ag_recv, accum);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    };</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keyword">auto</span> ag_swap_bufs = </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    [&amp;ag_send, &amp;ag_recv] (qtype*, qtype*) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      std::swap(ag_send, ag_recv);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    };</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  intermodel_ring_allgather&lt;qtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, ag_reduced_trans,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                   ag_get_send_buf, ag_get_recv_buf,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                   ag_recv_trans, ag_swap_bufs);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab93df328abd13df0403d7483c8edfa89"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">El::Int qtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00062">lbann_quantizer.hpp:62</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa1e0ef48887b28d16e22efcd215b4d8a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa1e0ef48887b28d16e22efcd215b4d8a">lbann::lbann_quantizer::unquantize_add</a></div><div class="ttdeci">void unquantize_add(const QuantizedMatrix &amp;qmat, Mat &amp;mat)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00237">lbann_quantizer.cpp:237</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a2f0b1c91b994c91dfa506869e3329db6"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">lbann::lbann_quantizer::QuantizedMatrix</a></div><div class="ttdeci">El::Matrix&lt; qtype &gt; QuantizedMatrix</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00071">lbann_quantizer.hpp:71</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a3801d9cd1a1adefb160b69dbd7e499ef"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">lbann::lbann_quantizer::quantize</a></div><div class="ttdeci">void quantize(const Mat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00106">lbann_quantizer.cpp:106</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab91c3defbec372e4b5c35db7dfe522b0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0">lbann::lbann_quantizer::get_quantized_matrix_height</a></div><div class="ttdeci">Int get_quantized_matrix_height(const Mat &amp;mat) const </div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00390">lbann_quantizer.hpp:390</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00042">lbann_base.hpp:42</a></div></div>
<div class="ttc" id="lbann__layer__fully__connected_8cpp_html_a199b2df97e18b083eb9ee655fec2dfc7"><div class="ttname"><a href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7">_sq</a></div><div class="ttdeci">DataType _sq(DataType x)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__layer__fully__connected_8cpp_source.html#l00281">lbann_layer_fully_connected.cpp:281</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a46b83f4012a8d14a62bbfe79a9c4ede5"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5">lbann::lbann_quantizer::unquantize</a></div><div class="ttdeci">void unquantize(const QuantizedMatrix &amp;qmat, Mat &amp;mat)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00201">lbann_quantizer.cpp:201</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
<div class="ttc" id="lbann__layer__fully__connected_8cpp_html_afc141da3841a084e603a2e8db5b4a839"><div class="ttname"><a href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839">_sqrt</a></div><div class="ttdeci">DataType _sqrt(DataType x)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__layer__fully__connected_8cpp_source.html#l00282">lbann_layer_fully_connected.cpp:282</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph" id="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer\l::quantize" alt="" coords="240,75,392,117"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="448,5,603,61"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#aa1e0ef48887b28d16e22efcd215b4d8a" title="lbann::lbann_quantizer\l::unquantize_add" alt="" coords="240,141,392,182"/><area shape="rect" id="node7" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7" title="_sq" alt="" coords="295,207,337,233"/><area shape="rect" id="node8" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839" title="_sqrt" alt="" coords="291,257,341,284"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="240,309,392,350"/><area shape="rect" id="node4" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="441,85,610,112"/><area shape="rect" id="node5" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="457,136,593,163"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph" id="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="251,5,415,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="241,85,426,126"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4877befb2683f16a03fdf91ed1353636"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>do_adagrad</em> = <code><a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *&#160;</td>
          <td class="paramname"><em>gradhist</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00353">353</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                  {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7">intermodel_sum_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, im_qerror, do_adagrad,</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                           gradhist);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a97db186341c0819c8d52e2f815deb2a7"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7">lbann::lbann_quantizer::intermodel_sum_quantized</a></div><div class="ttdeci">void intermodel_sum_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, Mat &amp;im_qerror, bool do_adagrad=false, Mat *gradhist=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00269">lbann_quantizer.cpp:269</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph" id="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="241,170,426,211"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer\l::quantize" alt="" coords="475,75,627,117"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="683,5,837,61"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#aa1e0ef48887b28d16e22efcd215b4d8a" title="lbann::lbann_quantizer\l::unquantize_add" alt="" coords="475,141,627,182"/><area shape="rect" id="node8" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7" title="_sq" alt="" coords="529,207,572,233"/><area shape="rect" id="node9" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839" title="_sqrt" alt="" coords="525,257,576,284"/><area shape="rect" id="node10" href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="475,309,627,350"/><area shape="rect" id="node5" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="675,85,845,112"/><area shape="rect" id="node6" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="692,136,828,163"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4cf9d4cd5262b21939e95fc34ad0a09f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>compress</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As with intermodel_sum_quantized, but use threshold quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00529">529</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                                      {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordflow">if</span> (qerror.Height() == 0) {</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    qerror.Resize(mat.Height(), mat.Width(), mat.LDim());</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    Zero(qerror);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_quant;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_recv;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  std::vector&lt;Unsigned&gt; positions;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="keyword">auto</span> rs_send_trans = </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    [&amp;qerror, &amp;rs_quant, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keyword">auto</span> to_send = mat(h, w);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keyword">auto</span> to_send_qerr = qerror(h, w);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      rs_quant.clear();</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">threshold_quantize</a>(to_send, rs_quant, to_send_qerr, pos_thresh,</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                         neg_thresh, compress);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a>(rs_quant, comp);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        std::swap(rs_quant, comp);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      count = rs_quant.size();</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">return</span> rs_quant.data();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    };</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keyword">auto</span> rs_get_recv_buf = </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    [&amp;rs_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      rs_recv.resize(count);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">return</span> rs_recv.data();</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    };</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keyword">auto</span> rs_recv_trans = </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    [&amp;rs_recv, &amp;positions, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    (<a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>* buf, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a>(rs_recv, uncomp);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        std::swap(rs_recv, uncomp);</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a6336263dbcf910503df46e1ae36c7a9b">threshold_unquantize_apply</a>(rs_recv, accum, pos_thresh,</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                 neg_thresh, positions, compress);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    };</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  intermodel_pairwise_exchange_reduce_scatter&lt;uqtype&gt;(</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">true</span>, rs_send_trans, rs_get_recv_buf, rs_recv_trans);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_send;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_recv;</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <span class="keyword">auto</span> ag_reduced_trans =</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    [&amp;im_qerror, &amp;ag_send, &amp;positions, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="keywordflow">if</span> (im_qerror.Height() == 0) {</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        im_qerror.Resize(reduced.Height(), reduced.Width(), reduced.LDim());</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        Zero(im_qerror);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a616ff1a37dcf931a5eb6bd36ec9c395e">threshold_quantize_apply</a>(reduced, ag_send, im_qerror, pos_thresh,</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                               neg_thresh, positions, compress);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a>(ag_send, reduced, pos_thresh, neg_thresh, compress);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">compress_thresholds</a>(ag_send, comp);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        std::swap(ag_send, comp);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    };</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      count = ag_send.size();</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">return</span> ag_send.data();</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    };</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keyword">auto</span> ag_get_recv_buf =</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    [&amp;ag_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      ag_recv.resize(count);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keywordflow">return</span> ag_recv.data();</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    };</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="keyword">auto</span> ag_recv_trans = </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    [&amp;ag_recv, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    (<a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a>(ag_recv, uncomp);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a>(uncomp, accum, pos_thresh, neg_thresh, compress);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a>(ag_recv, accum, pos_thresh, neg_thresh);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    };</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="keyword">auto</span> ag_swap_bufs =</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    [&amp;ag_send, &amp;ag_recv] (uqtype*, uqtype*) {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      std::swap(ag_send, ag_recv);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    };</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  intermodel_ring_allgather&lt;uqtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">true</span>, ag_reduced_trans,</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                                    ag_get_send_buf, ag_get_recv_buf,</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                    ag_recv_trans, ag_swap_bufs);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a00106e69ea8a6dfe9e9a91c75b845bcd"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">lbann::lbann_quantizer::threshold_quantize</a></div><div class="ttdeci">void threshold_quantize(const Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, bool delta=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00360">lbann_quantizer.cpp:360</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a018cddfc9b73d94c2d60bdd7a11a0079"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00061">lbann_quantizer.hpp:61</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a6336263dbcf910503df46e1ae36c7a9b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a6336263dbcf910503df46e1ae36c7a9b">lbann::lbann_quantizer::threshold_unquantize_apply</a></div><div class="ttdeci">void threshold_unquantize_apply(const ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_thresh, DataType neg_thresh, std::vector&lt; Unsigned &gt; &amp;positions, bool delta=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00455">lbann_quantizer.cpp:455</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a84c968d0f772235faa39f6ad91e7eadb"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">lbann::lbann_quantizer::ThreshQuantized</a></div><div class="ttdeci">std::vector&lt; uqtype &gt; ThreshQuantized</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00072">lbann_quantizer.hpp:72</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a616ff1a37dcf931a5eb6bd36ec9c395e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a616ff1a37dcf931a5eb6bd36ec9c395e">lbann::lbann_quantizer::threshold_quantize_apply</a></div><div class="ttdeci">void threshold_quantize_apply(const Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, std::vector&lt; Unsigned &gt; &amp;positions, bool delta=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00489">lbann_quantizer.cpp:489</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00042">lbann_base.hpp:42</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad8d07c3ffddff08800887dff354ffed2"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2">lbann::lbann_quantizer::compress_thresholds</a></div><div class="ttdeci">void compress_thresholds(const ThreshQuantized &amp;q, ThreshQuantized &amp;cq)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00659">lbann_quantizer.cpp:659</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb58d63b174c3a937f3c3b21eb269b77"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">lbann::lbann_quantizer::uncompress_thresholds</a></div><div class="ttdeci">void uncompress_thresholds(const ThreshQuantized &amp;cq, ThreshQuantized &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00718">lbann_quantizer.cpp:718</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0f5f3b0149715ab59202b8884a87c7d5"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">lbann::lbann_quantizer::threshold_unquantize</a></div><div class="ttdeci">void threshold_unquantize(const ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_thresh, DataType neg_thresh, bool delta=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00425">lbann_quantizer.cpp:425</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph" id="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="257,5,409,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2" title="lbann::lbann_quantizer\l::compress_thresholds" alt="" coords="256,70,411,111"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77" title="lbann::lbann_quantizer\l::uncompress_thresholds" alt="" coords="249,135,417,177"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a6336263dbcf910503df46e1ae36c7a9b" title="lbann::lbann_quantizer\l::threshold_unquantize_apply" alt="" coords="238,201,429,242"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a616ff1a37dcf931a5eb6bd36ec9c395e" title="lbann::lbann_quantizer\l::threshold_quantize_apply" alt="" coords="245,266,422,307"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="257,331,410,373"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph" id="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="247,5,411,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="238,85,421,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae99dc11003cecd04e599d68c99d90c0b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>compress</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00620">620</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                                                      {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f">intermodel_sum_threshold_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, pos_thresh,</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                     neg_thresh, im_qerror, compress);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4cf9d4cd5262b21939e95fc34ad0a09f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f">lbann::lbann_quantizer::intermodel_sum_threshold_quantized</a></div><div class="ttdeci">void intermodel_sum_threshold_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, Mat &amp;im_qerror, bool compress=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00529">lbann_quantizer.cpp:529</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00044">lbann_file_io.cpp:44</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph" id="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="238,161,421,217"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="489,5,641,46"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ad8d07c3ffddff08800887dff354ffed2" title="lbann::lbann_quantizer\l::compress_thresholds" alt="" coords="488,70,643,111"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77" title="lbann::lbann_quantizer\l::uncompress_thresholds" alt="" coords="481,135,649,177"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a6336263dbcf910503df46e1ae36c7a9b" title="lbann::lbann_quantizer\l::threshold_unquantize_apply" alt="" coords="470,201,661,242"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a616ff1a37dcf931a5eb6bd36ec9c395e" title="lbann::lbann_quantizer\l::threshold_quantize_apply" alt="" coords="477,266,654,307"/><area shape="rect" id="node8" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="489,331,642,373"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa5aabc1cb4163e95aee993d9b37b9b32"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlbann_1_1lbann__quantizer_1_1adaptive__thresholds.html">lbann_quantizer::adaptive_thresholds</a> lbann::lbann_quantizer::proportion_threshold </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sample</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute positive and negative thresholds such that only one in proportion of values in mat are &gt;= to the positive threshold or &lt;= to the negative threshold. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to compute threshold values for. </td></tr>
    <tr><td class="paramname">qerror</td><td>The accumulated quantization error in mat. </td></tr>
    <tr><td class="paramname">proportion</td><td>Proportion of entries to keep. </td></tr>
    <tr><td class="paramname">sample</td><td>Whether to approximate stats by randomly sampling mat. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The threshold values. </dd></dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00769">769</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                                                  {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordtype">double</span> proportion_start = <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>();</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  std::vector&lt;DataType&gt; entries;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keyword">const</span> Int height = mat.Height();</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keyword">const</span> Int width = mat.Width();</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keyword">const</span> Int ldim = mat.LDim();</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.LockedBuffer();</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="comment">// Bail out if needed.</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordflow">if</span> (width == 0) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">return</span> { 0.0f, 0.0f };</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  <span class="keywordflow">if</span> (width * height &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#ada4c3ff82169a90e0c59db80f0768711">NUM_THRESHOLD_SAMPLES</a> || !sample) {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">// Copy entire matrix into vector.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    entries.reserve(width * height);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keywordflow">for</span> (Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keyword">const</span> Int col_offset = col * ldim;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <span class="keywordflow">for</span> (Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keyword">const</span> Unsigned pos = row + col_offset;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        entries.emplace_back(mat_buf[pos] + qerror_buf[pos]);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;      }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// Randomly sample entries to approximate everything.</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    entries.reserve(<a class="code" href="classlbann_1_1lbann__quantizer.html#ada4c3ff82169a90e0c59db80f0768711">NUM_THRESHOLD_SAMPLES</a>);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <a class="code" href="namespacelbann.html#ab909b5afe4b0047a3bfe13d519a90290">fast_rng_gen</a>&amp; gen = <a class="code" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">get_fast_generator</a>();</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    std::vector&lt;Unsigned&gt; poses(<a class="code" href="classlbann_1_1lbann__quantizer.html#ada4c3ff82169a90e0c59db80f0768711">NUM_THRESHOLD_SAMPLES</a>);</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#ada4c3ff82169a90e0c59db80f0768711">NUM_THRESHOLD_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <span class="keyword">const</span> Unsigned pos = <a class="code" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">fast_rand_int</a>(gen, height) + <a class="code" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">fast_rand_int</a>(gen, width) * ldim;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      __builtin_prefetch(&amp;mat_buf[pos]);</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      __builtin_prefetch(&amp;qerror_buf[pos]);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      poses[i] = pos;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#ada4c3ff82169a90e0c59db80f0768711">NUM_THRESHOLD_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keyword">const</span> Unsigned pos = poses[i];</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      entries.emplace_back(mat_buf[pos] + qerror_buf[pos]);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="comment">// Determine the number of entries to keep.</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  Int num_to_keep = std::max(1, (<span class="keywordtype">int</span>) entries.size() / proportion);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="comment">// Determine the threshold values.</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="comment">// This finds the num_to_keep&#39;th value if sample were sorted by magnitude</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="comment">// and assigns it to the appropriate threshold, then checks the upper portion</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="comment">// of the partially-sorted vector to find the other threshold.</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="comment">// In the case that the threshold would be 0, it is instead a small non-zero</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="comment">// value.</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh = std::numeric_limits&lt;DataType&gt;::max();</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh = -std::numeric_limits&lt;DataType&gt;::max();</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keyword">auto</span> i = entries.begin() + (entries.size() - num_to_keep);</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  std::nth_element(entries.begin(), i, entries.end(),</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                   [] (<span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> a, <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> b) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                     <span class="keywordflow">return</span> std::abs(a) &lt; std::abs(b); </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                   });</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keywordflow">if</span> (*i &gt; 0) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    pos_thresh = *i;</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">for</span> (++i; i &lt; entries.end(); ++i) {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      <span class="comment">// Find the largest (closest to 0) negative value.</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keywordflow">if</span> (*i &lt; 0) neg_thresh = std::max(neg_thresh, *i);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*i &lt; 0) {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    neg_thresh = *i;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordflow">for</span> (++i; i &lt; entries.end(); ++i) {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <span class="comment">// Find the smallest (closest to 0) positive value.</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <span class="keywordflow">if</span> (*i &gt; 0) pos_thresh = std::min(pos_thresh, *i);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  }</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="comment">// If there are no values of a sign, select threshold such that none are sent.</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordflow">if</span> (pos_thresh == std::numeric_limits&lt;DataType&gt;::max()) {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    pos_thresh = -neg_thresh;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="keywordflow">if</span> (neg_thresh == -std::numeric_limits&lt;DataType&gt;::max()) {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    neg_thresh = -pos_thresh;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  }</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">proportion_time</a> += <a class="code" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">get_time</a>() - proportion_start;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordflow">return</span> { pos_thresh, neg_thresh };</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;}</div>
<div class="ttc" id="namespacelbann_html_a557aaed6267e7aaf583a75149e9c670c"><div class="ttname"><a href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">lbann::fast_rand_int</a></div><div class="ttdeci">T fast_rand_int(Generator &amp;g, T max)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8hpp_source.html#l00068">lbann_random.hpp:68</a></div></div>
<div class="ttc" id="namespacelbann_html_ae6ce9c2fdec6f81803f6b1a6555c31c5"><div class="ttname"><a href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">lbann::get_fast_generator</a></div><div class="ttdeci">fast_rng_gen &amp; get_fast_generator()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8cpp_source.html#l00064">lbann_random.cpp:64</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a6bd266728f578df0c86fc2e493742cc1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">lbann::lbann_quantizer::proportion_time</a></div><div class="ttdeci">double proportion_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00377">lbann_quantizer.hpp:377</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ada4c3ff82169a90e0c59db80f0768711"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ada4c3ff82169a90e0c59db80f0768711">lbann::lbann_quantizer::NUM_THRESHOLD_SAMPLES</a></div><div class="ttdeci">static const Int NUM_THRESHOLD_SAMPLES</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00330">lbann_quantizer.hpp:330</a></div></div>
<div class="ttc" id="namespacelbann_html_ab909b5afe4b0047a3bfe13d519a90290"><div class="ttname"><a href="namespacelbann.html#ab909b5afe4b0047a3bfe13d519a90290">lbann::fast_rng_gen</a></div><div class="ttdeci">std::minstd_rand fast_rng_gen</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8hpp_source.html#l00037">lbann_random.hpp:37</a></div></div>
<div class="ttc" id="namespacelbann_html_a478d36031ff0659893c4322cd856157f"><div class="ttname"><a href="namespacelbann.html#a478d36031ff0659893c4322cd856157f">lbann::get_time</a></div><div class="ttdeci">double get_time()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__timer_8hpp_source.html#l00037">lbann_timer.hpp:37</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_cgraph" id="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_cgraph">
<area shape="rect" id="node2" href="namespacelbann.html#a478d36031ff0659893c4322cd856157f" title="lbann::get_time" alt="" coords="235,5,346,32"/><area shape="rect" id="node3" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="206,56,375,83"/><area shape="rect" id="node4" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="223,107,359,133"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_icgraph" id="classlbann_1_1lbann__quantizer_aa5aabc1cb4163e95aee993d9b37b9b32_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#af1d5338e2e1682156e4f654b110be70d" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="205,5,400,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ad1fe245c411c515540f9d0ac289f2203" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize\l_replace" alt="" coords="205,69,400,125"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3801d9cd1a1adefb160b69dbd7e499ef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sample</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Quantize a matrix. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width()). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">qmat</td><td>The output quantized matrix (will be resized). </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
    <tr><td class="paramname">sample</td><td>Whether to use samples to approximate averages. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00106">106</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                                                   {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// Set up the quantized matrix. (+2 for the averages.)</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keyword">const</span> Int qheight = <a class="code" href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0">get_quantized_matrix_height</a>(mat);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keyword">const</span> Int qwidth = mat.Width();</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  qmat.Resize(qheight, qwidth);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keyword">const</span> Int width = mat.Width();</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keyword">const</span> Int height = mat.Height();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keyword">const</span> Int ldim = mat.LDim();</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keyword">const</span> Int qmat_ldim = qmat.LDim();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a>* __restrict__ qmat_buf = qmat.Buffer();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(static)</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// First compute the positive and negative column averages.</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_sum = 0.0f;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_sum = 0.0f;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    Unsigned num_pos = 0;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    Unsigned num_neg = 0;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">if</span> (height &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a37f0c719ced064cfe80dacfa90b4a0b6">NUM_ONEBIT_SAMPLES</a> || !sample) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordflow">for</span> (Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keyword">const</span> Int pos = row + col * ldim;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;          pos_sum += val;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;          ++num_pos;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          neg_sum += val;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          ++num_neg;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">// Randomly sample NUM_ONEBIT_SAMPLES to approximate.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <a class="code" href="namespacelbann.html#ab909b5afe4b0047a3bfe13d519a90290">fast_rng_gen</a>&amp; gen = <a class="code" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">get_fast_generator</a>();</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">for</span> (Int i = 0; i &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a37f0c719ced064cfe80dacfa90b4a0b6">NUM_ONEBIT_SAMPLES</a>; ++i) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keyword">const</span> Int pos = <a class="code" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">fast_rand_int</a>(gen, height);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;          pos_sum += val;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;          ++num_pos;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;          neg_sum += val;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          ++num_neg;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    }</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_pos = 0.0f;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (num_pos &gt; 0) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      avg_pos = pos_sum / num_pos;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_neg = 0.0f;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">if</span> (num_neg &gt; 0) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      avg_neg = neg_sum / num_neg;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// Store the averages.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">// Use memcpy so that we don&#39;t violate aliasing rules.</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a> tmp = 0;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    memcpy(&amp;tmp, &amp;avg_pos, <span class="keyword">sizeof</span>(avg_pos));</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    qmat.Set(0, col, tmp);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    tmp = 0;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    memcpy(&amp;tmp, &amp;avg_neg, <span class="keyword">sizeof</span>(avg_neg));</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    qmat.Set(1, col, tmp);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// Now quantize the column, NUM_BITS entries at a time.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    Int qrow = 2;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">for</span> (Int row_chunk = 0; row_chunk &lt; height; row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> q = 0;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        Int row = row_chunk + bit;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> (row &gt;= height) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keyword">const</span> Int pos = row + col * ldim;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          q |= 1 &lt;&lt; bit;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          qerror_buf[pos] = val - avg_pos;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          qerror_buf[pos] = val - avg_neg;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      qmat_buf[qrow + col * qmat_ldim] = (<a class="code" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a>) q;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      ++qrow;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;}</div>
<div class="ttc" id="namespacelbann_html_a557aaed6267e7aaf583a75149e9c670c"><div class="ttname"><a href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c">lbann::fast_rand_int</a></div><div class="ttdeci">T fast_rand_int(Generator &amp;g, T max)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8hpp_source.html#l00068">lbann_random.hpp:68</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab93df328abd13df0403d7483c8edfa89"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">El::Int qtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00062">lbann_quantizer.hpp:62</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a37f0c719ced064cfe80dacfa90b4a0b6"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a37f0c719ced064cfe80dacfa90b4a0b6">lbann::lbann_quantizer::NUM_ONEBIT_SAMPLES</a></div><div class="ttdeci">static const Int NUM_ONEBIT_SAMPLES</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00334">lbann_quantizer.hpp:334</a></div></div>
<div class="ttc" id="namespacelbann_html_ae6ce9c2fdec6f81803f6b1a6555c31c5"><div class="ttname"><a href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5">lbann::get_fast_generator</a></div><div class="ttdeci">fast_rng_gen &amp; get_fast_generator()</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8cpp_source.html#l00064">lbann_random.cpp:64</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a018cddfc9b73d94c2d60bdd7a11a0079"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00061">lbann_quantizer.hpp:61</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab91c3defbec372e4b5c35db7dfe522b0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0">lbann::lbann_quantizer::get_quantized_matrix_height</a></div><div class="ttdeci">Int get_quantized_matrix_height(const Mat &amp;mat) const </div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00390">lbann_quantizer.hpp:390</a></div></div>
<div class="ttc" id="namespacelbann_html_ab909b5afe4b0047a3bfe13d519a90290"><div class="ttname"><a href="namespacelbann.html#ab909b5afe4b0047a3bfe13d519a90290">lbann::fast_rng_gen</a></div><div class="ttdeci">std::minstd_rand fast_rng_gen</div><div class="ttdef"><b>Definition:</b> <a href="lbann__random_8hpp_source.html#l00037">lbann_random.hpp:37</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00321">lbann_quantizer.hpp:321</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_cgraph" id="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="213,5,368,61"/><area shape="rect" id="node3" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="206,85,375,112"/><area shape="rect" id="node4" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="223,136,359,163"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_icgraph" id="classlbann_1_1lbann__quantizer_a3801d9cd1a1adefb160b69dbd7e499ef_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aa516ede3d1fd798bb5ef5c2cf28cb53d" title="lbann::lbann_quantizer\l::quantize" alt="" coords="223,5,375,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="206,70,391,111"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="451,27,615,83"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="441,106,626,147"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa516ede3d1fd798bb5ef5c2cf28cb53d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sample</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00196">196</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                                         {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">quantize</a>(mat.LockedMatrix(), qmat, qerror, sample);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a3801d9cd1a1adefb160b69dbd7e499ef"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef">lbann::lbann_quantizer::quantize</a></div><div class="ttdeci">void quantize(const Mat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror, bool sample=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00106">lbann_quantizer.cpp:106</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa516ede3d1fd798bb5ef5c2cf28cb53d_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa516ede3d1fd798bb5ef5c2cf28cb53d_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa516ede3d1fd798bb5ef5c2cf28cb53d_cgraph" id="classlbann_1_1lbann__quantizer_aa516ede3d1fd798bb5ef5c2cf28cb53d_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a3801d9cd1a1adefb160b69dbd7e499ef" title="lbann::lbann_quantizer\l::quantize" alt="" coords="205,78,357,119"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ab91c3defbec372e4b5c35db7dfe522b0" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="413,5,568,61"/><area shape="rect" id="node4" href="namespacelbann.html#ae6ce9c2fdec6f81803f6b1a6555c31c5" title="lbann::get_fast_generator" alt="" coords="406,85,575,112"/><area shape="rect" id="node5" href="namespacelbann.html#a557aaed6267e7aaf583a75149e9c670c" title="lbann::fast_rand_int" alt="" coords="423,136,559,163"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afa32b747b7ac0dbea8df3b47593d54b7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::reset_bytes_counters </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reset recorded bytes counters. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00268">268</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                              {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">rs_bytes_sent</a> = 0;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">ag_bytes_sent</a> = 0;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">rs_bytes_received</a> = 0;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">ag_bytes_received</a> = 0;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a9b02b1adbc432e0d5b417ad6e098ed75"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a9b02b1adbc432e0d5b417ad6e098ed75">lbann::lbann_quantizer::rs_bytes_received</a></div><div class="ttdeci">size_t rs_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00349">lbann_quantizer.hpp:349</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ae29843bccd4f211f36f4dd357a066a5d"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ae29843bccd4f211f36f4dd357a066a5d">lbann::lbann_quantizer::ag_bytes_received</a></div><div class="ttdeci">size_t ag_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00351">lbann_quantizer.hpp:351</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a484e392b671e8eeaa3af5b5faa683bee"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a484e392b671e8eeaa3af5b5faa683bee">lbann::lbann_quantizer::rs_bytes_sent</a></div><div class="ttdeci">size_t rs_bytes_sent</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00345">lbann_quantizer.hpp:345</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a3a9e25785189c84ba5a7fe055382ca92"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a3a9e25785189c84ba5a7fe055382ca92">lbann::lbann_quantizer::ag_bytes_sent</a></div><div class="ttdeci">size_t ag_bytes_sent</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00347">lbann_quantizer.hpp:347</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_afa32b747b7ac0dbea8df3b47593d54b7_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_afa32b747b7ac0dbea8df3b47593d54b7_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_afa32b747b7ac0dbea8df3b47593d54b7_icgraph" id="classlbann_1_1lbann__quantizer_afa32b747b7ac0dbea8df3b47593d54b7_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="209,5,373,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914" title="lbann::lbann_quantizer\l::lbann_quantizer" alt="" coords="215,85,367,126"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abdba3762c51a2820f70adba32169f57b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::reset_time_counters </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Reset recorded time counters. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00301">301</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                             {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">rs_time</a> = 0.0;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">ag_time</a> = 0.0;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">rs_send_trans_time</a> = 0.0;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">rs_recv_buf_time</a> = 0.0;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">rs_recv_trans_time</a> = 0.0;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a961b2b067876adef034c3bd075d13925">rs_send_time</a> = 0.0;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#afa064118f6206f6ac61308e290a1b459">rs_recv_wait_time</a> = 0.0;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">ag_reduced_trans_time</a> = 0.0;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">ag_recv_buf_time</a> = 0.0;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">ag_recv_trans_time</a> = 0.0;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#ab74ab07fa1c26bcf29d9d8bf267905a4">ag_send_time</a> = 0.0;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a64b9d2a56f4f2c64482377104d26c1f0">ag_recv_wait_time</a> = 0.0;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">proportion_time</a> = 0.0;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a64b9d2a56f4f2c64482377104d26c1f0"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a64b9d2a56f4f2c64482377104d26c1f0">lbann::lbann_quantizer::ag_recv_wait_time</a></div><div class="ttdeci">double ag_recv_wait_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00375">lbann_quantizer.hpp:375</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a961b2b067876adef034c3bd075d13925"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a961b2b067876adef034c3bd075d13925">lbann::lbann_quantizer::rs_send_time</a></div><div class="ttdeci">double rs_send_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00363">lbann_quantizer.hpp:363</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab74ab07fa1c26bcf29d9d8bf267905a4"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab74ab07fa1c26bcf29d9d8bf267905a4">lbann::lbann_quantizer::ag_send_time</a></div><div class="ttdeci">double ag_send_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00373">lbann_quantizer.hpp:373</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa25d9dbcc7af16370142f46a6c23d178"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa25d9dbcc7af16370142f46a6c23d178">lbann::lbann_quantizer::rs_time</a></div><div class="ttdeci">double rs_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00353">lbann_quantizer.hpp:353</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4d3c330826fbaff8ee38f4b05cafa84a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4d3c330826fbaff8ee38f4b05cafa84a">lbann::lbann_quantizer::ag_time</a></div><div class="ttdeci">double ag_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00355">lbann_quantizer.hpp:355</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a6bd266728f578df0c86fc2e493742cc1"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a6bd266728f578df0c86fc2e493742cc1">lbann::lbann_quantizer::proportion_time</a></div><div class="ttdeci">double proportion_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00377">lbann_quantizer.hpp:377</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a824b8b6d8964621e6a02aee94c38332a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a824b8b6d8964621e6a02aee94c38332a">lbann::lbann_quantizer::rs_send_trans_time</a></div><div class="ttdeci">double rs_send_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00357">lbann_quantizer.hpp:357</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0b7575ba8c4c3c2fcd7ea7e668c02178"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0b7575ba8c4c3c2fcd7ea7e668c02178">lbann::lbann_quantizer::ag_recv_buf_time</a></div><div class="ttdeci">double ag_recv_buf_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00369">lbann_quantizer.hpp:369</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a81db6fb79472d86023dd470c2948ea5a"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a81db6fb79472d86023dd470c2948ea5a">lbann::lbann_quantizer::rs_recv_trans_time</a></div><div class="ttdeci">double rs_recv_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00361">lbann_quantizer.hpp:361</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0e997657d1164ed23f912809492d8999"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0e997657d1164ed23f912809492d8999">lbann::lbann_quantizer::ag_reduced_trans_time</a></div><div class="ttdeci">double ag_reduced_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00367">lbann_quantizer.hpp:367</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a9258429db2bb93e7f42e7b8573d83225"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a9258429db2bb93e7f42e7b8573d83225">lbann::lbann_quantizer::ag_recv_trans_time</a></div><div class="ttdeci">double ag_recv_trans_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00371">lbann_quantizer.hpp:371</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a7fa4275835362b7d9ec91201f4f73436"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a7fa4275835362b7d9ec91201f4f73436">lbann::lbann_quantizer::rs_recv_buf_time</a></div><div class="ttdeci">double rs_recv_buf_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00359">lbann_quantizer.hpp:359</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afa064118f6206f6ac61308e290a1b459"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afa064118f6206f6ac61308e290a1b459">lbann::lbann_quantizer::rs_recv_wait_time</a></div><div class="ttdeci">double rs_recv_wait_time</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00365">lbann_quantizer.hpp:365</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_abdba3762c51a2820f70adba32169f57b_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_abdba3762c51a2820f70adba32169f57b_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_abdba3762c51a2820f70adba32169f57b_icgraph" id="classlbann_1_1lbann__quantizer_abdba3762c51a2820f70adba32169f57b_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="206,5,370,61"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914" title="lbann::lbann_quantizer\l::lbann_quantizer" alt="" coords="212,85,364,126"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a00106e69ea8a6dfe9e9a91c75b845bcd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code><a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Threshold and quantize a matrix. qerror needs to be initialized with: Zeros(qerror, mat.Height(), mat.Width())). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">q</td><td>The output list of quantized entries. </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
    <tr><td class="paramname">pos_thresh</td><td>The positive threshold level. </td></tr>
    <tr><td class="paramname">neg_thresh</td><td>The negative threshold level. </td></tr>
    <tr><td class="paramname">delta</td><td>Whether to do delta encoding (default false). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00360">360</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                                                          {</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keyword">const</span> Int ldim = mat.LDim();</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  <span class="keyword">const</span> Int width = mat.Width();</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keyword">const</span> Int height = mat.Height();</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">if</span> (ldim != qerror.LDim()) std::cout &lt;&lt; <span class="stringliteral">&quot;ldims don&#39;t match!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  std::vector&lt;ThreshQuantized&gt; thread_qs(omp_get_max_threads());</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">if</span> (delta) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    Unsigned prev_pos = 0;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">for</span> (Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">for</span> (Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="keyword">const</span> Unsigned pos = row + col * ldim;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;          qerror_buf[pos] = val - pos_thresh;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;          <span class="comment">// Delta encode pos.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          quant.emplace_back(((pos - prev_pos) &lt;&lt; 1) | 1);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          prev_pos = pos;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          qerror_buf[pos] = val - neg_thresh;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;          quant.emplace_back((pos - prev_pos) &lt;&lt; 1);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;          prev_pos = pos;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;          qerror_buf[pos] = val;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="preprocessor">    #pragma omp parallel</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="preprocessor"></span>    {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> tid = omp_get_thread_num();</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="preprocessor">      #pragma omp for schedule(static)</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">for</span> (Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">for</span> (Int row = 0; row &lt; height; ++row) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          <span class="keyword">const</span> Unsigned pos = row + col * ldim;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;          <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;          <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            qerror_buf[pos] = val - pos_thresh;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            thread_qs[tid].emplace_back((pos &lt;&lt; 1) | 1);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            qerror_buf[pos] = val - neg_thresh;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            thread_qs[tid].emplace_back(pos &lt;&lt; 1);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            qerror_buf[pos] = val;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// Copy the temporary vectors.</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp;&amp; thread_q : thread_qs) {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      quant.insert(quant.end(), thread_q.begin(), thread_q.end());</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;}</div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph" id="classlbann_1_1lbann__quantizer_a00106e69ea8a6dfe9e9a91c75b845bcd_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#ae9949af6bec1e95adf5a32ba9bb4afd8" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="221,5,373,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="206,69,389,125"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="447,29,611,85"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="438,109,621,165"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae9949af6bec1e95adf5a32ba9bb4afd8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code><a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00418">418</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                                   {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">threshold_quantize</a>(mat.LockedMatrix(), q, qerror, pos_thresh, neg_thresh,</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                     delta);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a00106e69ea8a6dfe9e9a91c75b845bcd"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd">lbann::lbann_quantizer::threshold_quantize</a></div><div class="ttdeci">void threshold_quantize(const Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, bool delta=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00360">lbann_quantizer.cpp:360</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph" id="classlbann_1_1lbann__quantizer_ae9949af6bec1e95adf5a32ba9bb4afd8_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a00106e69ea8a6dfe9e9a91c75b845bcd" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="205,5,357,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a616ff1a37dcf931a5eb6bd36ec9c395e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize_apply </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; Unsigned &gt; &amp;&#160;</td>
          <td class="paramname"><em>positions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code><a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Quantize only the locations in mat in positions; the companion of threshold_unquantize_apply. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00489">489</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                                                   {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.LockedBuffer();</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ qerror_buf = qerror.Buffer();</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="keywordflow">if</span> (delta) {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// Need to sort so positions are in order, otherwise our delta encoding</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">// doesn&#39;t work. (Could be solved by adding stops, but maybe not worth it.)</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    std::sort(positions.begin(), positions.end());</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    Unsigned prev_pos = 0;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pos : positions) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        qerror_buf[pos] = val - pos_thresh;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        quant.emplace_back(((pos - prev_pos) &lt;&lt; 1) | 1);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        prev_pos = pos;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        qerror_buf[pos] = val - neg_thresh;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        quant.emplace_back((pos - prev_pos) &lt;&lt; 1);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        prev_pos = pos;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        qerror_buf[pos] = val;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pos : positions) {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keyword">const</span> <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat_buf[pos] + qerror_buf[pos];</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        quant.emplace_back((pos &lt;&lt; 1) | 1);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        qerror_buf[pos] = val - pos_thresh;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        quant.emplace_back(pos &lt;&lt; 1);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        qerror_buf[pos] = val - neg_thresh;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        qerror_buf[pos] = val;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;}</div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a616ff1a37dcf931a5eb6bd36ec9c395e_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a616ff1a37dcf931a5eb6bd36ec9c395e_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a616ff1a37dcf931a5eb6bd36ec9c395e_icgraph" id="classlbann_1_1lbann__quantizer_a616ff1a37dcf931a5eb6bd36ec9c395e_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="233,45,415,101"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="474,5,638,61"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="465,85,647,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0f5f3b0149715ab59202b8884a87c7d5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code><a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize a thresholded-and-quantized matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">q</td><td>The quantized matrix. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
    <tr><td class="paramname">pos_thresh</td><td>The positive threshold value. </td></tr>
    <tr><td class="paramname">neg_thresh</td><td>The negative negative value. </td></tr>
    <tr><td class="paramname">delta</td><td>Whether q was quantized with delta encoding (default false). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00425">425</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                   {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf = mat.Buffer();</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keywordflow">if</span> (delta) {</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    Unsigned prev_pos = 0;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; quant.size(); ++i) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> q = quant[i];</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      <span class="keyword">const</span> Unsigned pos = (q &gt;&gt; 1) + prev_pos;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      prev_pos = pos;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) buf[pos] = pos_thresh;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordflow">else</span> buf[pos] = neg_thresh;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor">    #pragma omp parallel for schedule(static)</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; quant.size(); ++i) {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> q = quant[i];</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keyword">const</span> Unsigned pos = q &gt;&gt; 1;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) buf[pos] = pos_thresh;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordflow">else</span> buf[pos] = neg_thresh;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a018cddfc9b73d94c2d60bdd7a11a0079"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00061">lbann_quantizer.hpp:61</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph" id="classlbann_1_1lbann__quantizer_a0f5f3b0149715ab59202b8884a87c7d5_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a2324bba3cbb6c0d3e51bbe21555e7f1a" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="223,5,377,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="209,69,391,125"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="450,29,614,85"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="441,109,623,165"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2324bba3cbb6c0d3e51bbe21555e7f1a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code><a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00449">449</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                   {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">threshold_unquantize</a>(quant, mat.Matrix(), pos_thresh, neg_thresh, delta);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0f5f3b0149715ab59202b8884a87c7d5"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5">lbann::lbann_quantizer::threshold_unquantize</a></div><div class="ttdeci">void threshold_unquantize(const ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_thresh, DataType neg_thresh, bool delta=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00425">lbann_quantizer.cpp:425</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph" id="classlbann_1_1lbann__quantizer_a2324bba3cbb6c0d3e51bbe21555e7f1a_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a0f5f3b0149715ab59202b8884a87c7d5" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="209,5,362,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6336263dbcf910503df46e1ae36c7a9b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize_apply </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; Unsigned &gt; &amp;&#160;</td>
          <td class="paramname"><em>positions</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>delta</em> = <code><a class="el" href="lbann__target__layer__unsupervised_8cpp.html#ae6c865df784842196d411c1466b01686">false</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Do threshold unquantization from arbitrary locations, adding the unquantized values to existing ones instead of replacing them, and storing the locations applied. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00455">455</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                                                   {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="comment">// A general note on positions that I&#39;m putting here because I&#39;m not sure</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">// where else to: Using a vector admits the possibility that we have</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="comment">// duplicate entries. This could be fixed by using an unordered_set, but when</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  <span class="comment">// I benchmarked this, it increased our runtime by ~5 times. Having duplicate</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// entries should not change the final result: it means that</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <span class="comment">// threshold_quantize_apply may quantize the same entry multiple times, but</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  <span class="comment">// the final unquantize is not an _apply, and so will just set that entry to</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">// the same value multiple times. We send some extra data, but the overhead</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="comment">// is small.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ buf = mat.Buffer();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="keywordflow">if</span> (delta) {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    Unsigned prev_pos = 0;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; quant.size(); ++i) {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> q = quant[i];</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keyword">const</span> Unsigned pos = (q &gt;&gt; 1) + prev_pos;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      prev_pos = pos;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      positions.emplace_back(pos);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) buf[pos] += pos_thresh;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keywordflow">else</span> buf[pos] += neg_thresh;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">for</span> (Unsigned i = 0; i &lt; quant.size(); ++i) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> q = quant[i];</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keyword">const</span> Unsigned pos = q &gt;&gt; 1;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      positions.emplace_back(pos);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) buf[pos] += pos_thresh;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordflow">else</span> buf[pos] += neg_thresh;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  }</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a018cddfc9b73d94c2d60bdd7a11a0079"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00061">lbann_quantizer.hpp:61</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a6336263dbcf910503df46e1ae36c7a9b_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a6336263dbcf910503df46e1ae36c7a9b_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a6336263dbcf910503df46e1ae36c7a9b_icgraph" id="classlbann_1_1lbann__quantizer_a6336263dbcf910503df46e1ae36c7a9b_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="246,45,429,101"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="487,5,651,61"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="478,85,661,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afb58d63b174c3a937f3c3b21eb269b77"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::uncompress_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Corresponding uncompress. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00718">718</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                                                                {</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">uncompress_thresholds</a>(cq, cq.begin(), cq.end(), q);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_afb58d63b174c3a937f3c3b21eb269b77"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#afb58d63b174c3a937f3c3b21eb269b77">lbann::lbann_quantizer::uncompress_thresholds</a></div><div class="ttdeci">void uncompress_thresholds(const ThreshQuantized &amp;cq, ThreshQuantized &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00718">lbann_quantizer.cpp:718</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_afb58d63b174c3a937f3c3b21eb269b77_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_afb58d63b174c3a937f3c3b21eb269b77_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_afb58d63b174c3a937f3c3b21eb269b77_icgraph" id="classlbann_1_1lbann__quantizer_afb58d63b174c3a937f3c3b21eb269b77_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="222,45,405,101"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="463,5,627,61"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="454,85,637,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aad80eac1e1fe0847b52a039ec9f1c8c7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::uncompress_thresholds </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::const_iterator&#160;</td>
          <td class="paramname"><em>cqstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::const_iterator&#160;</td>
          <td class="paramname"><em>cqend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handle uncompression starting from arbitrary locations. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00723">723</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                                           {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> quotient = 0;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> remainder = 0;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> cur_bit = 0;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> cur = *cqstart;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iter = cqstart; iter != cqend;) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="comment">// Decode the quotient by continuing until a 0 is found.</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="comment">// TODO: Need to switch this depending on the size of El::Int.</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">// __builtin_ffs expects 32-bit ints; need __builtin_ffsll for 64-bit.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordtype">int</span> ffz;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordflow">while</span> ((ffz = __builtin_ffs(~cur)) == 0) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      ++iter;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keywordflow">if</span> (iter == cqend) {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      cur = *iter;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      quotient += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      cur_bit = 0;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    quotient += ffz - 1 - cur_bit;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    cur_bit = ffz;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="comment">// Decode the remainder (GR_K bits).</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> bits_left = std::min((<a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>) <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit,</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                                static_cast&lt;uqtype&gt;(<a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>));</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    remainder = (cur &gt;&gt; cur_bit) &amp; ((1 &lt;&lt; bits_left) - 1);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">if</span> (bits_left != <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>) {</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      ++iter;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      cur = *iter;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    }</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    remainder |= (cur &amp; ((1 &lt;&lt; (<a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> - bits_left)) - 1)) &lt;&lt; bits_left;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    cur_bit = (cur_bit + <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>) &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - 1);</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">// Decode the final value.</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    q.emplace_back(quotient * <a class="code" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> + remainder);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    quotient = 0;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    remainder = 0;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">// Advance to the next entry if needed.</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    iter += !cur_bit;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="keywordflow">if</span> (!cur_bit &amp;&amp; iter != cqend) cur = *iter;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">// Fill everything before the current bit with 1s to avoid confusing the</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">// quotient calculation.</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    cur |= (1 &lt;&lt; cur_bit) - 1;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad98118c77f676fa3d3fb4ba27b814070"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">lbann::lbann_quantizer::GR_M</a></div><div class="ttdeci">static const uqtype GR_M</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00326">lbann_quantizer.hpp:326</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a5f645c840854c584c9224af063fee23b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">lbann::lbann_quantizer::GR_K</a></div><div class="ttdeci">static const uqtype GR_K</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00328">lbann_quantizer.hpp:328</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a018cddfc9b73d94c2d60bdd7a11a0079"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00061">lbann_quantizer.hpp:61</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00321">lbann_quantizer.hpp:321</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a46b83f4012a8d14a62bbfe79a9c4ede5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize a matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qmat</td><td>The matrix to unquantize. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00201">201</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                                                      {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="keyword">const</span> Int width = mat.Width();</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keyword">const</span> Int height = mat.Height();</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keyword">const</span> Int ldim = mat.LDim();</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="keyword">const</span> Int qmat_ldim = qmat.LDim();</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a>* __restrict__ qmat_buf = qmat.LockedBuffer();</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.Buffer();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(static)</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    Int qrow = 2;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// Extract the averages.</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a> tmp = qmat.Get(0, col);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_pos;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    memcpy(&amp;avg_pos, &amp;tmp, <span class="keyword">sizeof</span>(avg_pos));</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    tmp = qmat.Get(1, col);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_neg;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    memcpy(&amp;avg_neg, &amp;tmp, <span class="keyword">sizeof</span>(avg_neg));</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// Unquantize this column.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">for</span> (Int row_chunk = 0; row_chunk &lt; height; row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> q = (<a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>) qmat_buf[qrow + col * qmat_ldim];</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        Int row = row_chunk + bit;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">if</span> (row &gt;= height) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        mat_buf[row + col * ldim] = (q &gt;&gt; bit) &amp; 0x1 ? avg_pos : avg_neg;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      ++qrow;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab93df328abd13df0403d7483c8edfa89"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">El::Int qtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00062">lbann_quantizer.hpp:62</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a018cddfc9b73d94c2d60bdd7a11a0079"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00061">lbann_quantizer.hpp:61</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00321">lbann_quantizer.hpp:321</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a46b83f4012a8d14a62bbfe79a9c4ede5_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a46b83f4012a8d14a62bbfe79a9c4ede5_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a46b83f4012a8d14a62bbfe79a9c4ede5_icgraph" id="classlbann_1_1lbann__quantizer_a46b83f4012a8d14a62bbfe79a9c4ede5_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a6d3469fdcca399c8cc12f11d900e2c8e" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="223,5,375,46"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="206,70,391,111"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="451,27,615,83"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="441,106,626,147"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a6d3469fdcca399c8cc12f11d900e2c8e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::unquantize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a8e774b79084797a8f87918d8f66b6802">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00233">233</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                                                          {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5">unquantize</a>(qmat, mat.Matrix());</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a46b83f4012a8d14a62bbfe79a9c4ede5"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5">lbann::lbann_quantizer::unquantize</a></div><div class="ttdeci">void unquantize(const QuantizedMatrix &amp;qmat, Mat &amp;mat)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00201">lbann_quantizer.cpp:201</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a6d3469fdcca399c8cc12f11d900e2c8e_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a6d3469fdcca399c8cc12f11d900e2c8e_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a6d3469fdcca399c8cc12f11d900e2c8e_cgraph" id="classlbann_1_1lbann__quantizer_a6d3469fdcca399c8cc12f11d900e2c8e_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a46b83f4012a8d14a62bbfe79a9c4ede5" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="205,5,357,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa1e0ef48887b28d16e22efcd215b4d8a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::unquantize_add </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Variant of unquantize that adds its entries. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00237">237</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                                                          {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keyword">const</span> Int width = mat.Width();</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="keyword">const</span> Int height = mat.Height();</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keyword">const</span> Int ldim = mat.LDim();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keyword">const</span> Int qmat_ldim = qmat.LDim();</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keyword">const</span> <a class="code" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a>* __restrict__ qmat_buf = qmat.LockedBuffer();</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* __restrict__ mat_buf = mat.Buffer();</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">  #pragma omp parallel for schedule(static)</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor"></span>  <span class="keywordflow">for</span> (Int col = 0; col &lt; width; ++col) {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    Int qrow = 2;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// Extract the averages.</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a> tmp = qmat.Get(0, col);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_pos;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    memcpy(&amp;avg_pos, &amp;tmp, <span class="keyword">sizeof</span>(avg_pos));</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    tmp = qmat.Get(1, col);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_neg;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    memcpy(&amp;avg_neg, &amp;tmp, <span class="keyword">sizeof</span>(avg_neg));</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// Unquantize this column.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">for</span> (Int row_chunk = 0; row_chunk &lt; height; row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> q = (<a class="code" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a>) qmat_buf[qrow + col * qmat_ldim];</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        Int row = row_chunk + bit;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">if</span> (row &gt;= height) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        mat_buf[row + col * ldim] += (q &gt;&gt; bit) &amp; 0x1 ? avg_pos : avg_neg;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      ++qrow;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab93df328abd13df0403d7483c8edfa89"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">El::Int qtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00062">lbann_quantizer.hpp:62</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a018cddfc9b73d94c2d60bdd7a11a0079"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">El::Unsigned uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00061">lbann_quantizer.hpp:61</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00321">lbann_quantizer.hpp:321</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00037">lbann_base.hpp:37</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa1e0ef48887b28d16e22efcd215b4d8a_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa1e0ef48887b28d16e22efcd215b4d8a_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa1e0ef48887b28d16e22efcd215b4d8a_icgraph" id="classlbann_1_1lbann__quantizer_aa1e0ef48887b28d16e22efcd215b4d8a_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="206,49,391,90"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#ace11211398e94728880476981f25fdc2" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="451,5,615,61"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="441,85,626,126"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a1c040e0ac664033c11be7508b748ab9e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;Int, std::vector&lt;uint16_t&gt; &gt; lbann::lbann_quantizer::adaptive_recv16_bufs1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Pre-allocated receive buffers for adaptive quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00382">382</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a30dbfa80352a74ef679621aec49baa03"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;Int, std::vector&lt;uint16_t&gt; &gt; lbann::lbann_quantizer::adaptive_recv16_bufs2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00383">383</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="aebbc279d18ea35693ce5bbcb22c0b9e6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;Int, std::vector&lt;uint32_t&gt; &gt; lbann::lbann_quantizer::adaptive_recv32_bufs1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00384">384</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a38765ea10abe26432832e91da9f3adc0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;Int, std::vector&lt;uint32_t&gt; &gt; lbann::lbann_quantizer::adaptive_recv32_bufs2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00385">385</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a487b6490b8452e85fce46c8c1b75ec7b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;Int, std::vector&lt;uint64_t&gt; &gt; lbann::lbann_quantizer::adaptive_recv64_bufs1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00386">386</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a24ba8dd73278f8b10410fa7e6dec676f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;Int, std::vector&lt;uint64_t&gt; &gt; lbann::lbann_quantizer::adaptive_recv64_bufs2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00387">387</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae29843bccd4f211f36f4dd357a066a5d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::ag_bytes_received</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Bytes received in doing the all-gather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00351">351</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a3a9e25785189c84ba5a7fe055382ca92"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::ag_bytes_sent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Bytes sent in doing the all-gather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00347">347</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0b7575ba8c4c3c2fcd7ea7e668c02178"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::ag_recv_buf_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the allgather get_recv_buf. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00369">369</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9258429db2bb93e7f42e7b8573d83225"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::ag_recv_trans_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the all-gather recv_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00371">371</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a64b9d2a56f4f2c64482377104d26c1f0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::ag_recv_wait_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the allgather receiving/waiting for the receive. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00375">375</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0e997657d1164ed23f912809492d8999"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::ag_reduced_trans_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the allgather reduced_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00367">367</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ab74ab07fa1c26bcf29d9d8bf267905a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::ag_send_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the allgather sending. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00373">373</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a4d3c330826fbaff8ee38f4b05cafa84a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::ag_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the all-gather. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00355">355</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a5f645c840854c584c9224af063fee23b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> lbann::lbann_quantizer::GR_K = 7</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>log_2(GR_M). </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00328">328</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad98118c77f676fa3d3fb4ba27b814070"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classlbann_1_1lbann__quantizer.html#a018cddfc9b73d94c2d60bdd7a11a0079">uqtype</a> lbann::lbann_quantizer::GR_M = 128</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Golomb-Rice M parameter, a power of 2. Should be large-ish relative to the data being encoded, but log_2(GR_M) should be &lt;= 31. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00326">326</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="afb4315625e371169cabfac56c3f75d37"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int lbann::lbann_quantizer::HEADER_FACTOR = 3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Factor used when computing header lengths in adaptive quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00339">339</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a4bbd160584fc34cf42cfd8c38752b7bd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const Int lbann::lbann_quantizer::MAX_QUANTIZED_EXCESS = 4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Max factor by which adaptive quantization can exceed optimal amount. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00342">342</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a33ea17392f53b90e91aea1ffb7e11d68"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t lbann::lbann_quantizer::NUM_BITS = sizeof(<a class="el" href="classlbann_1_1lbann__quantizer.html#ab93df328abd13df0403d7483c8edfa89">qtype</a>) * 8</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of bits per quantized word. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00321">321</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a37f0c719ced064cfe80dacfa90b4a0b6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const Int lbann::lbann_quantizer::NUM_ONEBIT_SAMPLES = 128</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Samples to use to approximate column averages in onebit quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00334">334</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad6e99d098a4d4c1488241b3484132904"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const Int lbann::lbann_quantizer::NUM_RECON_SAMPLES = 128</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of samples to use in col_reconstruction. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00332">332</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ada4c3ff82169a90e0c59db80f0768711"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const Int lbann::lbann_quantizer::NUM_THRESHOLD_SAMPLES = 1024</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of samples to use in proportion_threshold. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00330">330</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6bd266728f578df0c86fc2e493742cc1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::proportion_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in proportion_threshold. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00377">377</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a716fae78ef5ba082a8093f0d06550804"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::quantized_count</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Most recent number of quantized entries. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00379">379</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9b02b1adbc432e0d5b417ad6e098ed75"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::rs_bytes_received</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Bytes received in doing the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00349">349</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a484e392b671e8eeaa3af5b5faa683bee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t lbann::lbann_quantizer::rs_bytes_sent</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Bytes sent in doing the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00345">345</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7fa4275835362b7d9ec91201f4f73436"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::rs_recv_buf_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the reduce-scatter get_recv_buf. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00359">359</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a81db6fb79472d86023dd470c2948ea5a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::rs_recv_trans_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the reduce-scatter recv_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00361">361</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="afa064118f6206f6ac61308e290a1b459"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::rs_recv_wait_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the reduce-scatter receiving/waiting for the receive. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00365">365</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a961b2b067876adef034c3bd075d13925"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::rs_send_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the reduce-scatter sending. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00363">363</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a824b8b6d8964621e6a02aee94c38332a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::rs_send_trans_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the reduce-scatter send_trans. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00357">357</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="aa25d9dbcc7af16370142f46a6c23d178"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double lbann::lbann_quantizer::rs_time</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Time spent in the reduce-scatter. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00353">353</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/travis/build/LLNL/lbann/include/lbann/utils/<a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a></li>
<li>/home/travis/build/LLNL/lbann/src/utils/<a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a></li>
<li>/home/travis/build/LLNL/lbann/include/lbann/utils/<a class="el" href="lbann__quantizer__impl_8hpp_source.html">lbann_quantizer_impl.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacelbann.html">lbann</a></li><li class="navelem"><a class="el" href="classlbann_1_1lbann__quantizer.html">lbann_quantizer</a></li>
    <li class="footer">Generated on Sat May 6 2017 15:01:07 for LBANN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
